var Prototype={Version:"1.6.1_rc2",Browser:{IE:!!(window.attachEvent&&navigator.userAgent.indexOf("Opera")===-1),Opera:navigator.userAgent.indexOf("Opera")>-1,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")===-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)},BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){if(window.HTMLElement&&window.HTMLElement.prototype){return true}if(window.Element&&window.Element.prototype){return true}})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement!=="undefined"){return true}var A=document.createElement("div");if(A["__proto__"]&&A["__proto__"]!==document.createElement("form")["__proto__"]){return true}return false})()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(A){return A}};if(Prototype.Browser.MobileSafari){Prototype.BrowserFeatures.SpecificElementExtensions=false}var Abstract={};var Try={these:function(){var D;for(var C=0,E=arguments.length;C<E;C++){var A=arguments[C];try{D=A();break}catch(F){}}return D}};var Class=(function(){function A(){var I=null,H=$A(arguments);if(Object.isFunction(H[0])){I=H.shift()}function D(){this.initialize.apply(this,arguments)}Object.extend(D,Class.Methods);D.superclass=I;D.subclasses=[];if(I){var E=function(){};E.prototype=I.prototype;D.prototype=new E;I.subclasses.push(D)}for(var F=0;F<H.length;F++){D.addMethods(H[F])}if(!D.prototype.initialize){D.prototype.initialize=Prototype.emptyFunction}D.prototype.constructor=D;return D}function C(K){var F=this.superclass&&this.superclass.prototype;var E=Object.keys(K);if(!Object.keys({toString:true}).length){if(K.toString!=Object.prototype.toString){E.push("toString")}if(K.valueOf!=Object.prototype.valueOf){E.push("valueOf")}}for(var D=0,H=E.length;D<H;D++){var J=E[D],I=K[J];if(F&&Object.isFunction(I)&&I.argumentNames().first()=="$super"){var L=I;I=(function(M){return function(){return F[M].apply(this,arguments)}})(J).wrap(L);I.valueOf=L.valueOf.bind(L);I.toString=L.toString.bind(L)}this.prototype[J]=I}return this}return{create:A,Methods:{addMethods:C}}})();(function(){function N(T){return Object.prototype.toString.call(T).match(/^\[object\s(.*)\]$/)[1]}function J(T,V){for(var U in V){T[U]=V[U]}return T}function M(T){try{if(E(T)){return"undefined"}if(T===null){return"null"}return T.inspect?T.inspect():String(T)}catch(U){if(U instanceof RangeError){return"..."}throw U}}function L(T){var V=typeof T;switch(V){case"undefined":case"function":case"unknown":return ;case"boolean":return T.toString()}if(T===null){return"null"}if(T.toJSON){return T.toJSON()}if(I(T)){return }var U=[];for(var X in T){var W=L(T[X]);if(!E(W)){U.push(X.toJSON()+": "+W)}}return"{"+U.join(", ")+"}"}function D(T){return $H(T).toQueryString()}function F(T){return T&&T.toHTML?T.toHTML():String.interpret(T)}function Q(T){var U=[];for(var V in T){U.push(V)}return U}function O(T){var U=[];for(var V in T){U.push(T[V])}return U}function K(T){return J({},T)}function I(T){return !!(T&&T.nodeType==1)}function H(T){return N(T)==="Array"}function S(T){return T instanceof Hash}function C(T){return typeof T==="function"}function A(T){return N(T)==="String"}function P(T){return N(T)==="Number"}function E(T){return typeof T==="undefined"}J(Object,{extend:J,inspect:M,toJSON:L,toQueryString:D,toHTML:F,keys:Q,values:O,clone:K,isElement:I,isArray:H,isHash:S,isFunction:C,isString:A,isNumber:P,isUndefined:E})})();Object.extend(Function.prototype,(function(){var M=Array.prototype.slice;function E(Q,N){var P=Q.length,O=N.length;while(O--){Q[P+O]=N[O]}return Q}function K(O,N){O=M.call(O,0);return E(O,N)}function I(){var N=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return N.length==1&&!N[0]?[]:N}function J(P){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var N=this,O=M.call(arguments,1);return function(){var Q=K(O,arguments);return N.apply(P,Q)}}function H(P){var N=this,O=M.call(arguments,1);return function(S){var Q=E([S||window.event],O);return N.apply(P,Q)}}function L(){if(!arguments.length){return this}var N=this,O=M.call(arguments,0);return function(){var P=K(O,arguments);return N.apply(this,P)}}function F(P){var N=this,O=M.call(arguments,1);P=P*1000;return window.setTimeout(function(){return N.apply(N,O)},P)}function A(){var N=E([0.01],arguments);return this.delay.apply(this,N)}function D(O){var N=this;return function(){var P=E([N.bind(this)],arguments);return O.apply(this,P)}}function C(){if(this._methodized){return this._methodized}var N=this;return this._methodized=function(){var O=E([this],arguments);return N.apply(null,O)}}return{argumentNames:I,bind:J,bindAsEventListener:H,curry:L,delay:F,defer:A,wrap:D,methodize:C}})());Date.prototype.toJSON=function(){return'"'+this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+'Z"'};RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(A){return String(A).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(C,A){this.callback=C;this.frequency=A;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},execute:function(){this.callback(this)},stop:function(){if(!this.timer){return }clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute()}catch(A){}finally{this.currentlyExecuting=false}}}});Object.extend(String,{interpret:function(A){return A==null?"":String(A)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,(function(){function prepareReplacement(replacement){if(Object.isFunction(replacement)){return replacement}var template=new Template(replacement);return function(match){return template.evaluate(match)}}function gsub(pattern,replacement){var result="",source=this,match;replacement=prepareReplacement(replacement);if(Object.isString(pattern)){pattern=RegExp.escape(pattern)}if(!(pattern.length||pattern.source)){replacement=replacement("");return replacement+source.split("").join(replacement)+replacement}while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length)}else{result+=source,source=""}}return result}function sub(pattern,replacement,count){replacement=prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0){return match[0]}return replacement(match)})}function scan(pattern,iterator){this.gsub(pattern,iterator);return String(this)}function truncate(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?"...":truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\/?[^>]+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var matchAll=new RegExp(Prototype.ScriptFragment,"img");var matchOne=new RegExp(Prototype.ScriptFragment,"im");return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||["",""])[1]})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){escapeHTML.text.data=this;return escapeHTML.div.innerHTML}function unescapeHTML(){var div=document.createElement("div");div.innerHTML=this.stripTags();return div.childNodes[0]?(div.childNodes.length>1?$A(div.childNodes).inject("",function(memo,node){return memo+node.nodeValue}):div.childNodes[0].nodeValue):""}function toQueryParams(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match){return{}}return match[1].split(separator||"&").inject({},function(hash,pair){if((pair=pair.split("="))[0]){var key=decodeURIComponent(pair.shift());var value=pair.length>1?pair.join("="):pair[0];if(value!=undefined){value=decodeURIComponent(value)}if(key in hash){if(!Object.isArray(hash[key])){hash[key]=[hash[key]]}hash[key].push(value)}else{hash[key]=value}}return hash})}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(count){return count<1?"":new Array(count+1).join(this)}function camelize(){var parts=this.split("-"),len=parts.length;if(len==1){return parts[0]}var camelized=this.charAt(0)=="-"?parts[0].charAt(0).toUpperCase()+parts[0].substring(1):parts[0];for(var i=1;i<len;i++){camelized+=parts[i].charAt(0).toUpperCase()+parts[i].substring(1)}return camelized}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()}function dasherize(){return this.gsub(/_/,"-")}function inspect(useDoubleQuotes){var escapedString=this.gsub(/[\x00-\x1f\\]/,function(match){var character=String.specialChar[match[0]];return character?character:"\\u00"+match[0].charCodeAt().toPaddedString(2,16)});if(useDoubleQuotes){return'"'+escapedString.replace(/"/g,'\\"')+'"'}return"'"+escapedString.replace(/'/g,"\\'")+"'"}function toJSON(){return this.inspect(true)}function unfilterJSON(filter){return this.sub(filter||Prototype.JSONFilter,"#{1}")}function isJSON(){var str=this;if(str.blank()){return false}str=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"");return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str)}function evalJSON(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function include(pattern){return this.indexOf(pattern)>-1}function startsWith(pattern){return this.indexOf(pattern)===0}function endsWith(pattern){var d=this.length-pattern.length;return d>=0&&this.lastIndexOf(pattern)===d}function empty(){return this==""}function blank(){return/^\s*$/.test(this)}function interpolate(object,pattern){return new Template(this,pattern).evaluate(object)}return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,toJSON:toJSON,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:evalJSON,include:include,startsWith:startsWith,endsWith:endsWith,empty:empty,blank:blank,interpolate:interpolate}})());Object.extend(String.prototype.escapeHTML,{div:document.createElement("div"),text:document.createTextNode("")});String.prototype.escapeHTML.div.appendChild(String.prototype.escapeHTML.text);if("<\n>".escapeHTML()!=="&lt;\n&gt;"){String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}if("&lt;\n&gt;".unescapeHTML()!=="<\n>"){String.prototype.unescapeHTML=function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}}var Template=Class.create({initialize:function(A,C){this.template=A.toString();this.pattern=C||Template.Pattern},evaluate:function(A){if(Object.isFunction(A.toTemplateReplacements)){A=A.toTemplateReplacements()}return this.template.gsub(this.pattern,function(E){if(A==null){return""}var H=E[1]||"";if(H=="\\"){return E[2]}var C=A,I=E[3];var F=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;E=F.exec(I);if(E==null){return H}while(E!=null){var D=E[1].startsWith("[")?E[2].gsub("\\\\]","]"):E[1];C=C[D];if(null==C||""==E[3]){break}I=I.substring("["==E[3]?E[1].length:E[0].length);E=F.exec(I)}return H+String.interpret(C)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable=(function(){function D(b,a){var Z=0;try{this._each(function(d){b.call(a,d,Z++)})}catch(c){if(c!=$break){throw c}}return this}function U(c,b,a){var Z=-c,d=[],e=this.toArray();if(c<1){return e}while((Z+=c)<e.length){d.push(e.slice(Z,Z+c))}return d.collect(b,a)}function C(b,a){b=b||Prototype.K;var Z=true;this.each(function(d,c){Z=Z&&!!b.call(a,d,c);if(!Z){throw $break}});return Z}function K(b,a){b=b||Prototype.K;var Z=false;this.each(function(d,c){if(Z=!!b.call(a,d,c)){throw $break}});return Z}function L(b,a){b=b||Prototype.K;var Z=[];this.each(function(d,c){Z.push(b.call(a,d,c))});return Z}function W(b,a){var Z;this.each(function(d,c){if(b.call(a,d,c)){Z=d;throw $break}});return Z}function J(b,a){var Z=[];this.each(function(d,c){if(b.call(a,d,c)){Z.push(d)}});return Z}function I(c,b,a){b=b||Prototype.K;var Z=[];if(Object.isString(c)){c=new RegExp(RegExp.escape(c))}this.each(function(e,d){if(c.match(e)){Z.push(b.call(a,e,d))}});return Z}function A(Z){if(Object.isFunction(this.indexOf)){if(this.indexOf(Z)!=-1){return true}}var a=false;this.each(function(b){if(b==Z){a=true;throw $break}});return a}function T(a,Z){Z=Object.isUndefined(Z)?null:Z;return this.eachSlice(a,function(b){while(b.length<a){b.push(Z)}return b})}function N(Z,b,a){this.each(function(d,c){Z=b.call(a,Z,d,c)});return Z}function Y(a){var Z=$A(arguments).slice(1);return this.map(function(b){return b[a].apply(b,Z)})}function S(b,a){b=b||Prototype.K;var Z;this.each(function(d,c){d=b.call(a,d,c);if(Z==null||d>=Z){Z=d}});return Z}function P(b,a){b=b||Prototype.K;var Z;this.each(function(d,c){d=b.call(a,d,c);if(Z==null||d<Z){Z=d}});return Z}function F(c,a){c=c||Prototype.K;var b=[],Z=[];this.each(function(e,d){(c.call(a,e,d)?b:Z).push(e)});return[b,Z]}function H(a){var Z=[];this.each(function(b){Z.push(b[a])});return Z}function E(b,a){var Z=[];this.each(function(d,c){if(!b.call(a,d,c)){Z.push(d)}});return Z}function O(a,Z){return this.map(function(c,b){return{value:c,criteria:a.call(Z,c,b)}}).sort(function(g,e){var d=g.criteria,c=e.criteria;return d<c?-1:d>c?1:0}).pluck("value")}function Q(){return this.map()}function V(){var a=Prototype.K,Z=$A(arguments);if(Object.isFunction(Z.last())){a=Z.pop()}var b=[this].concat(Z).map($A);return this.map(function(d,c){return a(b.pluck(c))})}function M(){return this.toArray().length}function X(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:D,eachSlice:U,all:C,every:C,any:K,some:K,collect:L,map:L,detect:W,findAll:J,select:J,filter:J,grep:I,include:A,member:A,inGroupsOf:T,inject:N,invoke:Y,max:S,min:P,partition:F,pluck:H,reject:E,sortBy:O,toArray:Q,entries:Q,zip:V,size:M,inspect:X,find:W}})();function $A(D){if(!D){return[]}if("toArray" in D){return D.toArray()}var C=D.length||0,A=new Array(C);while(C--){A[C]=D[C]}return A}function $w(A){if(!Object.isString(A)){return[]}A=A.strip();return A?A.split(/\s+/):[]}Array.from=$A;(function(){var V=Array.prototype,O=V.slice,Q=V.forEach;function C(Z){for(var Y=0,a=this.length;Y<a;Y++){Z(this[Y])}}if(!Q){Q=C}function N(){this.length=0;return this}function E(){return this[0]}function I(){return this[this.length-1]}function K(){return this.select(function(Y){return Y!=null})}function X(){return this.inject([],function(Z,Y){if(Object.isArray(Y)){return Z.concat(Y.flatten())}Z.push(Y);return Z})}function J(){var Y=O.call(arguments,0);return this.select(function(Z){return !Y.include(Z)})}function H(Y){return(Y!==false?this:this.toArray())._reverse()}function M(Y){return this.inject([],function(b,a,Z){if(0==Z||(Y?b.last()!=a:!b.include(a))){b.push(a)}return b})}function S(Y){return this.uniq().findAll(function(Z){return Y.detect(function(a){return Z===a})})}function T(){return O.call(this,0)}function L(){return this.length}function W(){return"["+this.map(Object.inspect).join(", ")+"]"}function U(){var Y=[];this.each(function(Z){var a=Object.toJSON(Z);if(!Object.isUndefined(a)){Y.push(a)}});return"["+Y.join(", ")+"]"}function A(a,Y){Y||(Y=0);var Z=this.length;if(Y<0){Y=Z+Y}for(;Y<Z;Y++){if(this[Y]===a){return Y}}return -1}function P(Z,Y){Y=isNaN(Y)?this.length:(Y<0?this.length+Y:Y)+1;var a=this.slice(0,Y).reverse().indexOf(Z);return(a<0)?a:Y-a-1}function D(){var d=O.call(this,0),b;for(var Z=0,a=arguments.length;Z<a;Z++){b=arguments[Z];if(Object.isArray(b)&&!("callee" in b)){for(var Y=0,c=b.length;Y<c;Y++){d.push(b[Y])}}else{d.push(b)}}return d}Object.extend(V,Enumerable);if(!V._reverse){V._reverse=V.reverse}Object.extend(V,{_each:Q,clear:N,first:E,last:I,compact:K,flatten:X,without:J,reverse:H,uniq:M,intersect:S,clone:T,toArray:T,size:L,inspect:W,toJSON:U});var F=(function(){return[].concat(arguments)[0][0]!==1})(1,2);if(F){V.concat=D}if(!V.indexOf){V.indexOf=A}if(!V.lastIndexOf){V.lastIndexOf=P}})();function $H(A){return new Hash(A)}var Hash=Class.create(Enumerable,(function(){function F(T){this._object=Object.isHash(T)?T.toObject():Object.clone(T)}function H(U){for(var T in this._object){var V=this._object[T],W=[T,V];W.key=T;W.value=V;U(W)}}function M(T,U){return this._object[T]=U}function D(T){if(this._object[T]!==Object.prototype[T]){return this._object[T]}}function P(T){var U=this._object[T];delete this._object[T];return U}function S(){return Object.clone(this._object)}function Q(){return this.pluck("key")}function O(){return this.pluck("value")}function I(U){var T=this.detect(function(V){return V.value===U});return T&&T.key}function K(T){return this.clone().update(T)}function E(T){return new Hash(T).inject(this,function(U,V){U.set(V.key,V.value);return U})}function C(T,U){if(Object.isUndefined(U)){return T}return T+"="+encodeURIComponent(String.interpret(U))}function A(){return this.inject([],function(V,W){var U=encodeURIComponent(W.key),T=W.value;if(T&&typeof T=="object"){if(Object.isArray(T)){return V.concat(T.map(C.curry(U)))}}else{V.push(C(U,T))}return V}).join("&")}function N(){return"#<Hash:{"+this.map(function(T){return T.map(Object.inspect).join(": ")}).join(", ")+"}>"}function L(){return Object.toJSON(this.toObject())}function J(){return new Hash(this)}return{initialize:F,_each:H,set:M,get:D,unset:P,toObject:S,toTemplateReplacements:S,keys:Q,values:O,index:I,merge:K,update:E,toQueryString:A,inspect:N,toJSON:L,clone:J}})());Hash.from=$H;Object.extend(Number.prototype,(function(){function E(){return this.toPaddedString(2,16)}function F(){return this+1}function A(M,L){$R(0,this,true).each(M,L);return this}function C(N,M){var L=this.toString(M||10);return"0".times(N-L.length)+L}function H(){return isFinite(this)?this.toString():"null"}function K(){return Math.abs(this)}function J(){return Math.round(this)}function I(){return Math.ceil(this)}function D(){return Math.floor(this)}return{toColorPart:E,succ:F,times:A,toPaddedString:C,toJSON:H,abs:K,round:J,ceil:I,floor:D}})());function $R(D,A,C){return new ObjectRange(D,A,C)}var ObjectRange=Class.create(Enumerable,(function(){function C(H,E,F){this.start=H;this.end=E;this.exclusive=F}function D(E){var F=this.start;while(this.include(F)){E(F);F=F.succ()}}function A(E){if(E<this.start){return false}if(this.exclusive){return E<this.end}return E<=this.end}return{initialize:C,_each:D,include:A}})());var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(A){this.responders._each(A)},register:function(A){if(!this.include(A)){this.responders.push(A)}},unregister:function(A){this.responders=this.responders.without(A)},dispatch:function(E,C,D,A){this.each(function(F){if(Object.isFunction(F[E])){try{F[E].apply(F,[C,D,A])}catch(H){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(A){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,A||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters)){this.options.parameters=this.options.parameters.toQueryParams()}else{if(Object.isHash(this.options.parameters)){this.options.parameters=this.options.parameters.toObject()}}}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,C,A){$super(A);this.transport=Ajax.getTransport();this.request(C)},request:function(C){this.url=C;this.method=this.options.method;var E=Object.clone(this.options.parameters);if(!["get","post"].include(this.method)){E["_method"]=this.method;this.method="post"}this.parameters=E;if(E=Object.toQueryString(E)){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+E}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){E+="&_="}}}try{var A=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(A)}Ajax.Responders.dispatch("onCreate",this,A);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||E):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(D){this.dispatchException(D)}},onStateChange:function(){var A=this.transport.readyState;if(A>1&&!((A==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var F={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,"Accept":"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){F["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){F["Connection"]="close"}}if(typeof this.options.requestHeaders=="object"){var D=this.options.requestHeaders;if(Object.isFunction(D.push)){for(var C=0,E=D.length;C<E;C+=2){F[D[C]]=D[C+1]}}else{$H(D).each(function(H){F[H.key]=H.value})}}for(var A in F){this.transport.setRequestHeader(A,F[A])}},success:function(){var A=this.getStatus();return !A||(A>=200&&A<300)},getStatus:function(){try{return this.transport.status||0}catch(A){return 0}},respondToReadyState:function(A){var D=Ajax.Request.Events[A],C=new Ajax.Response(this);if(D=="Complete"){try{this._complete=true;(this.options["on"+C.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(C,C.headerJSON)}catch(E){this.dispatchException(E)}var F=C.getHeader("Content-type");if(this.options.evalJS=="force"||(this.options.evalJS&&this.isSameOrigin()&&F&&F.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))){this.evalResponse()}}try{(this.options["on"+D]||Prototype.emptyFunction)(C,C.headerJSON);Ajax.Responders.dispatch("on"+D,this,C,C.headerJSON)}catch(E){this.dispatchException(E)}if(D=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},isSameOrigin:function(){var A=this.url.match(/^\s*https?:\/\/[^\/]*/);return !A||(A[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""}))},getHeader:function(A){try{return this.transport.getResponseHeader(A)||null}catch(C){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(A){(this.options.onException||Prototype.emptyFunction)(this,A);Ajax.Responders.dispatch("onException",this,A)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Response=Class.create({initialize:function(D){this.request=D;var E=this.transport=D.transport,A=this.readyState=E.readyState;if((A>2&&!Prototype.Browser.IE)||A==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(E.responseText);this.headerJSON=this._getHeaderJSON()}if(A==4){var C=E.responseXML;this.responseXML=Object.isUndefined(C)?null:C;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(A){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(A){return null}},getResponseHeader:function(A){return this.transport.getResponseHeader(A)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var A=this.getHeader("X-JSON");if(!A){return null}A=decodeURIComponent(escape(A));try{return A.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(C){this.request.dispatchException(C)}},_getResponseJSON:function(){var A=this.request.options;if(!A.evalJSON||(A.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json"))||this.responseText.blank()){return null}try{return this.responseText.evalJSON(A.sanitizeJSON||!this.request.isSameOrigin())}catch(C){this.request.dispatchException(C)}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,A,D,C){this.container={success:(A.success||A),failure:(A.failure||(A.success?null:A))};C=Object.clone(C);var E=C.onComplete;C.onComplete=(function(F,H){this.updateContent(F.responseText);if(Object.isFunction(E)){E(F,H)}}).bind(this);$super(D,C)},updateContent:function(E){var D=this.container[this.success()?"success":"failure"],A=this.options;if(!A.evalScripts){E=E.stripScripts()}if(D=$(D)){if(A.insertion){if(Object.isString(A.insertion)){var C={};C[A.insertion]=E;D.insert(C)}else{A.insertion(D,E)}}else{D.update(E)}}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,A,D,C){$super(C);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=A;this.url=D;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(A){if(this.options.decay){this.decay=(A.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=A.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});function $(C){if(arguments.length>1){for(var A=0,E=[],D=arguments.length;A<D;A++){E.push($(arguments[A]))}return E}if(Object.isString(C)){C=document.getElementById(C)}return Element.extend(C)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(H,A){var D=[];var F=document.evaluate(H,$(A)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var C=0,E=F.snapshotLength;C<E;C++){D.push(Element.extend(F.snapshotItem(C)))}return D}}if(!window.Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}(function(D){var C=(function(){var H=document.createElement("form");var F=document.createElement("input");var E=document.documentElement;F.setAttribute("name","test");H.appendChild(F);E.appendChild(H);var I=H.elements?(typeof H.elements.test=="undefined"):null;E.removeChild(H);H=F=null;return I})();var A=D.Element;D.Element=function(H,F){F=F||{};H=H.toLowerCase();var E=Element.cache;if(C&&F.name){H="<"+H+' name="'+F.name+'">';delete F.name;return Element.writeAttribute(document.createElement(H),F)}if(!E[H]){E[H]=Element.extend(document.createElement(H))}return Element.writeAttribute(E[H].cloneNode(false),F)};Object.extend(D.Element,A||{});if(A){D.Element.prototype=A.prototype}})(this);Element.cache={};Element.idCounter=1;Element.Methods={visible:function(A){return $(A).style.display!="none"},toggle:function(A){A=$(A);Element[Element.visible(A)?"hide":"show"](A);return A},hide:function(A){A=$(A);A.style.display="none";return A},show:function(A){A=$(A);A.style.display="";return A},remove:function(A){A=$(A);A.parentNode.removeChild(A);return A},update:(function(){var C=(function(){var F=document.createElement("select"),H=true;F.innerHTML='<option value="test">test</option>';if(F.options&&F.options[0]){H=F.options[0].nodeName.toUpperCase()!=="OPTION"}F=null;return H})();var A=(function(){try{var F=document.createElement("table");if(F&&F.tBodies){F.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var I=typeof F.tBodies[0]=="undefined";F=null;return I}}catch(H){return true}})();var E=(function(){var F=document.createElement("script"),I=false;try{F.appendChild(document.createTextNode(""));I=!F.firstChild||F.firstChild&&F.firstChild.nodeType!==3}catch(H){I=true}F=null;return I})();function D(H,I){H=$(H);if(I&&I.toElement){I=I.toElement()}if(Object.isElement(I)){return H.update().insert(I)}I=Object.toHTML(I);var F=H.tagName.toUpperCase();if(F==="SCRIPT"&&E){H.text=I;return H}if(C||A){if(F in Element._insertionTranslations.tags){$A(H.childNodes).each(function(J){H.removeChild(J)});Element._getContentFromAnonymousElement(F,I.stripScripts()).each(function(J){H.appendChild(J)})}else{H.innerHTML=I.stripScripts()}}else{H.innerHTML=I.stripScripts()}I.evalScripts.bind(I).defer();return H}return D})(),replace:function(C,D){C=$(C);if(D&&D.toElement){D=D.toElement()}else{if(!Object.isElement(D)){D=Object.toHTML(D);var A=C.ownerDocument.createRange();A.selectNode(C);D.evalScripts.bind(D).defer();D=A.createContextualFragment(D.stripScripts())}}C.parentNode.replaceChild(D,C);return C},insert:function(D,F){D=$(D);if(Object.isString(F)||Object.isNumber(F)||Object.isElement(F)||(F&&(F.toElement||F.toHTML))){F={bottom:F}}var E,H,C,I;for(var A in F){E=F[A];A=A.toLowerCase();H=Element._insertionTranslations[A];if(E&&E.toElement){E=E.toElement()}if(Object.isElement(E)){H(D,E);continue}E=Object.toHTML(E);C=((A=="before"||A=="after")?D.parentNode:D).tagName.toUpperCase();I=Element._getContentFromAnonymousElement(C,E.stripScripts());if(A=="top"||A=="after"){I.reverse()}I.each(H.curry(D));E.evalScripts.bind(E).defer()}return D},wrap:function(C,D,A){C=$(C);if(Object.isElement(D)){$(D).writeAttribute(A||{})}else{if(Object.isString(D)){D=new Element(D,A)}else{D=new Element("div",D)}}if(C.parentNode){C.parentNode.replaceChild(D,C)}D.appendChild(C);return D},inspect:function(C){C=$(C);var A="<"+C.tagName.toLowerCase();$H({"id":"id","className":"class"}).each(function(H){var F=H.first(),D=H.last();var E=(C[F]||"").toString();if(E){A+=" "+D+"="+E.inspect(true)}});return A+">"},recursivelyCollect:function(A,D){A=$(A);var C=[];while(A=A[D]){if(A.nodeType==1){C.push(Element.extend(A))}}return C},ancestors:function(A){return $(A).recursivelyCollect("parentNode")},descendants:function(A){return Element.select(A,"*")},firstDescendant:function(A){A=$(A).firstChild;while(A&&A.nodeType!=1){A=A.nextSibling}return $(A)},immediateDescendants:function(A){if(!(A=$(A).firstChild)){return[]}while(A&&A.nodeType!=1){A=A.nextSibling}if(A){return[A].concat($(A).nextSiblings())}return[]},previousSiblings:function(A){return $(A).recursivelyCollect("previousSibling")},nextSiblings:function(A){return $(A).recursivelyCollect("nextSibling")},siblings:function(A){A=$(A);return A.previousSiblings().reverse().concat(A.nextSiblings())},match:function(C,A){if(Object.isString(A)){A=new Selector(A)}return A.match($(C))},up:function(C,E,A){C=$(C);if(arguments.length==1){return $(C.parentNode)}var D=C.ancestors();return Object.isNumber(E)?D[E]:Selector.findElement(D,E,A)},down:function(C,D,A){C=$(C);if(arguments.length==1){return C.firstDescendant()}return Object.isNumber(D)?C.descendants()[D]:Element.select(C,D)[A||0]},previous:function(C,E,A){C=$(C);if(arguments.length==1){return $(Selector.handlers.previousElementSibling(C))}var D=C.previousSiblings();return Object.isNumber(E)?D[E]:Selector.findElement(D,E,A)},next:function(D,E,C){D=$(D);if(arguments.length==1){return $(Selector.handlers.nextElementSibling(D))}var A=D.nextSiblings();return Object.isNumber(E)?A[E]:Selector.findElement(A,E,C)},select:function(){var A=$A(arguments),C=$(A.shift());return Selector.findChildElements(C,A)},adjacent:function(){var A=$A(arguments),C=$(A.shift());return Selector.findChildElements(C.parentNode,A).without(C)},identify:function(A){A=$(A);var C=A.readAttribute("id");if(C){return C}do{C="anonymous_element_"+Element.idCounter++}while($(C));A.writeAttribute("id",C);return C},readAttribute:(function(){var A=(function(){var C=document.createElement("iframe"),E=false;document.documentElement.appendChild(C);try{C.getAttribute("type",2)}catch(D){E=true}document.documentElement.removeChild(C);C=null;return E})();return function(E,C){E=$(E);if(A&&C==="type"&&E.tagName.toUpperCase()=="IFRAME"){return E.getAttribute("type")}if(Prototype.Browser.IE){var D=Element._attributeTranslations.read;if(D.values[C]){return D.values[C](E,C)}if(D.names[C]){C=D.names[C]}if(C.include(":")){return(!E.attributes||!E.attributes[C])?null:E.attributes[C].value}}return E.getAttribute(C)}})(),writeAttribute:function(F,D,H){F=$(F);var C={},E=Element._attributeTranslations.write;if(typeof D=="object"){C=D}else{C[D]=Object.isUndefined(H)?true:H}for(var A in C){D=E.names[A]||A;H=C[A];if(E.values[A]){D=E.values[A](F,H)}if(H===false||H===null){F.removeAttribute(D)}else{if(H===true){F.setAttribute(D,D)}else{F.setAttribute(D,H)}}}return F},getHeight:function(A){return $(A).getDimensions().height},getWidth:function(A){return $(A).getDimensions().width},classNames:function(A){return new Element.ClassNames(A)},hasClassName:function(A,C){if(!(A=$(A))){return }var D=A.className;return(D.length>0&&(D==C||new RegExp("(^|\\s)"+C+"(\\s|$)").test(D)))},addClassName:function(A,C){if(!(A=$(A))){return }if(!A.hasClassName(C)){A.className+=(A.className?" ":"")+C}return A},removeClassName:function(A,C){if(!(A=$(A))){return }A.className=A.className.replace(new RegExp("(^|\\s+)"+C+"(\\s+|$)")," ").strip();return A},toggleClassName:function(A,C){if(!(A=$(A))){return }return A[A.hasClassName(C)?"removeClassName":"addClassName"](C)},cleanWhitespace:function(C){C=$(C);var D=C.firstChild;while(D){var A=D.nextSibling;if(D.nodeType==3&&!/\S/.test(D.nodeValue)){C.removeChild(D)}D=A}return C},empty:function(A){return $(A).innerHTML.blank()},descendantOf:function(C,A){C=$(C),A=$(A);if(C.compareDocumentPosition){return(C.compareDocumentPosition(A)&8)===8}if(A.contains){return A.contains(C)&&A!==C}while(C=C.parentNode){if(C==A){return true}}return false},scrollTo:function(A){A=$(A);var C=A.cumulativeOffset();window.scrollTo(C[0],C[1]);return A},getStyle:function(C,D){C=$(C);D=D=="float"?"cssFloat":D.camelize();var E=C.style[D];if(!E||E=="auto"){var A=document.defaultView.getComputedStyle(C,null);E=A?A[D]:null}if(D=="opacity"){return E?parseFloat(E):1}return E=="auto"?null:E},getOpacity:function(A){return $(A).getStyle("opacity")},setStyle:function(C,D){C=$(C);var F=C.style,A;if(Object.isString(D)){C.style.cssText+=";"+D;return D.include("opacity")?C.setOpacity(D.match(/opacity:\s*(\d?\.?\d*)/)[1]):C}for(var E in D){if(E=="opacity"){C.setOpacity(D[E])}else{F[(E=="float"||E=="cssFloat")?(Object.isUndefined(F.styleFloat)?"cssFloat":"styleFloat"):E]=D[E]}}return C},setOpacity:function(A,C){A=$(A);A.style.opacity=(C==1||C==="")?"":(C<0.00001)?0:C;return A},getDimensions:function(D){D=$(D);var I=D.getStyle("display");if(I!="none"&&I!=null){return{width:D.offsetWidth,height:D.offsetHeight}}var C=D.style;var H=C.visibility;var E=C.position;var A=C.display;C.visibility="hidden";if(E!="fixed"){C.position="absolute"}C.display="block";var J=D.clientWidth;var F=D.clientHeight;C.display=A;C.position=E;C.visibility=H;return{width:J,height:F}},makePositioned:function(A){A=$(A);var C=Element.getStyle(A,"position");if(C=="static"||!C){A._madePositioned=true;A.style.position="relative";if(Prototype.Browser.Opera){A.style.top=0;A.style.left=0}}return A},undoPositioned:function(A){A=$(A);if(A._madePositioned){A._madePositioned=undefined;A.style.position=A.style.top=A.style.left=A.style.bottom=A.style.right=""}return A},makeClipping:function(A){A=$(A);if(A._overflow){return A}A._overflow=Element.getStyle(A,"overflow")||"auto";if(A._overflow!=="hidden"){A.style.overflow="hidden"}return A},undoClipping:function(A){A=$(A);if(!A._overflow){return A}A.style.overflow=A._overflow=="auto"?"":A._overflow;A._overflow=null;return A},cumulativeOffset:function(C){var A=0,D=0;do{A+=C.offsetTop||0;D+=C.offsetLeft||0;C=C.offsetParent}while(C);return Element._returnOffset(D,A)},positionedOffset:function(C){var A=0,E=0;do{A+=C.offsetTop||0;E+=C.offsetLeft||0;C=C.offsetParent;if(C){if(C.tagName.toUpperCase()=="BODY"){break}var D=Element.getStyle(C,"position");if(D!=="static"){break}}}while(C);return Element._returnOffset(E,A)},absolutize:function(C){C=$(C);if(C.getStyle("position")=="absolute"){return C}var E=C.positionedOffset();var H=E[1];var F=E[0];var D=C.clientWidth;var A=C.clientHeight;C._originalLeft=F-parseFloat(C.style.left||0);C._originalTop=H-parseFloat(C.style.top||0);C._originalWidth=C.style.width;C._originalHeight=C.style.height;C.style.position="absolute";C.style.top=H+"px";C.style.left=F+"px";C.style.width=D+"px";C.style.height=A+"px";return C},relativize:function(A){A=$(A);if(A.getStyle("position")=="relative"){return A}A.style.position="relative";var D=parseFloat(A.style.top||0)-(A._originalTop||0);var C=parseFloat(A.style.left||0)-(A._originalLeft||0);A.style.top=D+"px";A.style.left=C+"px";A.style.height=A._originalHeight;A.style.width=A._originalWidth;return A},cumulativeScrollOffset:function(C){var A=0,D=0;do{A+=C.scrollTop||0;D+=C.scrollLeft||0;C=C.parentNode}while(C);return Element._returnOffset(D,A)},getOffsetParent:function(A){if(A.offsetParent){return $(A.offsetParent)}if(A==document.body){return $(A)}while((A=A.parentNode)&&A!=document.body){if(Element.getStyle(A,"position")!="static"){return $(A)}}return $(document.body)},viewportOffset:function(E){var A=0,D=0;var C=E;do{A+=C.offsetTop||0;D+=C.offsetLeft||0;if(C.offsetParent==document.body&&Element.getStyle(C,"position")=="absolute"){break}}while(C=C.offsetParent);C=E;do{if(!Prototype.Browser.Opera||(C.tagName&&(C.tagName.toUpperCase()=="BODY"))){A-=C.scrollTop||0;D-=C.scrollLeft||0}}while(C=C.parentNode);return Element._returnOffset(D,A)},clonePosition:function(C,E){var A=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});E=$(E);var F=E.viewportOffset();C=$(C);var H=[0,0];var D=null;if(Element.getStyle(C,"position")=="absolute"){D=C.getOffsetParent();H=D.viewportOffset()}if(D==document.body){H[0]-=document.body.offsetLeft;H[1]-=document.body.offsetTop}if(A.setLeft){C.style.left=(F[0]-H[0]+A.offsetLeft)+"px"}if(A.setTop){C.style.top=(F[1]-H[1]+A.offsetTop)+"px"}if(A.setWidth){C.style.width=E.offsetWidth+"px"}if(A.setHeight){C.style.height=E.offsetHeight+"px"}return C}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(E,C,D){switch(D){case"left":case"top":case"right":case"bottom":if(E(C,"position")==="static"){return null}case"height":case"width":if(!Element.visible(C)){return null}var F=parseInt(E(C,D),10);if(F!==C["offset"+D.capitalize()]){return F+"px"}var A;if(D==="height"){A=["border-top-width","padding-top","padding-bottom","border-bottom-width"]}else{A=["border-left-width","padding-left","padding-right","border-right-width"]}return A.inject(F,function(H,I){var J=E(C,I);return J===null?H:H-parseInt(J,10)})+"px";default:return E(C,D)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(D,A,C){if(C==="title"){return A.title}return D(A,C)})}else{if(Prototype.Browser.IE){Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(D,C){C=$(C);try{C.offsetParent}catch(F){return $(document.body)}var A=C.getStyle("position");if(A!=="static"){return D(C)}C.setStyle({position:"relative"});var E=D(C);C.setStyle({position:A});return E});$w("positionedOffset viewportOffset").each(function(A){Element.Methods[A]=Element.Methods[A].wrap(function(F,D){D=$(D);try{D.offsetParent}catch(I){return Element._returnOffset(0,0)}var C=D.getStyle("position");if(C!=="static"){return F(D)}var E=D.getOffsetParent();if(E&&E.getStyle("position")==="fixed"){E.setStyle({zoom:1})}D.setStyle({position:"relative"});var H=F(D);D.setStyle({position:C});return H})});Element.Methods.cumulativeOffset=Element.Methods.cumulativeOffset.wrap(function(C,A){try{A.offsetParent}catch(D){return Element._returnOffset(0,0)}return C(A)});Element.Methods.getStyle=function(A,C){A=$(A);C=(C=="float"||C=="cssFloat")?"styleFloat":C.camelize();var D=A.style[C];if(!D&&A.currentStyle){D=A.currentStyle[C]}if(C=="opacity"){if(D=(A.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(D[1]){return parseFloat(D[1])/100}}return 1}if(D=="auto"){if((C=="width"||C=="height")&&(A.getStyle("display")!="none")){return A["offset"+C.capitalize()]+"px"}return null}return D};Element.Methods.setOpacity=function(C,F){function H(I){return I.replace(/alpha\([^\)]*\)/gi,"")}C=$(C);var A=C.currentStyle;if((A&&!A.hasLayout)||(!A&&C.style.zoom=="normal")){C.style.zoom=1}var E=C.getStyle("filter"),D=C.style;if(F==1||F===""){(E=H(E))?D.filter=E:D.removeAttribute("filter");return C}else{if(F<0.00001){F=0}}D.filter=H(E)+"alpha(opacity="+(F*100)+")";return C};Element._attributeTranslations=(function(){var C="className";var A="for";var D=document.createElement("div");D.setAttribute(C,"x");if(D.className!=="x"){D.setAttribute("class","x");if(D.className==="x"){C="class"}}D=null;D=document.createElement("label");D.setAttribute(A,"x");if(D.htmlFor!=="x"){D.setAttribute("htmlFor","x");if(D.htmlFor==="x"){A="htmlFor"}}D=null;return{read:{names:{"class":C,"className":C,"for":A,"htmlFor":A},values:{_getAttr:function(E,F){return E.getAttribute(F,2)},_getAttrNode:function(E,H){var F=E.getAttributeNode(H);return F?F.value:""},_getEv:(function(){var E=document.createElement("div");E.onclick=Prototype.emptyFunction;var H=E.getAttribute("onclick");var F;if(String(H).indexOf("{")>-1){F=function(I,J){J=I.getAttribute(J);if(!J){return null}J=J.toString();J=J.split("{")[1];J=J.split("}")[0];return J.strip()}}else{if(H===""){F=function(I,J){J=I.getAttribute(J);if(!J){return null}return J.strip()}}}E=null;return F})(),_flag:function(E,F){return $(E).hasAttribute(F)?F:null},style:function(E){return E.style.cssText.toLowerCase()},title:function(E){return E.title}}}}})();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(A,C){A.checked=!!C},style:function(A,C){A.style.cssText=C?C:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(A){Element._attributeTranslations.write.names[A.toLowerCase()]=A;Element._attributeTranslations.has[A.toLowerCase()]=A});(function(A){Object.extend(A,{href:A._getAttr,src:A._getAttr,type:A._getAttr,action:A._getAttrNode,disabled:A._flag,checked:A._flag,readonly:A._flag,multiple:A._flag,onload:A._getEv,onunload:A._getEv,onclick:A._getEv,ondblclick:A._getEv,onmousedown:A._getEv,onmouseup:A._getEv,onmouseover:A._getEv,onmousemove:A._getEv,onmouseout:A._getEv,onfocus:A._getEv,onblur:A._getEv,onkeypress:A._getEv,onkeydown:A._getEv,onkeyup:A._getEv,onsubmit:A._getEv,onreset:A._getEv,onselect:A._getEv,onchange:A._getEv})})(Element._attributeTranslations.read.values);if(Prototype.BrowserFeatures.ElementExtensions){(function(){function A(F){var C=F.getElementsByTagName("*"),E=[];for(var D=0,H;H=C[D];D++){if(H.tagName!=="!"){E.push(H)}}return E}Element.Methods.down=function(D,E,C){D=$(D);if(arguments.length==1){return D.firstDescendant()}return Object.isNumber(E)?A(D)[E]:Element.select(D,E)[C||0]}})()}}else{if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(A,C){A=$(A);A.style.opacity=(C==1)?0.999999:(C==="")?"":(C<0.00001)?0:C;return A}}else{if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(A,C){A=$(A);A.style.opacity=(C==1||C==="")?"":(C<0.00001)?0:C;if(C==1){if(A.tagName.toUpperCase()=="IMG"&&A.width){A.width++;A.width--}else{try{var E=document.createTextNode(" ");A.appendChild(E);A.removeChild(E)}catch(D){}}}return A};Element.Methods.cumulativeOffset=function(C){var A=0,D=0;do{A+=C.offsetTop||0;D+=C.offsetLeft||0;if(C.offsetParent==document.body){if(Element.getStyle(C,"position")=="absolute"){break}}C=C.offsetParent}while(C);return Element._returnOffset(D,A)}}}}}if("outerHTML" in document.documentElement){Element.Methods.replace=function(D,F){D=$(D);if(F&&F.toElement){F=F.toElement()}if(Object.isElement(F)){D.parentNode.replaceChild(F,D);return D}F=Object.toHTML(F);var E=D.parentNode,C=E.tagName.toUpperCase();if(Element._insertionTranslations.tags[C]){var H=D.next();var A=Element._getContentFromAnonymousElement(C,F.stripScripts());E.removeChild(D);if(H){A.each(function(I){E.insertBefore(I,H)})}else{A.each(function(I){E.appendChild(I)})}}else{D.outerHTML=F.stripScripts()}F.evalScripts.bind(F).defer();return D}}Element._returnOffset=function(C,D){var A=[C,D];A.left=C;A.top=D;return A};Element._getContentFromAnonymousElement=function(D,C){var E=new Element("div"),A=Element._insertionTranslations.tags[D];if(A){E.innerHTML=A[0]+C+A[1];A[2].times(function(){E=E.firstChild})}else{E.innerHTML=C}return $A(E.childNodes)};Element._insertionTranslations={before:function(A,C){A.parentNode.insertBefore(C,A)},top:function(A,C){A.insertBefore(C,A.firstChild)},bottom:function(A,C){A.appendChild(C)},after:function(A,C){A.parentNode.insertBefore(C,A.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};(function(){Object.extend(this.tags,{THEAD:this.tags.TBODY,TFOOT:this.tags.TBODY,TH:this.tags.TD})}).call(Element._insertionTranslations);Element.Methods.Simulated={hasAttribute:function(A,D){D=Element._attributeTranslations.has[D]||D;var C=$(A).getAttributeNode(D);return !!(C&&C.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);(function(A){if(!Prototype.BrowserFeatures.ElementExtensions&&A["__proto__"]){window.HTMLElement={};window.HTMLElement.prototype=A["__proto__"];Prototype.BrowserFeatures.ElementExtensions=true}A=null})(document.createElement("div"));Element.extend=(function(){function D(J){if(typeof window.Element!="undefined"){var L=window.Element.prototype;if(L){var N="_"+(Math.random()+"").slice(2);var K=document.createElement(J);L[N]="x";var M=(K[N]!=="x");delete L[N];K=null;return M}}return false}function C(K,J){for(var M in J){var L=J[M];if(Object.isFunction(L)&&!(M in K)){K[M]=L.methodize()}}}var E=D("object");var H=D("applet");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(E&&H){return function(K){if(K&&K.tagName){var J=K.tagName.toUpperCase();if(J==="OBJECT"||J==="APPLET"){C(K,Element.Methods);if(J==="OBJECT"){C(K,Element.Methods.ByTag.OBJECT)}else{if(J==="APPLET"){C(K,Element.Methods.ByTag.APPLET)}}}}return K}}return Prototype.K}var A={},F=Element.Methods.ByTag;var I=Object.extend(function(L){if(!L||typeof L._extendedByPrototype!="undefined"||L.nodeType!=1||L==window){return L}var J=Object.clone(A),K=L.tagName.toUpperCase();if(F[K]){Object.extend(J,F[K])}C(L,J);L._extendedByPrototype=Prototype.emptyFunction;return L},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(A,Element.Methods);Object.extend(A,Element.Methods.Simulated)}}});I.refresh();return I})();Element.hasAttribute=function(A,C){if(A.hasAttribute){return A.hasAttribute(C)}return Element.Methods.Simulated.hasAttribute(A,C)};Element.addMethods=function(D){var L=Prototype.BrowserFeatures,E=Element.Methods.ByTag;if(!D){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{"FORM":Object.clone(Form.Methods),"INPUT":Object.clone(Form.Element.Methods),"SELECT":Object.clone(Form.Element.Methods),"TEXTAREA":Object.clone(Form.Element.Methods)})}if(arguments.length==2){var C=D;D=arguments[1]}if(!C){Object.extend(Element.Methods,D||{})}else{if(Object.isArray(C)){C.each(J)}else{J(C)}}function J(F){F=F.toUpperCase();if(!Element.Methods.ByTag[F]){Element.Methods.ByTag[F]={}}Object.extend(Element.Methods.ByTag[F],D)}function A(O,N,F){F=F||false;for(var Q in O){var P=O[Q];if(!Object.isFunction(P)){continue}if(!F||!(Q in N)){N[Q]=P.methodize()}}}function H(P){var F;var O={"OPTGROUP":"OptGroup","TEXTAREA":"TextArea","P":"Paragraph","FIELDSET":"FieldSet","UL":"UList","OL":"OList","DL":"DList","DIR":"Directory","H1":"Heading","H2":"Heading","H3":"Heading","H4":"Heading","H5":"Heading","H6":"Heading","Q":"Quote","INS":"Mod","DEL":"Mod","A":"Anchor","IMG":"Image","CAPTION":"TableCaption","COL":"TableCol","COLGROUP":"TableCol","THEAD":"TableSection","TFOOT":"TableSection","TBODY":"TableSection","TR":"TableRow","TH":"TableCell","TD":"TableCell","FRAMESET":"FrameSet","IFRAME":"IFrame"};if(O[P]){F="HTML"+O[P]+"Element"}if(window[F]){return window[F]}F="HTML"+P+"Element";if(window[F]){return window[F]}F="HTML"+P.capitalize()+"Element";if(window[F]){return window[F]}var N=document.createElement(P);var Q=N["__proto__"]||N.constructor.prototype;N=null;return Q}var K=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(L.ElementExtensions){A(Element.Methods,K);A(Element.Methods.Simulated,K,true)}if(L.SpecificElementExtensions){for(var M in Element.Methods.ByTag){var I=H(M);if(Object.isUndefined(I)){continue}A(E[M],I.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh){Element.extend.refresh()}Element.cache={}};document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};(function(C){var I=Prototype.Browser,F=document,D,E={};function A(){if(I.WebKit&&!F.evaluate){return document}if(I.Opera&&window.parseFloat(window.opera.version())<9.5){return document.body}return document.documentElement}function H(J){if(!D){D=A()}E[J]="client"+J;C["get"+J]=function(){return D[E[J]]};return C["get"+J]()}C.getWidth=H.curry("Width");C.getHeight=H.curry("Height")})(document.viewport);Element.Storage={UID:1};Element.addMethods({getStorage:function(C){if(!(C=$(C))){return }var A;if(C===window){A=0}else{if(typeof C._prototypeUID==="undefined"){C._prototypeUID=[Element.Storage.UID++]}A=C._prototypeUID[0]}if(!Element.Storage[A]){Element.Storage[A]=$H()}return Element.Storage[A]},store:function(C,A,D){if(!(C=$(C))){return }if(arguments.length===2){C.getStorage().update(A)}else{C.getStorage().set(A,D)}return C},retrieve:function(D,C,A){if(!(D=$(D))){return }var F=Element.getStorage(D),E=F.get(C);if(Object.isUndefined(E)){F.set(C,A);E=A}return E},clone:function(D,A){if(!(D=$(D))){return }var F=D.cloneNode(A);F._prototypeUID=void 0;if(A){var E=Element.select(F,"*"),C=E.length;while(C--){E[C]._prototypeUID=void 0}}return Element.extend(F)}});var Selector=Class.create({initialize:function(A){this.expression=A.strip();if(this.shouldUseSelectorsAPI()){this.mode="selectorsAPI"}else{if(this.shouldUseXPath()){this.mode="xpath";this.compileXPathMatcher()}else{this.mode="normal";this.compileMatcher()}}},shouldUseXPath:(function(){var A=(function(){var F=false;if(document.evaluate&&window.XPathResult){var E=document.createElement("div");E.innerHTML="<ul><li></li></ul><div><ul><li></li></ul></div>";var D=".//*[local-name()='ul' or local-name()='UL']//*[local-name()='li' or local-name()='LI']";var C=document.evaluate(D,E,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);F=(C.snapshotLength!==2);E=null}return F})();return function(){if(!Prototype.BrowserFeatures.XPath){return false}var C=this.expression;if(Prototype.Browser.WebKit&&(C.include("-of-type")||C.include(":empty"))){return false}if((/(\[[\w-]*?:|:checked)/).test(C)){return false}if(A){return false}return true}})(),shouldUseSelectorsAPI:function(){if(!Prototype.BrowserFeatures.SelectorsAPI){return false}if(Selector.CASE_INSENSITIVE_CLASS_NAMES){return false}if(!Selector._div){Selector._div=new Element("div")}try{Selector._div.querySelector(this.expression)}catch(A){return false}return true},compileMatcher:function(){var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m,len=ps.length,name;if(Selector._cache[e]){this.matcher=Selector._cache[e];return }this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i=0;i<len;i++){p=ps[i].re;name=ps[i].name;if(m=e.match(p)){this.matcher.push(Object.isFunction(c[name])?c[name](m):new Template(c[name]).evaluate(m));e=e.replace(m[0],"");break}}}this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join("\n"));Selector._cache[this.expression]=this.matcher},compileXPathMatcher:function(){var I=this.expression,J=Selector.patterns,D=Selector.xpath,H,C,A=J.length,E;if(Selector._cache[I]){this.xpath=Selector._cache[I];return }this.matcher=[".//*"];while(I&&H!=I&&(/\S/).test(I)){H=I;for(var F=0;F<A;F++){E=J[F].name;if(C=I.match(J[F].re)){this.matcher.push(Object.isFunction(D[E])?D[E](C):new Template(D[E]).evaluate(C));I=I.replace(C[0],"");break}}}this.xpath=this.matcher.join("");Selector._cache[this.expression]=this.xpath},findElements:function(A){A=A||document;var D=this.expression,C;switch(this.mode){case"selectorsAPI":if(A!==document){var E=A.id,F=$(A).identify();F=F.replace(/[\.:]/g,"\\$0");D="#"+F+" "+D}C=$A(A.querySelectorAll(D)).map(Element.extend);A.id=E;return C;case"xpath":return document._getElementsByXPath(this.xpath,A);default:return this.matcher(A)}},match:function(K){this.tokens=[];var O=this.expression,A=Selector.patterns,F=Selector.assertions;var C,E,H,N=A.length,D;while(O&&C!==O&&(/\S/).test(O)){C=O;for(var J=0;J<N;J++){E=A[J].re;D=A[J].name;if(H=O.match(E)){if(F[D]){this.tokens.push([D,Object.clone(H)]);O=O.replace(H[0],"")}else{return this.findElements(document).include(K)}}}}var M=true,D,L;for(var J=0,I;I=this.tokens[J];J++){D=I[0],L=I[1];if(!Selector.assertions[D](K,L)){M=false;break}}return M},toString:function(){return this.expression},inspect:function(){return"#<Selector:"+this.expression.inspect()+">"}});if(Prototype.BrowserFeatures.SelectorsAPI&&document.compatMode==="BackCompat"){Selector.CASE_INSENSITIVE_CLASS_NAMES=(function(){var D=document.createElement("div"),A=document.createElement("span");D.id="prototype_test_id";A.className="Test";D.appendChild(A);var C=(D.querySelector("#prototype_test_id .test")!==null);D=A=null;return C})()}Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:"/following-sibling::*",tagName:function(A){if(A[1]=="*"){return""}return"[local-name()='"+A[1].toLowerCase()+"' or local-name()='"+A[1].toUpperCase()+"']"},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:function(A){A[1]=A[1].toLowerCase();return new Template("[@#{1}]").evaluate(A)},attr:function(A){A[1]=A[1].toLowerCase();A[3]=A[5]||A[6];return new Template(Selector.xpath.operators[A[2]]).evaluate(A)},pseudo:function(A){var C=Selector.xpath.pseudos[A[1]];if(!C){return""}if(Object.isFunction(C)){return C(A)}return new Template(Selector.xpath.pseudos[A[1]]).evaluate(A)},operators:{"=":"[@#{1}='#{3}']","!=":"[@#{1}!='#{3}']","^=":"[starts-with(@#{1}, '#{3}')]","$=":"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']","*=":"[contains(@#{1}, '#{3}')]","~=":"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]","|=":"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{"first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","only-child":"[not(preceding-sibling::* or following-sibling::*)]","empty":"[count(*) = 0 and (count(text()) = 0)]","checked":"[@checked]","disabled":"[(@disabled) and (@type!='hidden')]","enabled":"[not(@disabled) and (@type!='hidden')]","not":function(F){var J=F[6],D=Selector.patterns,K=Selector.xpath,A,L,I=D.length,C;var E=[];while(J&&A!=J&&(/\S/).test(J)){A=J;for(var H=0;H<I;H++){C=D[H].name;if(F=J.match(D[H].re)){L=Object.isFunction(K[C])?K[C](F):new Template(K[C]).evaluate(F);E.push("("+L.substring(1,L.length-1)+")");J=J.replace(F[0],"");break}}}return"[not("+E.join(" and ")+")]"},"nth-child":function(A){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",A)},"nth-last-child":function(A){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",A)},"nth-of-type":function(A){return Selector.xpath.pseudos.nth("position() ",A)},"nth-last-of-type":function(A){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",A)},"first-of-type":function(A){A[6]="1";return Selector.xpath.pseudos["nth-of-type"](A)},"last-of-type":function(A){A[6]="1";return Selector.xpath.pseudos["nth-last-of-type"](A)},"only-of-type":function(A){var C=Selector.xpath.pseudos;return C["first-of-type"](A)+C["last-of-type"](A)},nth:function(F,D){var H,I=D[6],C;if(I=="even"){I="2n+0"}if(I=="odd"){I="2n+1"}if(H=I.match(/^(\d+)$/)){return"["+F+"= "+H[1]+"]"}if(H=I.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(H[1]=="-"){H[1]=-1}var E=H[1]?Number(H[1]):1;var A=H[2]?Number(H[2]):0;C="[((#{fragment} - #{b}) mod #{a} = 0) and ((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(C).evaluate({fragment:F,a:E,b:A})}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);      c = false;',className:'n = h.className(n, r, "#{1}", c);    c = false;',id:'n = h.id(n, r, "#{1}", c);           c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}", c); c = false;',attr:function(A){A[3]=(A[5]||A[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;').evaluate(A)},pseudo:function(A){if(A[6]){A[6]=A[6].replace(/"/g,'\\"')}return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(A)},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:[{name:"laterSibling",re:/^\s*~\s*/},{name:"child",re:/^\s*>\s*/},{name:"adjacent",re:/^\s*\+\s*/},{name:"descendant",re:/^\s/},{name:"tagName",re:/^\s*(\*|[\w\-]+)(\b|$)?/},{name:"id",re:/^#([\w\-\*]+)(\b|$)/},{name:"className",re:/^\.([\w\-\*]+)(\b|$)/},{name:"pseudo",re:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/},{name:"attrPresence",re:/^\[((?:[\w-]+:)?[\w-]+)\]/},{name:"attr",re:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/}],assertions:{tagName:function(A,C){return C[1].toUpperCase()==A.tagName.toUpperCase()},className:function(A,C){return Element.hasClassName(A,C[1])},id:function(A,C){return A.id===C[1]},attrPresence:function(A,C){return Element.hasAttribute(A,C[1])},attr:function(C,D){var A=Element.readAttribute(C,D[1]);return A&&Selector.operators[D[2]](A,D[5]||D[6])}},handlers:{concat:function(C,A){for(var D=0,E;E=A[D];D++){C.push(E)}return C},mark:function(A){var E=Prototype.emptyFunction;for(var C=0,D;D=A[C];C++){D._countedByPrototype=E}return A},unmark:function(A){for(var C=0,D;D=A[C];C++){D._countedByPrototype=undefined}return A},index:function(A,E,I){A._countedByPrototype=Prototype.emptyFunction;if(E){for(var C=A.childNodes,F=C.length-1,D=1;F>=0;F--){var H=C[F];if(H.nodeType==1&&(!I||H._countedByPrototype)){H.nodeIndex=D++}}}else{for(var F=0,D=1,C=A.childNodes;H=C[F];F++){if(H.nodeType==1&&(!I||H._countedByPrototype)){H.nodeIndex=D++}}}},unique:function(C){if(C.length==0){return C}var E=[],F;for(var D=0,A=C.length;D<A;D++){if(typeof (F=C[D])._countedByPrototype=="undefined"){F._countedByPrototype=Prototype.emptyFunction;E.push(Element.extend(F))}}return Selector.handlers.unmark(E)},descendant:function(A){var E=Selector.handlers;for(var D=0,C=[],F;F=A[D];D++){E.concat(C,F.getElementsByTagName("*"))}return C},child:function(A){var F=Selector.handlers;for(var E=0,D=[],H;H=A[E];E++){for(var C=0,I;I=H.childNodes[C];C++){if(I.nodeType==1&&I.tagName!="!"){D.push(I)}}}return D},adjacent:function(A){for(var D=0,C=[],F;F=A[D];D++){var E=this.nextElementSibling(F);if(E){C.push(E)}}return C},laterSibling:function(A){var E=Selector.handlers;for(var D=0,C=[],F;F=A[D];D++){E.concat(C,Element.nextSiblings(F))}return C},nextElementSibling:function(A){while(A=A.nextSibling){if(A.nodeType==1){return A}}return null},previousElementSibling:function(A){while(A=A.previousSibling){if(A.nodeType==1){return A}}return null},tagName:function(A,J,D,C){var K=D.toUpperCase();var F=[],I=Selector.handlers;if(A){if(C){if(C=="descendant"){for(var H=0,E;E=A[H];H++){I.concat(F,E.getElementsByTagName(D))}return F}else{A=this[C](A)}if(D=="*"){return A}}for(var H=0,E;E=A[H];H++){if(E.tagName.toUpperCase()===K){F.push(E)}}return F}else{return J.getElementsByTagName(D)}},id:function(A,K,C,D){var J=$(C),I=Selector.handlers;if(K==document){if(!J){return[]}if(!A){return[J]}}else{if(!K.sourceIndex||K.sourceIndex<1){var A=K.getElementsByTagName("*");for(var F=0,E;E=A[F];F++){if(E.id===C){return[E]}}}}if(A){if(D){if(D=="child"){for(var H=0,E;E=A[H];H++){if(J.parentNode==E){return[J]}}}else{if(D=="descendant"){for(var H=0,E;E=A[H];H++){if(Element.descendantOf(J,E)){return[J]}}}else{if(D=="adjacent"){for(var H=0,E;E=A[H];H++){if(Selector.handlers.previousElementSibling(J)==E){return[J]}}}else{A=I[D](A)}}}}for(var H=0,E;E=A[H];H++){if(E==J){return[J]}}return[]}return(J&&Element.descendantOf(J,K))?[J]:[]},className:function(C,A,D,E){if(C&&E){C=this[E](C)}return Selector.handlers.byClassName(C,A,D)},byClassName:function(D,C,H){if(!D){D=Selector.handlers.descendant([C])}var J=" "+H+" ";for(var F=0,E=[],I,A;I=D[F];F++){A=I.className;if(A.length==0){continue}if(A==H||(" "+A+" ").include(J)){E.push(I)}}return E},attrPresence:function(D,C,A,I){if(!D){D=C.getElementsByTagName("*")}if(D&&I){D=this[I](D)}var F=[];for(var E=0,H;H=D[E];E++){if(Element.hasAttribute(H,A)){F.push(H)}}return F},attr:function(A,K,J,L,D,C){if(!A){A=K.getElementsByTagName("*")}if(A&&C){A=this[C](A)}var M=Selector.operators[D],H=[];for(var F=0,E;E=A[F];F++){var I=Element.readAttribute(E,J);if(I===null){continue}if(M(I,L)){H.push(E)}}return H},pseudo:function(C,D,F,A,E){if(C&&E){C=this[E](C)}if(!C){C=A.getElementsByTagName("*")}return Selector.pseudos[D](C,F,A)}},pseudos:{"first-child":function(C,H,A){for(var E=0,D=[],F;F=C[E];E++){if(Selector.handlers.previousElementSibling(F)){continue}D.push(F)}return D},"last-child":function(C,H,A){for(var E=0,D=[],F;F=C[E];E++){if(Selector.handlers.nextElementSibling(F)){continue}D.push(F)}return D},"only-child":function(C,I,A){var F=Selector.handlers;for(var E=0,D=[],H;H=C[E];E++){if(!F.previousElementSibling(H)&&!F.nextElementSibling(H)){D.push(H)}}return D},"nth-child":function(C,D,A){return Selector.pseudos.nth(C,D,A)},"nth-last-child":function(C,D,A){return Selector.pseudos.nth(C,D,A,true)},"nth-of-type":function(C,D,A){return Selector.pseudos.nth(C,D,A,false,true)},"nth-last-of-type":function(C,D,A){return Selector.pseudos.nth(C,D,A,true,true)},"first-of-type":function(C,D,A){return Selector.pseudos.nth(C,"1",A,false,true)},"last-of-type":function(C,D,A){return Selector.pseudos.nth(C,"1",A,true,true)},"only-of-type":function(C,E,A){var D=Selector.pseudos;return D["last-of-type"](D["first-of-type"](C,E,A),E,A)},getIndices:function(C,A,D){if(C==0){return A>0?[A]:[]}return $R(1,D).inject([],function(E,F){if(0==(F-A)%C&&(F-A)/C>=0){E.push(F)}return E})},nth:function(A,N,P,M,D){if(A.length==0){return[]}if(N=="even"){N="2n+0"}if(N=="odd"){N="2n+1"}var L=Selector.handlers,K=[],C=[],F;L.mark(A);for(var J=0,E;E=A[J];J++){if(!E.parentNode._countedByPrototype){L.index(E.parentNode,M,D);C.push(E.parentNode)}}if(N.match(/^\d+$/)){N=Number(N);for(var J=0,E;E=A[J];J++){if(E.nodeIndex==N){K.push(E)}}}else{if(F=N.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(F[1]=="-"){F[1]=-1}var Q=F[1]?Number(F[1]):1;var O=F[2]?Number(F[2]):0;var S=Selector.pseudos.getIndices(Q,O,A.length);for(var J=0,E,H=S.length;E=A[J];J++){for(var I=0;I<H;I++){if(E.nodeIndex==S[I]){K.push(E)}}}}}L.unmark(A);L.unmark(C);return K},"empty":function(C,H,A){for(var E=0,D=[],F;F=C[E];E++){if(F.tagName=="!"||F.firstChild){continue}D.push(F)}return D},"not":function(A,E,K){var I=Selector.handlers,L,D;var J=new Selector(E).findElements(K);I.mark(J);for(var H=0,F=[],C;C=A[H];H++){if(!C._countedByPrototype){F.push(C)}}I.unmark(J);return F},"enabled":function(C,H,A){for(var E=0,D=[],F;F=C[E];E++){if(!F.disabled&&(!F.type||F.type!=="hidden")){D.push(F)}}return D},"disabled":function(C,H,A){for(var E=0,D=[],F;F=C[E];E++){if(F.disabled){D.push(F)}}return D},"checked":function(C,H,A){for(var E=0,D=[],F;F=C[E];E++){if(F.checked){D.push(F)}}return D}},operators:{"=":function(C,A){return C==A},"!=":function(C,A){return C!=A},"^=":function(C,A){return C==A||C&&C.startsWith(A)},"$=":function(C,A){return C==A||C&&C.endsWith(A)},"*=":function(C,A){return C==A||C&&C.include(A)},"~=":function(C,A){return(" "+C+" ").include(" "+A+" ")},"|=":function(C,A){return("-"+(C||"").toUpperCase()+"-").include("-"+(A||"").toUpperCase()+"-")}},split:function(C){var A=[];C.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(D){A.push(D[1].strip())});return A},matchElements:function(H,I){var F=$$(I),E=Selector.handlers;E.mark(F);for(var D=0,C=[],A;A=H[D];D++){if(A._countedByPrototype){C.push(A)}}E.unmark(F);return C},findElement:function(C,D,A){if(Object.isNumber(D)){A=D;D=false}return Selector.matchElements(C,D||"*")[A||0]},findChildElements:function(F,I){I=Selector.split(I.join(","));var E=[],H=Selector.handlers;for(var D=0,C=I.length,A;D<C;D++){A=new Selector(I[D].strip());H.concat(E,A.findElements(F))}return(C>1)?H.unique(E):E}});if(Prototype.Browser.IE){Object.extend(Selector.handlers,{concat:function(C,A){for(var D=0,E;E=A[D];D++){if(E.tagName!=="!"){C.push(E)}}return C},unmark:function(A){for(var C=0,D;D=A[C];C++){D.removeAttribute("_countedByPrototype")}return A}})}function $$(){return Selector.findChildElements(document,$A(arguments))}var Form={reset:function(A){A=$(A);A.reset();return A},serializeElements:function(I,C){if(typeof C!="object"){C={hash:!!C}}else{if(Object.isUndefined(C.hash)){C.hash=true}}var D,H,A=false,F=C.submit;var E=I.inject({},function(J,K){if(!K.disabled&&K.name){D=K.name;H=$(K).getValue();if(H!=null&&K.type!="file"&&(K.type!="submit"||(!A&&F!==false&&(!F||D==F)&&(A=true)))){if(D in J){if(!Object.isArray(J[D])){J[D]=[J[D]]}J[D].push(H)}else{J[D]=H}}}return J});return C.hash?E:Object.toQueryString(E)}};Form.Methods={serialize:function(C,A){return Form.serializeElements(Form.getElements(C),A)},getElements:function(F){var H=$(F).getElementsByTagName("*"),E,A=[],D=Form.Element.Serializers;for(var C=0;E=H[C];C++){A.push(E)}return A.inject([],function(I,J){if(D[J.tagName.toLowerCase()]){I.push(Element.extend(J))}return I})},getInputs:function(I,D,E){I=$(I);var A=I.getElementsByTagName("input");if(!D&&!E){return $A(A).map(Element.extend)}for(var F=0,J=[],H=A.length;F<H;F++){var C=A[F];if((D&&C.type!=D)||(E&&C.name!=E)){continue}J.push(Element.extend(C))}return J},disable:function(A){A=$(A);Form.getElements(A).invoke("disable");return A},enable:function(A){A=$(A);Form.getElements(A).invoke("enable");return A},findFirstElement:function(C){var D=$(C).getElements().findAll(function(E){return"hidden"!=E.type&&!E.disabled});var A=D.findAll(function(E){return E.hasAttribute("tabIndex")&&E.tabIndex>=0}).sortBy(function(E){return E.tabIndex}).first();return A?A:D.find(function(E){return["input","select","textarea"].include(E.tagName.toLowerCase())})},focusFirstElement:function(A){A=$(A);A.findFirstElement().activate();return A},request:function(C,A){C=$(C),A=Object.clone(A||{});var E=A.parameters,D=C.readAttribute("action")||"";if(D.blank()){D=window.location.href}A.parameters=C.serialize(true);if(E){if(Object.isString(E)){E=E.toQueryParams()}Object.extend(A.parameters,E)}if(C.hasAttribute("method")&&!A.method){A.method=C.method}return new Ajax.Request(D,A)}};Form.Element={focus:function(A){$(A).focus();return A},select:function(A){$(A).select();return A}};Form.Element.Methods={serialize:function(A){A=$(A);if(!A.disabled&&A.name){var C=A.getValue();if(C!=undefined){var D={};D[A.name]=C;return Object.toQueryString(D)}}return""},getValue:function(A){A=$(A);var C=A.tagName.toLowerCase();return Form.Element.Serializers[C](A)},setValue:function(A,C){A=$(A);var D=A.tagName.toLowerCase();Form.Element.Serializers[D](A,C);return A},clear:function(A){$(A).value="";return A},present:function(A){return $(A).value!=""},activate:function(A){A=$(A);try{A.focus();if(A.select&&(A.tagName.toLowerCase()!="input"||!["button","reset","submit"].include(A.type))){A.select()}}catch(C){}return A},disable:function(A){A=$(A);A.disabled=true;return A},enable:function(A){A=$(A);A.disabled=false;return A}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(A,C){switch(A.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(A,C);default:return Form.Element.Serializers.textarea(A,C)}},inputSelector:function(A,C){if(Object.isUndefined(C)){return A.checked?A.value:null}else{A.checked=!!C}},textarea:function(A,C){if(Object.isUndefined(C)){return A.value}else{A.value=C}},select:function(D,H){if(Object.isUndefined(H)){return this[D.type=="select-one"?"selectOne":"selectMany"](D)}else{var C,E,I=!Object.isArray(H);for(var A=0,F=D.length;A<F;A++){C=D.options[A];E=this.optionValue(C);if(I){if(E==H){C.selected=true;return }}else{C.selected=H.include(E)}}}},selectOne:function(C){var A=C.selectedIndex;return A>=0?this.optionValue(C.options[A]):null},selectMany:function(E){var A,F=E.length;if(!F){return null}for(var D=0,A=[];D<F;D++){var C=E.options[D];if(C.selected){A.push(this.optionValue(C))}}return A},optionValue:function(A){return Element.extend(A).hasAttribute("value")?A.value:A.text}};Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,A,C,D){$super(D,C);this.element=$(A);this.lastValue=this.getValue()},execute:function(){var A=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(A)?this.lastValue!=A:String(this.lastValue)!=String(A)){this.callback(this.element,A);this.lastValue=A}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=Class.create({initialize:function(A,C){this.element=$(A);this.callback=C;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var A=this.getValue();if(this.lastValue!=A){this.callback(this.element,A);this.lastValue=A}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(A){if(A.type){switch(A.type.toLowerCase()){case"checkbox":case"radio":Event.observe(A,"click",this.onElementEvent.bind(this));break;default:Event.observe(A,"change",this.onElementEvent.bind(this));break}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});(function(){var X={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}};var P;if(Prototype.Browser.IE){var I={0:1,1:4,2:2};P=function(Z,Y){return Z.button===I[Y]}}else{if(Prototype.Browser.WebKit){P=function(Z,Y){switch(Y){case 0:return Z.which==1&&!Z.metaKey;case 1:return Z.which==1&&Z.metaKey;default:return false}}}else{P=function(Z,Y){return Z.which?(Z.which===Y+1):(Z.button===Y)}}}function T(Y){return P(Y,0)}function S(Y){return P(Y,1)}function L(Y){return P(Y,2)}function D(a){a=X.extend(a);var Z=a.target,Y=a.type,b=a.currentTarget;if(b&&b.tagName){if(Y==="load"||Y==="error"||(Y==="click"&&b.tagName.toLowerCase()==="input"&&b.type==="radio")){Z=b}}if(Z.nodeType==Node.TEXT_NODE){Z=Z.parentNode}return Element.extend(Z)}function N(Z,b){var Y=X.element(Z);if(!b){return Y}var a=[Y].concat(Y.ancestors());return Selector.findElement(a,b,0)}function Q(Y){return{x:C(Y),y:A(Y)}}function C(a){var Z=document.documentElement,Y=document.body||{scrollLeft:0};return a.pageX||(a.clientX+(Z.scrollLeft||Y.scrollLeft)-(Z.clientLeft||0))}function A(a){var Z=document.documentElement,Y=document.body||{scrollTop:0};return a.pageY||(a.clientY+(Z.scrollTop||Y.scrollTop)-(Z.clientTop||0))}function O(Y){X.extend(Y);Y.preventDefault();Y.stopPropagation();Y.stopped=true}X.Methods={isLeftClick:T,isMiddleClick:S,isRightClick:L,element:D,findElement:N,pointer:Q,pointerX:C,pointerY:A,stop:O};var V=Object.keys(X.Methods).inject({},function(Y,Z){Y[Z]=X.Methods[Z].methodize();return Y});if(Prototype.Browser.IE){function H(Z){var Y;switch(Z.type){case"mouseover":Y=Z.fromElement;break;case"mouseout":Y=Z.toElement;break;default:return null}return Element.extend(Y)}Object.extend(V,{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}});X.extend=function(Z,Y){if(!Z){return false}if(Z._extendedByPrototype){return Z}Z._extendedByPrototype=Prototype.emptyFunction;var a=X.pointer(Z);Object.extend(Z,{target:Z.srcElement||Y,relatedTarget:H(Z),pageX:a.x,pageY:a.y});return Object.extend(Z,V)}}else{X.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(X.prototype,V);X.extend=Prototype.K}function M(c,b,d){var a=Element.retrieve(c,"prototype_event_registry");if(Object.isUndefined(a)){E.push(c);a=Element.retrieve(c,"prototype_event_registry",$H())}var Y=a.get(b);if(Object.isUndefined()){Y=[];a.set(b,Y)}if(Y.pluck("handler").include(d)){return false}var Z;if(b.include(":")){Z=function(e){if(Object.isUndefined(e.eventName)){return false}if(e.eventName!==b){return false}X.extend(e,c);d.call(c,e)}}else{if(!Prototype.Browser.IE&&(b==="mouseenter"||b==="mouseleave")){if(b==="mouseenter"||b==="mouseleave"){Z=function(h){X.extend(h,c);var g=h.relatedTarget;while(g&&g!==c){try{g=g.parentNode}catch(l){g=c}}if(g===c){return }d.call(c,h)}}}else{Z=function(e){X.extend(e,c);d.call(c,e)}}}Z.handler=d;Y.push(Z);return Z}function F(){for(var Y=0,Z=E.length;Y<Z;Y++){X.stopObserving(E[Y]);E[Y]=null}}var E=[];if(Prototype.Browser.IE){window.attachEvent("onunload",F)}if(Prototype.Browser.WebKit){window.addEventListener("unload",Prototype.emptyFunction,false)}var K=Prototype.K;if(!Prototype.Browser.IE){K=function(Z){var Y={mouseenter:"mouseover",mouseleave:"mouseout"};return Z in Y?Y[Z]:Z}}function U(b,a,c){b=$(b);var Z=M(b,a,c);if(!Z){return b}if(a.include(":")){if(b.addEventListener){b.addEventListener("dataavailable",Z,false)}else{b.attachEvent("ondataavailable",Z);b.attachEvent("onfilterchange",Z)}}else{var Y=K(a);if(b.addEventListener){b.addEventListener(Y,Z,false)}else{b.attachEvent("on"+Y,Z)}}return b}function J(d,b,e){d=$(d);var a=Element.retrieve(d,"prototype_event_registry");if(Object.isUndefined(a)){return d}if(b&&!e){var c=a.get(b);if(Object.isUndefined(c)){return d}c.each(function(g){Element.stopObserving(d,b,g.handler)});return d}else{if(!b){a.each(function(l){var g=l.key,h=l.value;h.each(function(m){Element.stopObserving(d,g,m.handler)})});return d}}var c=a.get(b);if(!c){return }var Z=c.find(function(g){return g.handler===e});if(!Z){return d}var Y=K(b);if(b.include(":")){if(d.removeEventListener){d.removeEventListener("dataavailable",Z,false)}else{d.detachEvent("ondataavailable",Z);d.detachEvent("onfilterchange",Z)}}else{if(d.removeEventListener){d.removeEventListener(Y,Z,false)}else{d.detachEvent("on"+Y,Z)}}a.set(b,c.without(Z));return d}function W(b,a,Z,Y){b=$(b);if(Object.isUndefined(Y)){Y=true}if(b==document&&document.createEvent&&!b.dispatchEvent){b=document.documentElement}var c;if(document.createEvent){c=document.createEvent("HTMLEvents");c.initEvent("dataavailable",true,true)}else{c=document.createEventObject();c.eventType=Y?"ondataavailable":"onfilterchange"}c.eventName=a;c.memo=Z||{};if(document.createEvent){b.dispatchEvent(c)}else{b.fireEvent(c.eventType,c)}return X.extend(c)}Object.extend(X,X.Methods);Object.extend(X,{fire:W,observe:U,stopObserving:J});Element.addMethods({fire:W,observe:U,stopObserving:J});Object.extend(document,{fire:W.methodize(),observe:U.methodize(),stopObserving:J.methodize(),loaded:false});if(window.Event){Object.extend(window.Event,X)}else{window.Event=X}})();(function(){var E;function A(){if(document.loaded){return }if(E){window.clearTimeout(E)}document.loaded=true;document.fire("dom:loaded")}function D(){if(document.readyState==="complete"){document.stopObserving("readystatechange",D);A()}}function C(){try{document.documentElement.doScroll("left")}catch(F){E=C.defer();return }A()}if(document.addEventListener){document.addEventListener("DOMContentLoaded",A,false)}else{document.observe("readystatechange",D);if(window==top){E=C.defer()}}Event.observe(window,"load",A)})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(A,C){return Element.insert(A,{before:C})},Top:function(A,C){return Element.insert(A,{top:C})},Bottom:function(A,C){return Element.insert(A,{bottom:C})},After:function(A,C){return Element.insert(A,{after:C})}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(C,A,D){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(C,A,D)}this.xcomp=A;this.ycomp=D;this.offset=Element.cumulativeOffset(C);return(D>=this.offset[1]&&D<this.offset[1]+C.offsetHeight&&A>=this.offset[0]&&A<this.offset[0]+C.offsetWidth)},withinIncludingScrolloffsets:function(C,A,E){var D=Element.cumulativeScrollOffset(C);this.xcomp=A+D[0]-this.deltaX;this.ycomp=E+D[1]-this.deltaY;this.offset=Element.cumulativeOffset(C);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+C.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+C.offsetWidth)},overlap:function(C,A){if(!C){return 0}if(C=="vertical"){return((this.offset[1]+A.offsetHeight)-this.ycomp)/A.offsetHeight}if(C=="horizontal"){return((this.offset[0]+A.offsetWidth)-this.xcomp)/A.offsetWidth}},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(A){Position.prepare();return Element.absolutize(A)},relativize:function(A){Position.prepare();return Element.relativize(A)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(C,D,A){A=A||{};return Element.clonePosition(D,C,A)}};if(!document.getElementsByClassName){document.getElementsByClassName=function(C){function A(D){return D.blank()?null:"[contains(concat(' ', @class, ' '), ' "+D+" ')]"}C.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(D,F){F=F.toString().strip();var E=/\s/.test(F)?$w(F).map(A).join(""):A(F);return E?document._getElementsByXPath(".//*"+E,D):[]}:function(F,H){H=H.toString().strip();var I=[],J=(/\s/.test(H)?$w(H):null);if(!J&&!H){return I}var D=$(F).getElementsByTagName("*");H=" "+H+" ";for(var E=0,L,K;L=D[E];E++){if(L.className&&(K=" "+L.className+" ")&&(K.include(H)||(J&&J.all(function(M){return !M.toString().blank()&&K.include(" "+M+" ")})))){I.push(Element.extend(L))}}return I};return function(E,D){return $(D||document.body).getElementsByClassName(E)}}(Element.Methods)}Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(A){this.element=$(A)},_each:function(A){this.element.className.split(/\s+/).select(function(C){return C.length>0})._each(A)},set:function(A){this.element.className=A},add:function(A){if(this.include(A)){return }this.set($A(this).concat(A).join(" "))},remove:function(A){if(!this.include(A)){return }this.set($A(this).without(A).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);var n2i={browser:{},ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,};if(!window.hui){var hui=n2i}n2i.browser.opera=/opera/i.test(navigator.userAgent);n2i.browser.msie=!n2i.browser.opera&&/MSIE/.test(navigator.userAgent);n2i.browser.msie6=navigator.userAgent.indexOf("MSIE 6")!==-1;n2i.browser.msie7=navigator.userAgent.indexOf("MSIE 7")!==-1;n2i.browser.msie8=navigator.userAgent.indexOf("MSIE 8")!==-1;n2i.browser.webkit=navigator.userAgent.indexOf("WebKit")!==-1;n2i.browser.safari=navigator.userAgent.indexOf("Safari")!==-1;n2i.browser.webkitVersion=null;n2i.browser.gecko=!n2i.browser.webkit&&navigator.userAgent.indexOf("Gecko")!=-1;(function(){var A=/Safari\/([\d.]+)/.exec(navigator.userAgent);if(A){n2i.browser.webkitVersion=parseFloat(A[1])}})();n2i.log=function(A){try{console.log(A)}catch(C){}};n2i.camelize=function(H){if(H.indexOf("-")==-1){return H}var E=H.split("-");var C=H.indexOf("-")==0?E[0].charAt(0).toUpperCase()+E[0].substring(1):E[0];for(var D=1,A=E.length;D<A;D++){var F=E[D];C+=F.charAt(0).toUpperCase()+F.substring(1)}return C};n2i.override=function(C,A){if(A){for(prop in A){C[prop]=A[prop]}}return C};n2i.wrap=function(A){if(A===null||A===undefined){return""}return A.split("").join("\u200B")};n2i.trim=function(A){if(!A){return A}return A.replace(/^[\s\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000]+|[\s\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000]+$/g,"")};n2i.escapeHTML=function(A){return document.createElement("div").appendChild(document.createTextNode(A)).innerHTML};n2i.escape=function(A){if(!n2i.isDefined(A)){return""}return A.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")};n2i.isEmpty=n2i.isBlank=function(A){if(A===null||typeof (A)==="undefined"||A===""){return true}return typeof (A)=="string"&&n2i.trim(A).length==0};n2i.string={endsWith:function(C,A){if(!typeof (C)=="string"||!typeof (A)=="string"){return false}return(C.match(A+"$")==C)}};n2i.isDefined=function(A){return A!==null&&typeof (A)!=="undefined"};n2i.isArray=function(A){if(A.constructor==Array){return true}else{return Object.prototype.toString.call(A)==="[object Array]"}};n2i.inArray=function(A,D){for(var C=0;C<A.length;C++){if(A[C]==D){return true}}return false};n2i.indexInArray=function(A,D){for(var C=0;C<A.length;C++){if(A[C]==D){return C}}return -1};n2i.each=function(A,D){if(n2i.isArray(A)){for(var C=0;C<A.length;C++){D(A[C],C)}}else{for(key in A){D(key,A[key])}}};n2i.intOrString=function(C){if(n2i.isDefined(C)){var A=/[0-9]+/.exec(C);if(A!==null&&A[0]==C){if(parseInt(C,10)==C){return parseInt(C,10)}}}return C};n2i.flipInArray=function(A,C){if(n2i.inArray(A,C)){n2i.removeFromArray(A,C)}else{A.push(C)}};n2i.removeFromArray=function(A,D){for(var C=A.length-1;C>=0;C--){if(A[C]==D){A.splice(C,1)}}};n2i.addToArray=function(A,D){if(D.constructor==Array){for(var C=0;C<D.length;C++){if(!n2i.inArray(A,D[C])){A.push(D)}}}else{if(!n2i.inArray(A,D)){A.push(D)}}};n2i.toIntArray=function(C){var D=C.split(",");for(var A=D.length-1;A>=0;A--){D[A]=parseInt(D[A])}return D};n2i.scrollTo=function(A){A=$(A);if(A){var C=A.cumulativeOffset();window.scrollTo(C.left,C.top-50)}};n2i.dom={isElement:function(C,A){return C.nodeType==n2i.ELEMENT_NODE&&(A===undefined?true:C.nodeName.toLowerCase()==A)},isDefinedText:function(A){return A.nodeType==n2i.TEXT_NODE&&A.nodeValue.length>0},addText:function(A,C){A.appendChild(document.createTextNode(C))},clear:function(D){var C=D.childNodes;for(var A=C.length-1;A>=0;A--){C[A].parentNode.removeChild(C[A])}},remove:function(A){if(A.parentNode){A.parentNode.removeChild(A)}},replaceNode:function(D,C){D.parentNode.insertBefore(C,D);var E=D.childNodes;for(var A=0;A<E.length;A++){C.appendChild(D.removeChild(E[A]))}D.parentNode.removeChild(D)},replaceHTML:function(C,A){C=n2i.get(C);C.innerHTML=A},runScripts:function(node){var scripts=node.getElementsByTagName("script");for(var i=0;i<scripts.length;i++){eval(scripts[i].innerHTML)}},setText:function(D,E){var F=D.childNodes;var A=false;for(var C=F.length-1;C>=0;C--){if(!A&&F[C].nodeType==n2i.TEXT_NODE){F[C].nodeValue=E;A=true}else{D.removeChild(F[C])}}if(!A){n2i.dom.addText(D,E)}},getText:function(D){var A="";var E=D.childNodes;for(var C=0;C<E.length;C++){if(E[C].nodeType==n2i.TEXT_NODE&&E[C].nodeValue!=null){A+=E[C].nodeValue}else{if(E[C].nodeType==n2i.ELEMENT_NODE){A+=n2i.dom.getText(E[C])}}}return A},isVisible:function(A){while(A){if(A.style&&(n2i.getStyle(A,"display")==="none"||n2i.getStyle(A,"visibility")==="hidden")){return false}A=A.parentNode}return true}};n2i.form={getValues:function(D){var E={};var A=D.getElementsByTagName("input");for(var C=0;C<A.length;C++){if(n2i.isDefined(A[C].name)){E[A[C].name]=A[C].value}}return E}};n2i.get=function(A){if(typeof (A)=="string"){return document.getElementById(A)}return A};n2i.getChildren=function(E){var D=[];var A=E.childNodes;for(var C=0;C<A.length;C++){if(n2i.dom.isElement(A[C])){D.push(A[C])}}return D};if(document.querySelector){n2i.firstByClass=function(C,D,A){C=C||document.body;return C.querySelector((A?A+".":".")+D)}}else{n2i.firstByClass=function(C,F,A){var E=(n2i.get(C)||document.body).getElementsByTagName(A||"*");for(var D=0;D<E.length;D++){if(n2i.hasClass(E[D],F)){return E[D]}}return null}}if(document.querySelectorAll){n2i.byClass=function(E,H,A){E=E||document.body;var D=E.querySelectorAll((A?A+".":".")+H);var C=[];for(var F=0,I=D.length;F!=I;C.push(D[F++])){}return C}}else{n2i.byClass=function(C,H,A){var F=(n2i.get(C)||document.body).getElementsByTagName(A||"*");var D=[];for(var E=0;E<F.length;E++){if(n2i.hasClass(F[E],H)){D[D.length]=F[E]}}return D}}n2i.firstByTag=function(C,A){C=n2i.get(C)||document.body;if(document.querySelector&&A!=="*"){return C.querySelector(A)}var D=C.getElementsByTagName(A);return D[0]};n2i.build=function(A,C){var D=document.createElement(A);if(C){for(prop in C){if(prop=="text"){D.appendChild(document.createTextNode(C.text))}else{if(prop=="html"){D.innerHTML=C.html}else{if(prop=="parent"){C.parent.appendChild(D)}else{if(prop=="className"){D.className=C.className}else{if(prop=="class"){D.className=C["class"]}else{if(n2i.isDefined(C[prop])){D.setAttribute(prop,C[prop])}}}}}}}}return D};n2i.getAncestors=function(A){var D=[];var C=A.parentNode;while(C){D[D.length]=C;C=C.parentNode}return D};n2i.getNext=function(A){if(!A){return null}if(!A.nextSibling){return null}var C=A.nextSibling;while(C&&C.nodeType!=1){C=C.nextSibling}return C};n2i.getAllNext=function(A){var D=[];var C=n2i.getNext(A);while(C){D.push(C);C=n2i.getNext(C)}return D};n2i.getTop=function(A){A=n2i.get(A);if(A){var C=A.offsetTop;var D=A.offsetParent;while(D!=null){C+=D.offsetTop;D=D.offsetParent}return C}else{return 0}};n2i.getLeft=function(A){A=n2i.get(A);if(A){var C=A.offsetLeft;var D=A.offsetParent;while(D!=null){C+=D.offsetLeft;D=D.offsetParent}return C}else{return 0}};n2i.getPosition=function(A){return{left:n2i.getLeft(A),top:n2i.getTop(A)}};n2i.hasClass=function(D,E){D=n2i.get(D);if(!D||!D.className){return false}var A=D.className.split(/\s+/);for(var C=0;C<A.length;C++){if(A[C]==E){return true}}return false};n2i.addClass=function(A,C){A=n2i.get(A);if(!A){return }n2i.removeClass(A,C);A.className+=" "+C};n2i.removeClass=function(E,F){E=n2i.get(E);if(!E){return }var C="";var A=E.className.split(/\s+/);for(var D=0;D<A.length;D++){if(A[D]!=F){if(D>0){C+=" "}C+=A[D]}}E.className=C};n2i.toggleClass=function(A,C){if(n2i.hasClass(A,C)){n2i.removeClass(A,C)}else{n2i.addClass(A,C)}};n2i.setClass=function(A,C,D){if(D){n2i.addClass(A,C)}else{n2i.removeClass(A,C)}};n2i.fromJSON=function(A){return JSON.parse(A)};n2i.toJSON=function(A){return JSON.stringify(A)};n2i.listen=function(D,C,E,A){D=n2i.get(D);if(document.addEventListener){D.addEventListener(C,E,A?true:false)}else{D.attachEvent("on"+C,E)}};n2i.unListen=function(D,C,E,A){D=n2i.get(D);if(document.removeEventListener){D.removeEventListener(C,E,A?true:false)}else{D.detachEvent("on"+C,E)}};n2i.event=function(A){return new n2i.Event(A)};n2i.Event=function(A){this.event=A=A||window.event;this.element=A.target?A.target:A.srcElement;this.shiftKey=A.shiftKey;this.returnKey=A.keyCode==13;this.escapeKey=A.keyCode==27;this.spaceKey=A.keyCode==32;this.upKey=A.keyCode==38;this.downKey=A.keyCode==40;this.leftKey=A.keyCode==37;this.rightKey=A.keyCode==39;this.keyCode=A.keyCode};n2i.Event.prototype={left:function(){var A=0;if(this.event){if(this.event.pageX){A=this.event.pageX}else{if(this.event.clientX){A=this.event.clientX+n2i.getScrollLeft()}}}return A},getLeft:function(){return this.left()},top:function(){var A=0;if(this.event){if(this.event.pageY){A=this.event.pageY}else{if(this.event.clientY){A=this.event.clientY+n2i.getScrollTop()}}}return A},getTop:function(){return this.top()},getElement:function(){return this.element},findByClass:function(A){var C=this.element;while(C){if(n2i.hasClass(C,A)){return C}C=C.parentNode}return null},findByTag:function(A){var C=this.element;while(C){if(C.tagName&&C.tagName.toLowerCase()==A){return C}C=C.parentNode}return null},stop:function(){n2i.stop(this.event)}};n2i.stop=function(A){if(!A){A=window.event}if(A.stopPropagation){A.stopPropagation()}if(A.preventDefault){A.preventDefault()}A.cancelBubble=true;A.stopped=true};n2i.onReady=function(A){if(window.addEventListener){window.addEventListener("DOMContentLoaded",A,false)}else{if(typeof document.addEventListener!="undefined"){document.addEventListener("load",A,false)}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onload",A)}else{if(typeof window.onload=="function"){var C=window.onload;window.onload=function(){C();A()}}else{window.onload=A}}}}};n2i.request=function(D){D=n2i.override({method:"POST",async:true},D);var H=n2i.request.createTransport();var C=this;H.onreadystatechange=function(){try{if(H.readyState==4){if(H.status==200&&D.onSuccess){D.onSuccess(H)}else{if(D.onFailure){D.onFailure(H)}}}}catch(I){if(D.onException){D.onException(I,H)}else{throw I}}};var F=D.method.toUpperCase();H.open(F,D.url,D.async);var E=null;var A="";if(F=="POST"&&D.parameters){A=n2i.request.buildPostBody(D.parameters);H.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8")}H.send(A)};n2i.request.isXMLResponse=function(A){return A.responseXML&&A.responseXML.documentElement&&A.responseXML.documentElement.nodeName!="parsererror"};n2i.request.buildPostBody=function(C){if(!C){return null}var A="";for(param in C){if(A.length>0){A+="&"}A+=encodeURIComponent(param)+"=";if(C[param]!==undefined&&C[param]!==null){A+=encodeURIComponent(C[param])}}return A};n2i.request.createTransport=function(){try{if(window.XMLHttpRequest){var C=new XMLHttpRequest();if(C.readyState==null){C.readyState=1;C.addEventListener("load",function(){C.readyState=4;if(typeof C.onreadystatechange=="function"){C.onreadystatechange()}},false)}return C}else{if(window.ActiveXObject){return n2i.request.getActiveX()}else{this.delegate.onError(this)}}}catch(A){if(this.delegate.onError){this.delegate.onError(this,A)}}};n2i.request.getActiveX=function(){var D=["MSXML2","Microsoft","MSXML","MSXML3"];var E;for(var C=0;C<D.length;C++){try{E=new ActiveXObject(D[C]+".XmlHttp");return E}catch(A){}}throw new Error("Could not find an installed XML parser")};n2i.getStyle=function(C,D){C=n2i.get(C);var F=n2i.camelize(D);var E=C.style[F];if(!E){if(document.defaultView&&document.defaultView.getComputedStyle){var A=document.defaultView.getComputedStyle(C,null);E=A?A.getPropertyValue(D):null}else{if(C.currentStyle){E=C.currentStyle[F]}}}if(window.opera&&["left","top","right","bottom"].include(D)){if(n2i.getStyle(C,"position")=="static"){E="auto"}}return E=="auto"?null:E};n2i.setOpacity=function(C,A){if(n2i.browser.msie){if(A==1){C.style["filter"]=null}else{C.style["filter"]="alpha(opacity="+(A*100)+")"}}else{C.style["opacity"]=A}};n2i.setStyle=function(A,C){for(style in C){if(style==="opacity"){n2i.setOpacity(A,C[style])}else{A.style[style]=C[style]}}};n2i.copyStyle=function(F,H,E){for(var A=0;A<E.length;A++){var C=E[A];var D=n2i.getStyle(F,C);if(D){H.style[C]=D}}};n2i.getFrameDocument=function(A){if(A.contentDocument){return A.contentDocument}else{if(A.contentWindow){return A.contentWindow.document}else{if(A.document){return A.document}}}};n2i.getFrameWindow=function(A){if(A.defaultView){return A.defaultView}else{if(A.contentWindow){return A.contentWindow}}};n2i.getSelectedText=function(A){A=A||document;if(A.getSelection){return A.getSelection()+""}else{if(A.selection){return A.selection.createRange().text}}return""};n2i.selection={clear:function(){var A;if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){A=window.getSelection();if(A&&A.removeAllRanges){A.removeAllRanges()}}}},getText:function(A){A=A||document;if(A.getSelection){return A.getSelection()+""}else{if(A.selection){return A.selection.createRange().text}}return""}};n2i.effect={makeFlippable:function(A){n2i.addClass(A.container,"in2igui_flip_container");n2i.addClass(A.front,"in2igui_flip_front");n2i.addClass(A.back,"in2igui_flip_back")},flip:function(C){var D=n2i.get(C.element);var F=C.duration||"1s";var E=n2i.firstByClass(D,"in2igui_flip_front");var A=n2i.firstByClass(D,"in2igui_flip_back");E.style.webkitTransitionDuration=F;A.style.webkitTransitionDuration=F;n2i.toggleClass(C.element,"in2igui_flip_flipped")}};n2i.getScrollTop=function(){if(self.pageYOffset){return self.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollTop}else{if(document.body){return document.body.scrollTop}}}};n2i.getScrollLeft=function(){if(self.pageYOffset){return self.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollLeft}else{if(document.body){return document.body.scrollLeft}}}};n2i.getViewPortHeight=function(){if(window.innerHeight){return window.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight}else{if(document.body){return document.body.clientHeight}}}};n2i.getViewPortWidth=function(){if(window.innerWidth){return window.innerWidth}else{if(document.documentElement&&document.documentElement.clientWidth){return document.documentElement.clientWidth}else{if(document.body){return document.body.clientWidth}}}};n2i.getDocumentWidth=function(){return Math.max(document.body.clientWidth,document.documentElement.clientWidth,document.documentElement.scrollWidth);return document.body.scrollWidth};n2i.getDocumentHeight=function(){if(n2i.browser.msie6){var A=Math.max(document.body.clientHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight);var D=document.body.childNodes;for(var C=0;C<D.length;C++){if(n2i.dom.isElement(D[C])){A=Math.max(A,D[C].clientHeight)}}return A}if(window.scrollMaxY&&window.innerHeight){return window.scrollMaxY+window.innerHeight}else{return Math.max(document.body.clientHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight)}};n2i.place=function(D){var H=0,F=0;var A=D.target.element;var E={left:n2i.getLeft(A),top:n2i.getTop(A)};H=E.left+A.clientWidth*D.target.horizontal;F=E.top+A.clientHeight*D.target.vertical;var I=D.source.element;H-=I.clientWidth*D.source.horizontal;F-=I.clientHeight*D.source.vertical;if(D.insideViewPort){var C=n2i.getViewPortWidth();if(H+I.clientWidth>C){H=C-I.clientWidth}if(H<0){H=0}if(F<0){F=0}}var I=D.source.element;I.style.top=F+"px";I.style.left=H+"px"};n2i.Preloader=function(A){this.options=A||{};this.delegate={};this.images=[];this.loaded=0};n2i.Preloader.prototype={addImages:function(A){if(typeof (A)=="object"){for(var C=0;C<A.length;C++){this.images.push(A[C])}}else{this.images.push(A)}},setDelegate:function(A){this.delegate=A},load:function(F){F=F||0;var C=this;this.obs=[];for(var E=F;E<this.images.length+F;E++){var D=E;if(D>=this.images.length){D=D-this.images.length}var A=new Image();A.n2iPreloaderIndex=D;A.onload=function(){C.imageChanged(this.n2iPreloaderIndex,"imageDidLoad")};A.onerror=function(){C.imageChanged(this.n2iPreloaderIndex,"imageDidGiveError")};A.onabort=function(){C.imageChanged(this.n2iPreloaderIndex,"imageDidAbort")};A.src=(this.options.context?this.options.context:"")+this.images[D];this.obs.push(A)}},imageChanged:function(A,C){this.loaded++;if(this.delegate[C]){this.delegate[C](this.loaded,this.images.length,A)}if(this.loaded==this.images.length&&this.delegate.allImagesDidLoad){this.delegate.allImagesDidLoad()}}};n2i.cookie={set:function(D,E,F){if(F){var C=new Date();C.setTime(C.getTime()+(F*24*60*60*1000));var A="; expires="+C.toGMTString()}else{var A=""}document.cookie=D+"="+E+A+"; path=/"},get:function(C){var E=C+"=";var A=document.cookie.split(";");for(var D=0;D<A.length;D++){var F=A[D];while(F.charAt(0)==" "){F=F.substring(1,F.length)}if(F.indexOf(E)==0){return F.substring(E.length,F.length)}}return null},clear:function(A){this.set(A,"",-1)}};n2i.URL=function(A){this.url=A||""};n2i.URL.prototype={addParameter:function(A,C){this.url+=this.url.indexOf("?")!=-1?"&":"?";this.url+=A+"="+(n2i.isDefined(C)?C:"")},toString:function(){return this.url}};n2i.location={getParameter:function(A){var D=n2i.location.getParameters();for(var C=0;C<D.length;C++){if(D[C].name==A){return D[C].value}}return null},setParameter:function(A,F){var D=n2i.location.getParameters();var E=false;for(var C=0;C<D.length;C++){if(D[C].name==A){D[C].value=F;E=true;break}}if(!E){D.push({name:A,value:F})}n2i.location.setParameters(D)},hasHash:function(A){var C=document.location.hash;if(C!==""){return C=="#"+A}return false},getHashParameter:function(A){var E=document.location.hash;if(E!==""){var C=E.indexOf(A+"=");if(C!==-1){var D=E.substring(C+A.length+1);if(D.indexOf("&")!==-1){return D.substring(0,D.indexOf("&"))}return D}}return null},clearHash:function(){document.location.hash="#"},setParameters:function(C){var D="";for(var A=0;A<C.length;A++){D+=A==0?"?":"&";D+=C[A].name+"="+C[A].value}document.location.search=D},getBoolean:function(A){var C=n2i.location.getParameter(A);return(C=="true"||C=="1")},getParameters:function(){var C=document.location.search.substring(1).split("&");var A=[];for(var E=0;E<C.length;E++){var F=C[E].split("=");var D=unescape(F[0]).replace(/^\s*|\s*$/g,"");var H=unescape(F[1]).replace(/^\s*|\s*$/g,"");if(D){A.push({name:D,value:H})}}return A}};n2i.ani=n2i.animate=function(A,D,E,F,C){n2i.animation.get(A).animate(null,E,D,F,C)};n2i.animation={objects:{},running:false,latestId:0,get:function(A){A=n2i.get(A);if(!A.n2iAnimationId){A.n2iAnimationId=this.latestId++}if(!this.objects[A.n2iAnimationId]){this.objects[A.n2iAnimationId]=new n2i.animation.Item(A)}return this.objects[A.n2iAnimationId]},start:function(){if(!this.running){n2i.animation.render()}}};n2i.animation.render=function(H){this.running=true;var J=false;var A=new Date().getTime();for(id in this.objects){var F=this.objects[id];if(F.work){for(var I=0;I<F.work.length;I++){var M=F.work[I];if(M.finished){continue}var E=(A-M.start)/(M.end-M.start);if(E<0){J=true;continue}else{if(isNaN(E)){E=1}else{if(E>1){E=1}else{if(E<1){J=true}}}}var P=E;if(M.delegate&&M.delegate.ease){P=M.delegate.ease(P)}var O=null;if(!M.css){F.element[M.property]=Math.round(M.from+(M.to-M.from)*P)}else{if(M.property=="transform"&&!n2i.browser.msie){var Q=M.transform;var L="";if(Q.rotate){L+=" rotate("+(Q.rotate.from+(Q.rotate.to-Q.rotate.from)*P)+Q.rotate.unit+")"}if(Q.scale){L+=" scale("+(Q.scale.from+(Q.scale.to-Q.scale.from)*P)+")"}F.element.style[n2i.animation.TRANSFORM]=L}else{if(M.to.red!=null){var C=Math.round(M.from.red+(M.to.red-M.from.red)*P);var D=Math.round(M.from.green+(M.to.green-M.from.green)*P);var N=Math.round(M.from.blue+(M.to.blue-M.from.blue)*P);O="rgb("+C+","+D+","+N+")";F.element.style[M.property]=O}else{if(n2i.browser.msie&&M.property=="opacity"){var K=(M.from+(M.to-M.from)*P);if(K==1){F.element.style.removeAttribute("filter")}else{F.element.style["filter"]="alpha(opacity="+(K*100)+")"}}else{O=new String(M.from+(M.to-M.from)*P)+(M.unit!=null?M.unit:"");F.element.style[M.property]=O}}}}if(E==1){M.finished=true;if(M.delegate&&M.delegate.onComplete){window.setTimeout(M.delegate.onComplete)}else{if(M.delegate&&M.delegate.hideOnComplete){F.element.style.display="none"}}}}}}if(J){window.setTimeout(function(){n2i.animation.render()},0)}else{this.running=false}};n2i.animation.parseStyle=function(E){var C={type:null,value:null,unit:null};var D;if(!n2i.isDefined(E)){return C}else{if(!isNaN(E)){C.value=parseFloat(E)}else{if(D=E.match(/([\-]?[0-9\.]+)(px|pt|%)/)){C.type="length";C.value=parseFloat(D[1]);C.unit=D[2]}else{if(D=E.match(/rgb\(([0-9]+),[ ]?([0-9]+),[ ]?([0-9]+)\)/)){C.type="color";C.value={red:parseInt(D[1]),green:parseInt(D[2]),blue:parseInt(D[3])}}else{var A=new n2i.Color(E);if(A.ok){C.value={red:A.r,green:A.g,blue:A.b}}}}}}return C};n2i.animation.Item=function(A){this.element=A;this.work=[]};n2i.animation.Item.prototype.animate=function(J,K,L,C,H){var E=true;if(L=="scrollLeft"||L=="scrollTop"){E=false}var I=this.getWork(E?n2i.camelize(L):L);I.delegate=H;I.finished=false;I.css=E;if(J!=null){I.from=J}else{if(L=="transform"){I.transform=n2i.animation.Item.parseTransform(K,this.element)}else{if(I.css&&n2i.browser.msie&&L=="opacity"){I.from=this.getIEOpacity(this.element)}else{if(I.css){var A=n2i.getStyle(this.element,L);var D=n2i.animation.parseStyle(A);I.from=D.value}else{I.from=this.element[L]}}}}if(I.css){var F=n2i.animation.parseStyle(K);I.to=F.value;I.unit=F.unit}else{I.to=K;I.unit=null}I.start=new Date().getTime();if(H&&H.delay){I.start+=H.delay}I.end=I.start+C;n2i.animation.start()};n2i.animation.TRANSFORM=n2i.browser.gecko?"MozTransform":"WebkitTransform";n2i.animation.Item.parseTransform=function(I,E){var K={};var J=/rotate\(([0-9\.]+)([a-z]+)\)/i;var D=I.match(J);if(D){var H=0;if(E.style[n2i.animation.TRANSFORM]){var F=E.style[n2i.animation.TRANSFORM].match(J);if(F){H=parseFloat(F[1])}}K.rotate={from:H,to:parseFloat(D[1]),unit:D[2]}}var A=/scale\(([0-9\.]+)\)/i;var C=I.match(A);if(C){var H=1;if(E.style[n2i.animation.TRANSFORM]){var F=E.style[n2i.animation.TRANSFORM].match(A);if(F){H=parseFloat(F[1])}}K.scale={from:H,to:parseFloat(C[1])}}return K};n2i.animation.Item.prototype.getIEOpacity=function(C){var D=n2i.getStyle(C,"filter").toLowerCase();var A;if(A=D.match(/opacity=([0-9]+)/)){return parseFloat(A[1])/100}else{return 1}};n2i.animation.Item.prototype.getWork=function(D){for(var C=0;C<this.work.length;C++){if(this.work[C].property==D){return this.work[C]}}var A={property:D};this.work[this.work.length]=A;return A};n2i.animation.Loop=function(A){this.recipe=A;this.position=-1;this.running=false};n2i.animation.Loop.prototype.next=function(){this.position++;if(this.position>=this.recipe.length){this.position=0}var C=this.recipe[this.position];if(typeof (C)=="function"){C()}else{if(C.element){n2i.ani(C.element,C.property,C.value,C.duration,{ease:C.ease})}}var A=this;var D=C.duration||0;window.setTimeout(function(){A.next()},D)};n2i.animation.Loop.prototype.start=function(){this.running=true;this.next()};n2i.Color=function(I){this.ok=false;if(I.charAt(0)=="#"){I=I.substr(1,6)}I=I.replace(/ /g,"");I=I.toLowerCase();var A={white:"ffffff",black:"000000",red:"ff0000",green:"00ff00",blue:"0000ff"};for(var D in A){if(I==D){I=A[D]}}var J=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(K){return[parseInt(K[1]),parseInt(K[2]),parseInt(K[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(K){return[parseInt(K[1],16),parseInt(K[2],16),parseInt(K[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(K){return[parseInt(K[1]+K[1],16),parseInt(K[2]+K[2],16),parseInt(K[3]+K[3],16)]}}];for(var C=0;C<J.length;C++){var F=J[C].re;var E=J[C].process;var H=F.exec(I);if(H){channels=E(H);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var M=this.r.toString(16);var L=this.g.toString(16);var K=this.b.toString(16);if(M.length==1){M="0"+M}if(L.length==1){L="0"+L}if(K.length==1){K="0"+K}return"#"+M+L+K}};n2i.Color.hsv2rgb=function(E,D,A){var C=E/360;if(D==0){R=A*255;G=A*255;B=A*255}else{var_h=C*6;var_i=Math.floor(var_h);var_1=A*(1-D);var_2=A*(1-D*(var_h-var_i));var_3=A*(1-D*(1-(var_h-var_i)));if(var_i==0){var_r=A;var_g=var_3;var_b=var_1}else{if(var_i==1){var_r=var_2;var_g=A;var_b=var_1}else{if(var_i==2){var_r=var_1;var_g=A;var_b=var_3}else{if(var_i==3){var_r=var_1;var_g=var_2;var_b=A}else{if(var_i==4){var_r=var_3;var_g=var_1;var_b=A}else{var_r=A;var_g=var_1;var_b=var_2}}}}}R=Math.round(var_r*255);G=Math.round(var_g*255);B=Math.round(var_b*255)}return new Array(R,G,B)};n2i.Color.rgb2hex=function(A){var D="#";for(i=0;i<3;i++){var C=parseInt(A[i]).toString(16);if(C.length<2){C="0"+C}D+=C}return D};n2i.ease={slowFastSlow:function(D){var C=1.6;var A=1.4;return -1*Math.pow(Math.cos((Math.PI/2)*Math.pow(D,C)),Math.pow(Math.PI,A))+1},fastSlow:function(D){var C=0.5;var A=0.7;return -1*Math.pow(Math.cos((Math.PI/2)*Math.pow(D,C)),Math.pow(Math.PI,A))+1},elastic:function(A){return 1-n2i.ease.elastic2(1-A)},elastic2:function(C,A,E){if(C<=0||C>=1){return C}if(!E){E=0.45}var D;if(!A||A<1){A=1;D=E/4}else{D=E/(2*Math.PI)*Math.asin(1/A)}return -(A*Math.pow(2,10*(C-=1))*Math.sin((C-D)*(2*Math.PI)/E))},bounce:function(A){if(A<(1/2.75)){return 7.5625*A*A}else{if(A<(2/2.75)){return(7.5625*(A-=(1.5/2.75))*A+0.75)}else{if(A<(2.5/2.75)){return(7.5625*(A-=(2.25/2.75))*A+0.9375)}else{return(7.5625*(A-=(2.625/2.75))*A+0.984375)}}}},linear:function(A){return A},quadIn:function(A){return Math.pow(A,2)},quadOut:function(A){return A*(A-2)*-1},quadInOut:function(A){A=A*2;if(A<1){return Math.pow(A,2)/2}return -1*((--A)*(A-2)-1)/2},cubicIn:function(A){return Math.pow(A,3)},cubicOut:function(A){return Math.pow(A-1,3)+1},cubicInOut:function(A){A=A*2;if(A<1){return Math.pow(A,3)/2}A-=2;return(Math.pow(A,3)+2)/2},quartIn:function(A){return Math.pow(A,4)},quartOut:function(A){return -1*(Math.pow(A-1,4)-1)},quartInOut:function(A){A=A*2;if(A<1){return Math.pow(A,4)/2}A-=2;return -1/2*(Math.pow(A,4)-2)},quintIn:function(A){return Math.pow(A,5)},quintOut:function(A){return Math.pow(A-1,5)+1},quintInOut:function(A){A=A*2;if(A<1){return Math.pow(A,5)/2}A-=2;return(Math.pow(A,5)+2)/2},sineIn:function(A){return -1*Math.cos(A*(Math.PI/2))+1},sineOut:function(A){return Math.sin(A*(Math.PI/2))},sineInOut:function(A){return -1*(Math.cos(Math.PI*A)-1)/2},expoIn:function(A){return(A==0)?0:Math.pow(2,10*(A-1))},expoOut:function(A){return(A==1)?1:(-1*Math.pow(2,-10*A)+1)},expoInOut:function(A){if(A==0){return 0}if(A==1){return 1}A=A*2;if(A<1){return Math.pow(2,10*(A-1))/2}--A;return(-1*Math.pow(2,-10*A)+2)/2},circIn:function(A){return -1*(Math.sqrt(1-Math.pow(A,2))-1)},circOut:function(A){A=A-1;return Math.sqrt(1-Math.pow(A,2))},circInOut:function(A){A=A*2;if(A<1){return -1/2*(Math.sqrt(1-Math.pow(A,2))-1)}A-=2;return 1/2*(Math.sqrt(1-Math.pow(A,2))+1)},backIn:function(C){var A=1.70158;return Math.pow(C,2)*((A+1)*C-A)},backOut:function(C){C=C-1;var A=1.70158;return Math.pow(C,2)*((A+1)*C+A)+1},backInOut:function(C){var A=1.70158*1.525;C=C*2;if(C<1){return(Math.pow(C,2)*((A+1)*C-A))/2}C-=2;return(Math.pow(C,2)*((A+1)*C+A)+2)/2},elasticIn:function(D){if(D==0){return 0}if(D==1){return 1}var C=0.3;var A=C/4;D=D-1;return -1*Math.pow(2,10*D)*Math.sin((D-A)*(2*Math.PI)/C)},elasticOut:function(D){if(D==0){return 0}if(D==1){return 1}var C=0.3;var A=C/4;return Math.pow(2,-10*D)*Math.sin((D-A)*(2*Math.PI)/C)+1},elasticInOut:function(D){if(D==0){return 0}D=D*2;if(D==2){return 1}var C=0.3*1.5;var A=C/4;if(D<1){D-=1;return -0.5*(Math.pow(2,10*D)*Math.sin((D-A)*(2*Math.PI)/C))}D-=1;return 0.5*(Math.pow(2,-10*D)*Math.sin((D-A)*(2*Math.PI)/C))+1},bounceIn:function(A){return(1-n2i.ease.bounceOut(1-A))},bounceOut:function(E){var C=7.5625;var D=2.75;var A;if(E<(1/D)){A=C*Math.pow(E,2)}else{if(E<(2/D)){E-=(1.5/D);A=C*Math.pow(E,2)+0.75}else{if(E<(2.5/D)){E-=(2.25/D);A=C*Math.pow(E,2)+0.9375}else{E-=(2.625/D);A=C*Math.pow(E,2)+0.984375}}}return A},bounceInOut:function(A){if(A<0.5){return n2i.ease.bounceIn(A*2)/2}return(n2i.ease.bounceOut(A*2-1)/2)+0.5}};if(!Function.prototype.bind){Function.prototype.bind=function(){if(arguments.length<2&&arguments[0]===undefined){return this}var D=this,A=Array.prototype.slice.call(arguments),C=A.shift();return function(){return D.apply(C,A.concat(Array.prototype.slice.call(arguments)))}};Function.bind=function(){var A=Array.prototype.slice.call(arguments);return Function.prototype.bind.apply(A.shift(),A)}}var SWFUpload=function(A){this.initSWFUpload(A)};SWFUpload.prototype.initSWFUpload=function(C){try{this.customSettings={};this.settings=C;this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings();this.loadFlash();this.displayDebugInfo()}catch(A){delete SWFUpload.instances[this.movieName];throw A}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 Alpha";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(C,A){this.settings[C]=(this.settings[C]==undefined)?A:this.settings[C]};this.ensureDefault("upload_url","");this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id",null);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",function(A){n2i.log(A)});this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+"?swfuploadrnd="+Math.floor(Math.random()*999999999)}delete this.ensureDefault};SWFUpload.prototype.loadFlash=function(){if(this.settings.button_placeholder_id!==""){this.replaceWithFlash()}else{this.appendFlash()}};SWFUpload.prototype.appendFlash=function(){var C,A;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}C=document.getElementsByTagName("body")[0];if(C==undefined){throw"Could not find the 'body' element."}A=document.createElement("div");A.style.width="1px";A.style.height="1px";A.style.overflow="hidden";C.appendChild(A);A.innerHTML=this.getFlashHTML()};SWFUpload.prototype.replaceWithFlash=function(){var A,C;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}A=this.settings.button_placeholder||document.getElementById(this.settings.button_placeholder_id);if(A==undefined){throw"Could not find the placeholder element."}C=document.createElement("div");C.innerHTML=this.getFlashHTML();A.parentNode.replaceChild(C.firstChild,A)};SWFUpload.prototype.getFlashHTML=function(){var A=this.settings.button_image_url===""?true:false;return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',A?"transparent":"window",'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")};SWFUpload.prototype.getFlashVars=function(){var A=this.buildParamString();return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;params=",encodeURIComponent(A),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled)].join("")};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName)}if(this.movieElement===null){throw"Could not find Flash element"}return this.movieElement};SWFUpload.prototype.buildParamString=function(){var D=this.settings.post_params;var C=[];if(typeof (D)==="object"){for(var A in D){if(D.hasOwnProperty(A)){C.push(encodeURIComponent(A.toString())+"="+encodeURIComponent(D[A].toString()))}}}return C.join("&amp;")};SWFUpload.prototype.destroy=function(){try{this.stopUpload();var C=null;try{C=this.getMovieElement()}catch(D){}if(C!=undefined&&C.parentNode!=undefined&&typeof C.parentNode.removeChild==="function"){var A=C.parentNode;if(A!=undefined){A.removeChild(C);if(A.parentNode!=undefined&&typeof A.parentNode.removeChild==="function"){A.parentNode.removeChild(A)}}}SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];delete this.movieElement;delete this.settings;delete this.customSettings;delete this.eventQueue;delete this.movieName;delete window[this.movieName];return true}catch(E){return false}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""))};SWFUpload.prototype.addSetting=function(C,D,A){if(D==undefined){return(this.settings[C]=A)}else{return(this.settings[C]=D)}};SWFUpload.prototype.getSetting=function(A){if(this.settings[A]!=undefined){return this.settings[A]}return""};SWFUpload.prototype.callFlash=function(D,E){E=E||[];var A=this.getMovieElement();var C;if(typeof A[D]==="function"){if(E.length===0){C=A[D]()}else{if(E.length===1){C=A[D](E[0])}else{if(E.length===2){C=A[D](E[0],E[1])}else{if(E.length===3){C=A[D](E[0],E[1],E[2])}else{throw"Too many arguments"}}}}if(C!=undefined&&typeof C.post==="object"){C=this.unescapeFilePostParams(C)}return C}else{throw"Invalid function name: "+D}};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};SWFUpload.prototype.startUpload=function(A){this.callFlash("StartUpload",[A])};SWFUpload.prototype.cancelUpload=function(A){this.callFlash("CancelUpload",[A])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(A){this.callFlash("SetStats",[A])};SWFUpload.prototype.getFile=function(A){if(typeof (A)==="number"){return this.callFlash("GetFileByIndex",[A])}else{return this.callFlash("GetFile",[A])}};SWFUpload.prototype.addFileParam=function(A,C,D){return this.callFlash("AddFileParam",[A,C,D])};SWFUpload.prototype.removeFileParam=function(A,C){this.callFlash("RemoveFileParam",[A,C])};SWFUpload.prototype.setUploadURL=function(A){this.settings.upload_url=A.toString();this.callFlash("SetUploadURL",[A])};SWFUpload.prototype.setPostParams=function(A){this.settings.post_params=A;this.callFlash("SetPostParams",[A])};SWFUpload.prototype.addPostParam=function(A,C){this.settings.post_params[A]=C;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(A){delete this.settings.post_params[A];this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.setFileTypes=function(A,C){this.settings.file_types=A;this.settings.file_types_description=C;this.callFlash("SetFileTypes",[A,C])};SWFUpload.prototype.setFileSizeLimit=function(A){this.settings.file_size_limit=A;this.callFlash("SetFileSizeLimit",[A])};SWFUpload.prototype.setFileUploadLimit=function(A){this.settings.file_upload_limit=A;this.callFlash("SetFileUploadLimit",[A])};SWFUpload.prototype.setFileQueueLimit=function(A){this.settings.file_queue_limit=A;this.callFlash("SetFileQueueLimit",[A])};SWFUpload.prototype.setFilePostName=function(A){this.settings.file_post_name=A;this.callFlash("SetFilePostName",[A])};SWFUpload.prototype.setUseQueryString=function(A){this.settings.use_query_string=A;this.callFlash("SetUseQueryString",[A])};SWFUpload.prototype.setRequeueOnError=function(A){this.settings.requeue_on_error=A;this.callFlash("SetRequeueOnError",[A])};SWFUpload.prototype.setDebugEnabled=function(A){this.settings.debug_enabled=A;this.callFlash("SetDebugEnabled",[A])};SWFUpload.prototype.setButtonImageURL=function(A){if(A==undefined){A=""}this.settings.button_image_url=A;this.callFlash("SetButtonImageURL",[A])};SWFUpload.prototype.setButtonDimensions=function(D,A){this.settings.button_width=D;this.settings.button_height=A;var C=this.getMovieElement();if(C!=undefined){C.style.width=D+"px";C.style.height=A+"px"}this.callFlash("SetButtonDimensions",[D,A])};SWFUpload.prototype.setButtonText=function(A){this.settings.button_text=A;this.callFlash("SetButtonText",[A])};SWFUpload.prototype.setButtonTextPadding=function(C,A){this.settings.button_text_top_padding=A;this.settings.button_text_left_padding=C;this.callFlash("SetButtonTextPadding",[C,A])};SWFUpload.prototype.setButtonTextStyle=function(A){this.settings.button_text_style=A;this.callFlash("SetButtonTextStyle",[A])};SWFUpload.prototype.setButtonDisabled=function(A){this.settings.button_disabled=A;this.callFlash("SetButtonDisabled",[A])};SWFUpload.prototype.setButtonAction=function(A){this.settings.button_action=A;this.callFlash("SetButtonAction",[A])};SWFUpload.prototype.queueEvent=function(C,D){if(D==undefined){D=[]}else{if(!(D instanceof Array)){D=[D]}}var A=this;if(typeof this.settings[C]==="function"){this.eventQueue.push(function(){this.settings[C].apply(this,D)});setTimeout(function(){A.executeNextEvent()},0)}else{if(this.settings[C]!==null){throw"Event handler "+C+" is unknown or is not a function"}}};SWFUpload.prototype.executeNextEvent=function(){var A=this.eventQueue?this.eventQueue.shift():null;if(typeof (A)==="function"){A.apply(this)}};SWFUpload.prototype.unescapeFilePostParams=function(D){var F=/[$]([0-9a-f]{4})/i;var H={};var E;if(D!=undefined){for(var A in D.post){if(D.post.hasOwnProperty(A)){E=A;var C;while((C=F.exec(E))!==null){E=E.replace(C[0],String.fromCharCode(parseInt("0x"+C[1],16)))}H[E]=D.post[A]}}D.post=H}return D};SWFUpload.prototype.flashReady=function(){var A=this.getMovieElement();if(typeof A.StartUpload!=="function"){throw"ExternalInterface methods failed to initialize."}if(window[this.movieName]==undefined){window[this.movieName]=A}this.queueEvent("swfupload_loaded_handler")};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};SWFUpload.prototype.fileQueued=function(A){A=this.unescapeFilePostParams(A);this.queueEvent("file_queued_handler",A)};SWFUpload.prototype.fileQueueError=function(A,D,C){A=this.unescapeFilePostParams(A);this.queueEvent("file_queue_error_handler",[A,D,C])};SWFUpload.prototype.fileDialogComplete=function(A,C){this.queueEvent("file_dialog_complete_handler",[A,C])};SWFUpload.prototype.uploadStart=function(A){A=this.unescapeFilePostParams(A);this.queueEvent("return_upload_start_handler",A)};SWFUpload.prototype.returnUploadStart=function(A){var C;if(typeof this.settings.upload_start_handler==="function"){A=this.unescapeFilePostParams(A);C=this.settings.upload_start_handler.call(this,A)}else{if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function"}}if(C===undefined){C=true}C=!!C;this.callFlash("ReturnUploadStart",[C])};SWFUpload.prototype.uploadProgress=function(A,D,C){A=this.unescapeFilePostParams(A);this.queueEvent("upload_progress_handler",[A,D,C])};SWFUpload.prototype.uploadError=function(A,D,C){A=this.unescapeFilePostParams(A);this.queueEvent("upload_error_handler",[A,D,C])};SWFUpload.prototype.uploadSuccess=function(C,A){C=this.unescapeFilePostParams(C);this.queueEvent("upload_success_handler",[C,A])};SWFUpload.prototype.uploadComplete=function(A){A=this.unescapeFilePostParams(A);this.queueEvent("upload_complete_handler",A)};SWFUpload.prototype.debug=function(A){n2i.log(A)};Date.parseFunctions={count:0};Date.parseRegexes=[];Date.formatFunctions={count:0};Date.prototype.dateFormat=function(C){if(Date.formatFunctions[C]==null){Date.createNewFormat(C)}var A=Date.formatFunctions[C];return this[A]()};Date.createNewFormat=function(format){var funcName="format"+Date.formatFunctions.count++;Date.formatFunctions[format]=funcName;var code="Date.prototype."+funcName+" = function(){return ";var special=false;var ch="";for(var i=0;i<format.length;++i){ch=format.charAt(i);if(!special&&ch=="\\"){special=true}else{if(special){special=false;code+="'"+String.escape(ch)+"' + "}else{code+=Date.getFormatCode(ch)}}}eval(code.substring(0,code.length-3)+";}")};Date.getFormatCode=function(A){switch(A){case"d":return"String.leftPad(this.getDate(), 2, '0') + ";case"D":return"Date.dayNames[this.getDay()].substring(0, 3) + ";case"j":return"this.getDate() + ";case"l":return"Date.dayNames[this.getDay()] + ";case"S":return"this.getSuffix() + ";case"w":return"this.getDay() + ";case"z":return"this.getDayOfYear() + ";case"W":return"this.getWeekOfYear() + ";case"F":return"Date.monthNames[this.getMonth()] + ";case"m":return"String.leftPad(this.getMonth() + 1, 2, '0') + ";case"M":return"Date.monthNames[this.getMonth()].substring(0, 3) + ";case"n":return"(this.getMonth() + 1) + ";case"t":return"this.getDaysInMonth() + ";case"L":return"(this.isLeapYear() ? 1 : 0) + ";case"Y":return"this.getFullYear() + ";case"y":return"('' + this.getFullYear()).substring(2, 4) + ";case"a":return"(this.getHours() < 12 ? 'am' : 'pm') + ";case"A":return"(this.getHours() < 12 ? 'AM' : 'PM') + ";case"g":return"((this.getHours() %12) ? this.getHours() % 12 : 12) + ";case"G":return"this.getHours() + ";case"h":return"String.leftPad((this.getHours() %12) ? this.getHours() % 12 : 12, 2, '0') + ";case"H":return"String.leftPad(this.getHours(), 2, '0') + ";case"i":return"String.leftPad(this.getMinutes(), 2, '0') + ";case"s":return"String.leftPad(this.getSeconds(), 2, '0') + ";case"O":return"this.getGMTOffset() + ";case"T":return"this.getTimezone() + ";case"Z":return"(this.getTimezoneOffset() * -60) + ";default:return"'"+String.escape(A)+"' + "}};Date.parseDate=function(A,D){if(Date.parseFunctions[D]==null){Date.createParser(D)}var C=Date.parseFunctions[D];return Date[C](A)};Date.createParser=function(format){var funcName="parse"+Date.parseFunctions.count++;var regexNum=Date.parseRegexes.length;var currentGroup=1;Date.parseFunctions[format]=funcName;var code="Date."+funcName+" = function(input){\nvar y = -1, m = -1, d = -1, h = -1, i = -1, s = -1;\nvar d = new Date();\ny = d.getFullYear();\nm = d.getMonth();\nd = d.getDate();\nvar results = input.match(Date.parseRegexes["+regexNum+"]);\nif (results && results.length > 0) {";var regex="";var special=false;var ch="";for(var i=0;i<format.length;++i){ch=format.charAt(i);if(!special&&ch=="\\"){special=true}else{if(special){special=false;regex+=String.escape(ch)}else{obj=Date.formatCodeToRegex(ch,currentGroup);currentGroup+=obj.g;regex+=obj.s;if(obj.g&&obj.c){code+=obj.c}}}}code+="if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0 && s >= 0)\n{return new Date(y, m, d, h, i, s);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0)\n{return new Date(y, m, d, h, i);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0)\n{return new Date(y, m, d, h);}\nelse if (y > 0 && m >= 0 && d > 0)\n{return new Date(y, m, d);}\nelse if (y > 0 && m >= 0)\n{return new Date(y, m);}\nelse if (y > 0)\n{return new Date(y);}\n}return null;}";Date.parseRegexes[regexNum]=new RegExp("^"+regex+"$");eval(code)};Date.formatCodeToRegex=function(C,A){switch(C){case"D":return{g:0,c:null,s:"(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)"};case"j":case"d":return{g:1,c:"d = parseInt(results["+A+"], 10);\n",s:"(\\d{1,2})"};case"l":return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"};case"S":return{g:0,c:null,s:"(?:st|nd|rd|th)"};case"w":return{g:0,c:null,s:"\\d"};case"z":return{g:0,c:null,s:"(?:\\d{1,3})"};case"W":return{g:0,c:null,s:"(?:\\d{2})"};case"F":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+A+"].substring(0, 3)], 10);\n",s:"("+Date.monthNames.join("|")+")"};case"M":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+A+"]], 10);\n",s:"(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)"};case"n":case"m":return{g:1,c:"m = parseInt(results["+A+"], 10) - 1;\n",s:"(\\d{1,2})"};case"t":return{g:0,c:null,s:"\\d{1,2}"};case"L":return{g:0,c:null,s:"(?:1|0)"};case"Y":return{g:1,c:"y = parseInt(results["+A+"], 10);\n",s:"(\\d{4})"};case"y":return{g:1,c:"var ty = parseInt(results["+A+"], 10);\ny = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"};case"a":return{g:1,c:"if (results["+A+"] == 'am') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(am|pm)"};case"A":return{g:1,c:"if (results["+A+"] == 'AM') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(AM|PM)"};case"g":case"G":case"h":case"H":return{g:1,c:"h = parseInt(results["+A+"], 10);\n",s:"(\\d{1,2})"};case"i":return{g:1,c:"i = parseInt(results["+A+"], 10);\n",s:"(\\d{2})"};case"s":return{g:1,c:"s = parseInt(results["+A+"], 10);\n",s:"(\\d{2})"};case"O":return{g:0,c:null,s:"[+-]\\d{4}"};case"T":return{g:0,c:null,s:"[A-Z]{3}"};case"Z":return{g:0,c:null,s:"[+-]\\d{1,5}"};default:return{g:0,c:null,s:String.escape(C)}}};Date.prototype.getTimezone=function(){return this.toString().replace(/^.*? ([A-Z]{3}) [0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")};Date.prototype.getGMTOffset=function(){return(this.getTimezoneOffset()>0?"-":"+")+String.leftPad(Math.floor(this.getTimezoneOffset()/60),2,"0")+String.leftPad(this.getTimezoneOffset()%60,2,"0")};Date.prototype.getDayOfYear=function(){var A=0;Date.daysInMonth[1]=this.isLeapYear()?29:28;for(var C=0;C<this.getMonth();++C){A+=Date.daysInMonth[C]}return A+this.getDate()-1};Date.prototype.getWeekOfYear=function(){var C=this.getDayOfYear()+(5-this.getDay());var A=new Date(this.getFullYear(),0,1);var D=(5-A.getDay());return parseInt(String.leftPad(((C-D)/7)+1,2,"0"))};Date.prototype.isLeapYear=function(){var A=this.getFullYear();return((A&3)==0&&(A%100||(A%400==0&&A)))};Date.prototype.getFirstDayOfMonth=function(){var A=(this.getDay()-(this.getDate()-1))%7;return(A<0)?(A+7):A};Date.prototype.getLastDayOfMonth=function(){var A=(this.getDay()+(Date.daysInMonth[this.getMonth()]-this.getDate()))%7;return(A<0)?(A+7):A};Date.prototype.getDaysInMonth=function(){Date.daysInMonth[1]=this.isLeapYear()?29:28;return Date.daysInMonth[this.getMonth()]};Date.prototype.getSuffix=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};String.escape=function(A){return A.replace(/('|\\)/g,"\\$1")};String.leftPad=function(E,C,D){var A=new String(E);if(D==null){D=" "}while(A.length<C){A=D+A}return A};Date.daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31];Date.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];Date.dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Date.y2kYear=50;Date.monthNumbers={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};Date.patterns={ISO8601LongPattern:"Y-m-d H:i:s",ISO8601ShortPattern:"Y-m-d",ShortDatePattern:"n/j/Y",LongDatePattern:"l, F d, Y",FullDateTimePattern:"l, F d, Y g:i:s A",MonthDayPattern:"F d",ShortTimePattern:"g:i A",LongTimePattern:"g:i:s A",SortableDateTimePattern:"Y-m-d\\TH:i:s",UniversalSortableDateTimePattern:"Y-m-d H:i:sO",YearMonthPattern:"F, Y"};function In2iGui(){this.domLoaded=false;this.overflows=null;this.delegates=[];this.objects={};this.layoutWidgets=[];this.addBehavior()}window.ui=In2iGui;In2iGui.latestObjectIndex=0;In2iGui.latestIndex=500;In2iGui.latestPanelIndex=1000;In2iGui.latestAlertIndex=1500;In2iGui.latestTopIndex=2000;In2iGui.toolTips={};In2iGui.context="";In2iGui.language="en";In2iGui.state="default";In2iGui.get=function(A){if(!In2iGui.instance){In2iGui.instance=new In2iGui()}if(A){if(A.element){return A}return In2iGui.instance.objects[A]}else{return In2iGui.instance}};n2i.onReady(function(){In2iGui.get().ignite()});In2iGui.prototype={ignite:function(){if(window.dwr){if(dwr&&dwr.engine&&dwr.engine.setErrorHandler){dwr.engine.setErrorHandler(function(C,A){n2i.log(C);n2i.log(A);In2iGui.get().alert({title:"An unexpected error occurred!",text:C,emotion:"gasp"})})}}this.domLoaded=true;In2iGui.domReady=true;this.resize();In2iGui.callSuperDelegates(this,"ready");this.reLayout();n2i.listen(window,"resize",this.reLayout.bind(this))},addBehavior:function(){n2i.listen(window,"resize",this.resize.bind(this))},listen:function(A){this.delegates.push(A)},getTopPad:function(A){var C,D;C=parseInt(n2i.getStyle(A,"padding"),10);D=parseInt(n2i.getStyle(A,"padding-top"),10);if(C){return C}if(D){return D}return 0},getBottomPad:function(C){var D,A;D=parseInt(n2i.getStyle(C,"padding"),10);A=parseInt(n2i.getStyle(C,"padding-bottom"),10);if(D){return D}if(A){return A}return 0},resize:function(){if(!this.overflows){return }var A=n2i.getViewPortHeight();for(var C=0;C<this.overflows.length;C++){var D=this.overflows[C];if(n2i.browser.webkit||n2i.browser.gecko){D.element.style.display="none";D.element.style.width=D.element.parentNode.clientWidth+"px";D.element.style.display=""}D.element.style.height=A+D.diff+"px"}},registerOverflow:function(D,A){if(!this.overflows){this.overflows=[]}var C=n2i.get(D);this.overflows.push({element:C,diff:A})},alert:function(A){if(!this.alertBox){this.alertBox=In2iGui.Alert.create(A);this.alertBoxButton=In2iGui.Button.create({name:"in2iGuiAlertBoxButton",text:"OK"});this.alertBoxButton.listen(this);this.alertBox.addButton(this.alertBoxButton)}else{this.alertBox.update(A)}this.alertBoxCallBack=A.onOK;this.alertBoxButton.setText(A.button?A.button:"OK");this.alertBox.show()},$click$in2iGuiAlertBoxButton:function(){In2iGui.get().alertBox.hide();if(this.alertBoxCallBack){this.alertBoxCallBack();this.alertBoxCallBack=null}},confirm:function(A){if(!A.name){A.name="in2iguiConfirm"}var E=In2iGui.get(A.name);var C;if(!E){E=In2iGui.Alert.create(A);var D=In2iGui.Button.create({name:name+"_cancel",text:A.cancel||"Cancel",highlighted:A.highlighted==="cancel"});D.listen({$click:function(){E.hide();if(A.onCancel){A.onCancel()}In2iGui.callDelegates(E,"cancel")}});E.addButton(D);C=In2iGui.Button.create({name:name+"_ok",text:A.ok||"OK",highlighted:A.highlighted==="ok"});E.addButton(C)}else{E.update(A);C=In2iGui.get(name+"_ok");C.setText(A.ok||"OK");C.setHighlighted(A.highlighted=="ok");C.clearDelegates();In2iGui.get(name+"_cancel").setText(A.ok||"Cancel");In2iGui.get(name+"_cancel").setHighlighted(A.highlighted=="cancel");if(A.cancel){In2iGui.get(name+"_cancel").setText(A.cancel)}}C.listen({$click:function(){E.hide();if(A.onOK){A.onOK()}In2iGui.callDelegates(E,"ok")}});E.show()},reLayout:function(){for(var A=this.layoutWidgets.length-1;A>=0;A--){this.layoutWidgets[A]["$$layout"]()}},getDescendants:function(I){var H=[],D=I.getElement?I.getElement():I;if(D){var F=D.getElementsByTagName("*");var E=[];for(key in this.objects){E.push(this.objects[key])}for(var C=0;C<F.length;C++){for(var A=0;A<E.length;A++){if(F[C]==E[A].element){H.push(E[A])}}}}return H},getAncestors:function(E){var I=[];var F=E.element;if(F){var A=n2i.getAncestors(F);var H=[];for(key in this.objects){H.push(this.objects[key])}for(var D=0;D<A.length;D++){for(var C=0;C<H.length;C++){if(H[C].element==A[D]){I.push(H[C])}}}}return I},getAncestor:function(E,C){var A=this.getAncestors(E);for(var D=0;D<A.length;D++){if(n2i.hasClass(A[D].getElement(),C)){return A[D]}}return null}};In2iGui.confirmOverlays={};In2iGui.confirmOverlay=function(C){var F=C.element||C.widget.getElement();if(In2iGui.confirmOverlays[F]){var A=In2iGui.confirmOverlays[F];A.clear()}else{var A=ui.Overlay.create({modal:true});In2iGui.confirmOverlays[F]=A}if(C.text){A.addText(C.text)}var D=ui.Button.create({text:C.okText||"OK",highlighted:"true"});D.click(function(){if(C.onOk){C.onOk()}A.hide()});A.add(D);var E=ui.Button.create({text:C.cancelText||"Cancel"});E.onClick(function(){A.hide()});A.add(E);A.show({element:F})};In2iGui.destroyDescendants=function(C){var F=In2iGui.get().getDescendants(C);var D=In2iGui.get().objects;for(var A=0;A<F.length;A++){var E=delete (D[F[A].name]);if(!E){n2i.log("not found: "+F[A].name)}}};In2iGui.changeState=function(C){if(In2iGui.state===C){return }var A=In2iGui.get().objects;for(key in A){var D=A[key];if(D.options&&D.options.state){if(D.options.state==C){D.show()}else{D.hide()}}}In2iGui.state=C};In2iGui.nextIndex=function(){In2iGui.latestIndex++;return In2iGui.latestIndex};In2iGui.nextPanelIndex=function(){In2iGui.latestPanelIndex++;return In2iGui.latestPanelIndex};In2iGui.nextAlertIndex=function(){In2iGui.latestAlertIndex++;return In2iGui.latestAlertIndex};In2iGui.nextTopIndex=function(){In2iGui.latestTopIndex++;return In2iGui.latestTopIndex};In2iGui.showCurtain=function(C,E){var D=C.widget;if(!D.curtain){D.curtain=n2i.build("div",{"class":"in2igui_curtain",style:"z-index:none"});D.curtain.onclick=function(){if(D["$curtainWasClicked"]){D["$curtainWasClicked"]()}};var A=n2i.firstByClass(document.body,"in2igui_body");if(!A){A=document.body}A.appendChild(D.curtain)}if(C.color){D.curtain.style.backgroundColor=C.color}if(n2i.browser.msie){D.curtain.style.height=n2i.getDocumentHeight()+"px"}else{D.curtain.style.position="fixed";D.curtain.style.top="0";D.curtain.style.left="0";D.curtain.style.bottom="0";D.curtain.style.right="0"}D.curtain.style.zIndex=C.zIndex;n2i.setOpacity(D.curtain,0);D.curtain.style.display="block";n2i.ani(D.curtain,"opacity",0.7,1000,{ease:n2i.ease.slowFastSlow})};In2iGui.hideCurtain=function(A){if(A.curtain){n2i.ani(A.curtain,"opacity",0,200,{hideOnComplete:true})}};In2iGui.alert=function(A){In2iGui.get().alert(A)};In2iGui.showMessage=function(C){if(typeof (C)=="string"){C={text:C}}if(!In2iGui.message){In2iGui.message=n2i.build("div",{"class":"in2igui_message",html:"<div><div></div></div>"});if(!n2i.browser.msie){n2i.setOpacity(In2iGui.message,0)}document.body.appendChild(In2iGui.message)}var A=In2iGui.message.getElementsByTagName("div")[1];if(C.icon){n2i.dom.clear(A);A.appendChild(In2iGui.createIcon(C.icon,24));n2i.dom.addText(A,C.text)}else{if(C.busy){A.innerHTML='<span class="in2igui_message_busy"></span>';n2i.dom.addText(A,C.text)}else{n2i.dom.setText(A,C.text)}}In2iGui.message.style.display="block";In2iGui.message.style.zIndex=In2iGui.nextTopIndex();In2iGui.message.style.marginLeft=(In2iGui.message.clientWidth/-2)+"px";In2iGui.message.style.marginTop=n2i.getScrollTop()+"px";if(!n2i.browser.msie){n2i.ani(In2iGui.message,"opacity",1,300)}window.clearTimeout(In2iGui.messageTimer);if(C.duration){In2iGui.messageTimer=window.setTimeout(In2iGui.hideMessage,C.duration)}};In2iGui.hideMessage=function(){if(In2iGui.message){if(!n2i.browser.msie){n2i.ani(In2iGui.message,"opacity",0,300,{hideOnComplete:true})}else{In2iGui.message.style.display="none"}}};In2iGui.showToolTip=function(A){var D=A.key||"common";var C=In2iGui.toolTips[D];if(!C){C=n2i.build("div",{"class":"in2igui_tooltip",style:"display:none;",html:"<div><div></div></div>",parent:document.body});In2iGui.toolTips[D]=C}C.onclick=function(){In2iGui.hideToolTip(A)};var F=n2i.get(A.element);var E=n2i.getPosition(F);C.select("div")[1].update(A.text);if(C.style.display=="none"&&!n2i.browser.msie){n2i.setOpacity(C,0)}n2i.setStyle(C,{"display":"block",zIndex:In2iGui.nextTopIndex()});n2i.setStyle(C,{left:(E.left-C.clientWidth+4)+"px",top:(E.top+2-(C.clientHeight/2)+(F.clientHeight/2))+"px"});if(!n2i.browser.msie){n2i.ani(C,"opacity",1,300)}};In2iGui.hideToolTip=function(A){var D=A?A.key||"common":"common";var C=In2iGui.toolTips[D];if(C){if(!n2i.browser.msie){n2i.ani(C,"opacity",0,300,{hideOnComplete:true})}else{n2i.style.display="none"}}};In2iGui.getElement=function(A){if(n2i.dom.isElement(A)){return A}else{if(A.getElement){return A.getElement()}}return null};In2iGui.isWithin=function(C,A){C=new n2i.Event(C);var E={left:n2i.getLeft(A),top:n2i.getTop(A)};var D={width:A.clientWidth,height:A.clientHeight};return C.left()>E.left&&C.left()<E.left+D.width&&C.top()>E.top&&C.top()<E.top+D.height};In2iGui.getIconUrl=function(C,A){return In2iGui.context+"/In2iGui/icons/"+C+A+".png"};In2iGui.createIcon=function(C,A){return n2i.build("span",{"class":"in2igui_icon in2igui_icon_"+A,style:"background-image: url("+In2iGui.getIconUrl(C,A)+")"})};In2iGui.onDomReady=In2iGui.onReady=function(A){if(In2iGui.domReady){return A()}if(n2i.browser.gecko&&n2i.string.endsWith(document.baseURI,"xml")){window.setTimeout(A,1000);return }n2i.onReady(A)};In2iGui.wrapInField=function(C){var A=n2i.build("div",{"class":"in2igui_field",html:'<span class="in2igui_field_top"><span><span></span></span></span><span class="in2igui_field_middle"><span class="in2igui_field_middle"><span class="in2igui_field_content"></span></span></span><span class="in2igui_field_bottom"><span><span></span></span></span>'});n2i.firstByClass(A,"in2igui_field_content").appendChild(C);return A};In2iGui.addFocusClass=function(C){var A=C.classElement||C.element,D=C["class"];n2i.listen(C.element,"focus",function(){n2i.addClass(A,D)});n2i.listen(C.element,"blur",function(){n2i.removeClass(A,D)})};In2iGui.NumberValidator=function(A){n2i.override({allowNull:false,min:0,max:10},A);this.min=A.min;this.max=A.max;this.allowNull=A.allowNull;this.middle=Math.max(Math.min(this.max,0),this.min)};In2iGui.NumberValidator.prototype={validate:function(C){if(n2i.isBlank(C)&&this.allowNull){return{valid:true,value:null}}var A=parseFloat(C);if(isNaN(A)){return{valid:false,value:this.middle}}else{if(A<this.min){return{valid:false,value:this.min}}else{if(A>this.max){return{valid:false,value:this.max}}}}return{valid:true,value:A}}};In2iGui.fadeIn=function(A,C){if(n2i.getStyle(A,"display")=="none"){n2i.setStyle(A,{opacity:0,display:""})}n2i.animate(A,"opacity",1,C)};In2iGui.fadeOut=function(A,C){hui.animate(A,"opacity",0,C,{hideOnComplete:true})};In2iGui.bounceIn=function(A,C){if(n2i.browser.msie){n2i.setStyle(A,{"display":"block",visibility:"visible"})}else{n2i.setStyle(A,{"display":"block","opacity":0,visibility:"visible"});n2i.animate(A,"transform","scale(0.1)",0);window.setTimeout(function(){n2i.animate(A,"opacity",1,300);n2i.animate(A,"transform","scale(1)",400,{ease:n2i.ease.backOut})})}};In2iGui.positionAtElement=function(D,H,C){C=C||{};D=n2i.get(D);H=n2i.get(H);var E=n2i.getStyle(D,"display");if(E=="none"){n2i.setStyle(D,{"visibility":"hidden","display":"block"})}var I=left=n2i.getLeft(H),F=n2i.getTop(H);var A=C.vertical||null;if(C.horizontal&&C.horizontal=="right"){left=left+H.clientWidth-D.clientWidth}if(A=="topOutside"){F=F-D.clientHeight}else{if(A=="bottomOutside"){F=F+H.clientHeight}}left+=(C.left||0);F+=(C.top||0);n2i.setStyle(D,{"left":left+"px","top":F+"px"});if(E=="none"){n2i.setStyle(D,{"visibility":"visible","display":"none"})}};In2iGui.getTextAreaHeight=function(A){var D=this.textAreaDummy;if(!D){var D=this.textAreaDummy=document.createElement("div");D.className="in2igui_textarea_dummy";document.body.appendChild(D)}var C=A.value;if(C[C.length-1]==="\n"){C+="x"}C=n2i.escape(C).replace(/\n/g,"<br/>");D.innerHTML=C;D.style.width=(A.clientWidth)+"px";return D.clientHeight};In2iGui.extend=function(D,A){if(!D.name){In2iGui.latestObjectIndex++;D.name="unnamed"+In2iGui.latestObjectIndex}if(A!==undefined){if(D.options){D.options=n2i.override(D.options,A)}D.element=n2i.get(A.element);D.name=A.name}var C=In2iGui.get();C.objects[D.name]=D;D.delegates=[];D.listen=function(E){n2i.addToArray(this.delegates,E);return this};D.removeDelegate=function(E){n2i.removeFromArray(this.delegates,E)};D.clearDelegates=function(){this.delegates=[]};D.fire=function(H,F,E){In2iGui.callDelegates(this,H,F,E)};D.fireProperty=function(E,F){In2iGui.firePropertyChange(this,E,F)};if(!D.getElement){D.getElement=function(){return this.element}}if(!D.valueForProperty){D.valueForProperty=function(E){return this[E]}}if(D["$$layout"]){C.layoutWidgets.push(D)}};In2iGui.callDelegatesDrop=function(C,F){var D=In2iGui.get();var A=null;for(var E=0;E<D.delegates.length;E++){if(D.delegates[E]["$drop$"+C.kind+"$"+F.kind]){D.delegates[E]["$drop$"+C.kind+"$"+F.kind](C,F)}}};In2iGui.callAncestors=function(E,H,D,C){if(typeof (D)=="undefined"){D=E}var F=In2iGui.get().getAncestors(E);for(var A=0;A<F.length;A++){if(F[A][H]){F[A][H](D,C)}}};In2iGui.callDescendants=function(E,H,D,C){if(typeof (D)=="undefined"){D=E}if(!H[0]=="$"){H="$"+H}var F=In2iGui.get().getDescendants(E);for(var A=0;A<F.length;A++){if(F[A][H]){thisResult=F[A][H](D,C)}}};In2iGui.callVisible=function(A){In2iGui.callDescendants(A,"$visibilityChanged")};In2iGui.listen=function(A){In2iGui.get().listen(A)};In2iGui.callDelegates=function(F,A,J,C){if(typeof (J)=="undefined"){J=F}var K=null;if(F.delegates){for(var H=0;H<F.delegates.length;H++){var I=F.delegates[H];var D=null;if(F.name&&I["$"+A+"$"+F.name]){D=I["$"+A+"$"+F.name](J,C)}else{if(I["$"+A]){D=I["$"+A](J,C)}}if(K==null&&D!=null&&typeof (D)!="undefined"){K=D}}}var E=In2iGui.callSuperDelegates(F,A,J,C);if(K==null&&E!=null){K=E}return K};In2iGui.callSuperDelegates=function(F,A,J,C){if(typeof (J)=="undefined"){J=F}var D=In2iGui.get();var K=null;for(var H=0;H<D.delegates.length;H++){var I=D.delegates[H];var E=null;if(F.name&&I["$"+A+"$"+F.name]){E=I["$"+A+"$"+F.name](J,C)}else{if(I["$"+A]){E=I["$"+A](J,C)}}if(K==null&&E!=null&&typeof (E)!="undefined"){K=E}}return K};In2iGui.resolveImageUrl=function(I,D,H,A){for(var E=0;E<I.delegates.length;E++){if(I.delegates[E].$resolveImageUrl){return I.delegates[E].$resolveImageUrl(D,H,A)}}var C=In2iGui.get();for(var E=0;E<C.delegates.length;E++){var F=C.delegates[E];if(F.$resolveImageUrl){return F.$resolveImageUrl(D,H,A)}}return null};In2iGui.firePropertyChange=function(D,A,C){In2iGui.callDelegates(D,"propertyChanged",{property:A,value:C})};In2iGui.bind=function(F,A){if(F.charAt(0)=="@"){var E=F.substring(1).split(".");var D=In2iGui.get(E[0]);if(!D){n2i.log("Unable to bind to "+F);return }var C=E.slice(1).join(".");D.listen({$propertyChanged:function(H){if(H.property==C){A(H.value)}}});return D.valueForProperty(C)}return F};In2iGui.request=function(A){A=n2i.override({method:"post",parameters:{}},A);if(A.json){for(key in A.json){A.parameters[key]=n2i.toJSON(A.json[key])}}var D=A.onSuccess;A.onSuccess=function(F){if(typeof (D)=="string"){if(!n2i.request.isXMLResponse(F)){var H=F.responseText.replace(/^\s+|\s+$/g,"");if(H.length>0){var E=n2i.fromJSON(F.responseText)}else{E=""}In2iGui.callDelegates(E,"success$"+D)}else{In2iGui.callDelegates(F,"success$"+D)}}else{if(n2i.request.isXMLResponse(F)&&A.onXML){A.onXML(F.responseXML)}else{if(A.onJSON){var H=F.responseText.replace(/^\s+|\s+$/g,"");if(H.length>0){var E=n2i.fromJSON(F.responseText)}else{var E=null}A.onJSON(E)}else{if(typeof (D)=="function"){D(F)}else{if(A.onText){A.onText(F.responseText)}}}}}};var C=A.onFailure;A.onFailure=function(E){if(typeof (C)=="string"){In2iGui.callDelegates(E,"failure$"+C)}else{if(typeof (C)=="function"){C(E)}}};A.onException=function(E,F){n2i.log(F)};n2i.request(A)};In2iGui.parseItems=function(D){var A=D.documentElement;var C=[];In2iGui.parseSubItems(A,C);return C};In2iGui.parseSubItems=function(E,H){var C=E.childNodes;for(var A=0;A<C.length;A++){var F=C[A];if(F.nodeType==1&&F.nodeName=="title"){H.push({title:F.getAttribute("title"),type:"title"})}else{if(F.nodeType==1&&F.nodeName=="item"){var D=[];In2iGui.parseSubItems(F,D);H.push({title:F.getAttribute("title"),value:F.getAttribute("value"),icon:F.getAttribute("icon"),kind:F.getAttribute("kind"),badge:F.getAttribute("badge"),children:D})}}}};In2iGui.Bundle=function(A){this.strings=A};In2iGui.Bundle.prototype={get:function(C){var A=this.strings[C];if(A){return A[In2iGui.language]}n2i.log(C+" not found for language:"+In2iGui.language);return C}};In2iGui.Source=function(A){this.options=n2i.override({url:null,dwr:null,parameters:[],lazy:false},A);this.name=A.name;this.data=null;this.parameters=this.options.parameters;In2iGui.extend(this);if(A.delegate){this.listen(A.delegate)}this.busy=false;In2iGui.onDomReady(this.init.bind(this))};In2iGui.Source.prototype={init:function(){var A=this;n2i.each(this.parameters,function(D){var C=In2iGui.bind(D.value,function(E){A.changeParameter(D.key,E)});D.value=A.convertValue(C)});if(!this.options.lazy){this.refresh()}},convertValue:function(A){if(A&&A.getTime){return A.getTime()}return A},refresh:function(){if(this.delegates.length==0){return }for(var i=0;i<this.delegates.length;i++){var d=this.delegates[i];if(d["$sourceShouldRefresh"]&&d["$sourceShouldRefresh"]()==false){return }}if(this.busy){this.pendingRefresh=true;return }this.pendingRefresh=false;var self=this;if(this.options.url){var prms={};for(var i=0;i<this.parameters.length;i++){var p=this.parameters[i];prms[p.key]=p.value}this.busy=true;In2iGui.callDelegates(this,"sourceIsBusy");n2i.request({method:"post",url:this.options.url,parameters:prms,onSuccess:function(t){self.parse(t)},onException:function(e,t){n2i.log("Exception while loading source...");n2i.log(e)},onFailure:function(t){In2iGui.callDelegates(self,"sourceFailed")}})}else{if(this.options.dwr){var pair=this.options.dwr.split(".");var facade=eval(pair[0]);var method=pair[1];var args=facade[method].argumentNames();for(var i=0;i<args.length;i++){if(this.parameters[i]){args[i]=this.parameters[i].value===undefined?null:this.parameters[i].value}}args[args.length-1]=function(r){self.parseDWR(r)};this.busy=true;In2iGui.callDelegates(this,"sourceIsBusy");facade[method].apply(facade,args)}}},end:function(){In2iGui.callDelegates(this,"sourceIsNotBusy");this.busy=false;if(this.pendingRefresh){this.refresh()}},parse:function(C){if(C.responseXML&&C.responseXML.documentElement&&C.responseXML.documentElement.nodeName!="parsererror"){this.parseXML(C.responseXML)}else{var D=C.responseText.replace(/^\s+|\s+$/g,"");if(D.length>0){var A=n2i.fromJSON(C.responseText)}else{var A=null}this.fire("objectsLoaded",A)}this.end()},parseXML:function(A){if(A.documentElement.tagName=="items"){this.data=In2iGui.parseItems(A);this.fire("itemsLoaded",this.data)}else{if(A.documentElement.tagName=="list"){this.fire("listLoaded",A)}else{if(A.documentElement.tagName=="articles"){this.fire("articlesLoaded",A)}}}},parseDWR:function(A){this.data=A;this.fire("objectsLoaded",A);this.end()},addParameter:function(A){this.parameters.push(A)},changeParameter:function(C,D){D=this.convertValue(D);for(var A=0;A<this.parameters.length;A++){var E=this.parameters[A];if(E.key==C){E.value=D}}window.clearTimeout(this.paramDelay);this.paramDelay=window.setTimeout(function(){this.refresh()}.bind(this),100)}};In2iGui.getDragProxy=function(){if(!In2iGui.dragProxy){In2iGui.dragProxy=n2i.build("div",{"class":"in2igui_dragproxy",style:"display:none"});document.body.appendChild(In2iGui.dragProxy)}return In2iGui.dragProxy};In2iGui.startDrag=function(F,D,A){F=new n2i.Event(F);var E=D.dragDropInfo;In2iGui.dropTypes=In2iGui.findDropTypes(E);if(!In2iGui.dropTypes){return }var C=In2iGui.getDragProxy();n2i.listen(document.body,"mousemove",In2iGui.dragListener);n2i.listen(document.body,"mouseup",In2iGui.dragEndListener);In2iGui.dragInfo=E;if(E.icon){C.style.backgroundImage="url("+In2iGui.getIconUrl(E.icon,1)+")"}In2iGui.startDragPos={top:F.top(),left:F.left()};C.innerHTML=E.title?"<span>"+n2i.escape(E.title)+"</span>":"###";In2iGui.dragging=true;document.body.onselectstart=function(){return false}};In2iGui.findDropTypes=function(E){var A=In2iGui.get();var H=null;for(var D=0;D<A.delegates.length;D++){if(A.delegates[D].dragDrop){for(var C=0;C<A.delegates[D].dragDrop.length;C++){var F=A.delegates[D].dragDrop[C];if(F.drag==E.kind){if(H==null){H={}}H[F.drop]={}}}}}return H};In2iGui.dragListener=function(C){C=new n2i.Event(C);In2iGui.dragProxy.style.left=(C.left()+10)+"px";In2iGui.dragProxy.style.top=C.top()+"px";In2iGui.dragProxy.style.display="block";var A=In2iGui.findDropTarget(C.getElement());if(A&&In2iGui.dropTypes[A.dragDropInfo["kind"]]){if(In2iGui.latestDropTarget){n2i.removeClass(In2iGui.latestDropTarget,"in2igui_drop")}n2i.addClass(A,"in2igui_drop");In2iGui.latestDropTarget=A}else{if(In2iGui.latestDropTarget){n2i.removeClass(In2iGui.latestDropTarget,"in2igui_drop");In2iGui.latestDropTarget=null}}return false};In2iGui.findDropTarget=function(A){while(A){if(A.dragDropInfo){return A}A=A.parentNode}return null};In2iGui.dragEndListener=function(A){n2i.unListen(document.body,"mousemove",In2iGui.dragListener);n2i.unListen(document.body,"mouseup",In2iGui.dragEndListener);In2iGui.dragging=false;if(In2iGui.latestDropTarget){n2i.removeClass(In2iGui.latestDropTarget,"in2igui_drop");In2iGui.callDelegatesDrop(In2iGui.dragInfo,In2iGui.latestDropTarget.dragDropInfo);In2iGui.dragProxy.style.display="none"}else{n2i.ani(In2iGui.dragProxy,"left",(In2iGui.startDragPos.left+10)+"px",200,{ease:n2i.ease.fastSlow});n2i.ani(In2iGui.dragProxy,"top",(In2iGui.startDragPos.top-5)+"px",200,{ease:n2i.ease.fastSlow,hideOnComplete:true})}In2iGui.latestDropTarget=null;document.body.onselectstart=null};In2iGui.dropOverListener=function(A){if(In2iGui.dragging){}};In2iGui.dropOutListener=function(A){if(In2iGui.dragging){}};In2iGui.Window=function(A){this.element=n2i.get(A.element);this.name=A.name;this.close=n2i.firstByClass(this.element,"in2igui_window_close");this.titlebar=n2i.firstByClass(this.element,"in2igui_window_titlebar");this.title=n2i.firstByClass(this.titlebar,"in2igui_window_title");this.content=n2i.firstByClass(this.element,"in2igui_window_body");this.front=n2i.firstByClass(this.element,"in2igui_window_front");this.back=n2i.firstByClass(this.element,"in2igui_window_back");if(this.back){n2i.effect.makeFlippable({container:this.element,front:this.front,back:this.back})}this.visible=false;In2iGui.extend(this);this.addBehavior()};In2iGui.Window.create=function(A){A=n2i.override({title:"Window",close:true},A);var C='<div class="in2igui_window_front">'+(A.close?'<div class="in2igui_window_close"></div>':"")+'<div class="in2igui_window_titlebar"><div><div>';if(A.icon){C+='<span class="in2igui_window_icon" style="background-image: url('+In2iGui.getIconUrl(A.icon,1)+')"></span>'}C+='<span class="in2igui_window_title">'+A.title+'</span></div></div></div><div class="in2igui_window_content"><div class="in2igui_window_content"><div class="in2igui_window_body" style="'+(A.width?"width:"+A.width+"px;":"")+(A.padding?"padding:"+A.padding+"px;":"")+'"></div></div></div><div class="in2igui_window_bottom"><div class="in2igui_window_bottom"><div class="in2igui_window_bottom"></div></div></div></div>';A.element=n2i.build("div",{"class":"in2igui_window"+(A.variant?" in2igui_window_"+A.variant:""),html:C,parent:document.body});return new In2iGui.Window(A)};In2iGui.Window.prototype={addBehavior:function(){var A=this;if(this.close){n2i.listen(this.close,"click",function(C){this.hide();this.fire("userClosedWindow")}.bind(this));n2i.listen(this.close,"mousedown",function(C){n2i.stop(C)})}this.titlebar.onmousedown=function(C){A.startDrag(C);return false};n2i.listen(this.element,"mousedown",function(){A.element.style.zIndex=In2iGui.nextPanelIndex()})},setTitle:function(A){this.title.update(A)},show:function(A){if(this.visible){return }A=A||{};n2i.setStyle(this.element,{zIndex:In2iGui.nextPanelIndex(),visibility:"hidden",display:"block"});var C=this.element.clientWidth;n2i.setStyle(this.element,{width:C+"px",visibility:"visible"});if(A.avoid){n2i.place({insideViewPort:true,target:{element:A.avoid,vertical:0.5,horizontal:1},source:{element:this.element,vertical:0.5,horizontal:0}})}else{if(!this.element.style.top){this.element.style.top=(n2i.getScrollTop()+40)+"px"}if(!this.element.style.left){this.element.style.left=Math.round((n2i.getViewPortWidth()-C)/2)+"px"}}if(!n2i.browser.msie){n2i.ani(this.element,"opacity",1,0)}this.visible=true;In2iGui.callVisible(this)},toggle:function(){(this.visible?this.hide():this.show())},hide:function(){if(!this.visible){return }if(!n2i.browser.msie){n2i.ani(this.element,"opacity",0,200,{hideOnComplete:true})}else{this.element.style.display="none"}this.visible=false},add:function(A){if(A.getElement){this.content.appendChild(A.getElement())}else{this.content.appendChild(A)}},addToBack:function(A){if(!this.back){this.back=n2i.build("div",{className:"in2igui_window_back"});this.element.insertBefore(this.back,this.front);n2i.effect.makeFlippable({container:this.element,front:this.front,back:this.back})}this.back.appendChild(In2iGui.getElement(A))},setVariant:function(A){n2i.removeClass(this.element,"in2igui_window_dark");n2i.removeClass(this.element,"in2igui_window_light");if(A=="dark"||A=="light"){n2i.addClass(this.element,"in2igui_window_"+A)}},flip:function(){if(this.back){this.back.style.minHeight=this.element.clientHeight+"px";n2i.effect.flip({element:this.element})}},startDrag:function(D){var C=new n2i.Event(D);this.element.style.zIndex=In2iGui.nextPanelIndex();var E={top:n2i.getTop(this.element),left:n2i.getLeft(this.element)};this.dragState={left:C.left()-E.left,top:C.top()-E.top};this.latestPosition={left:this.dragState.left,top:this.dragState.top};this.latestTime=new Date().getMilliseconds();var A=this;this.moveListener=function(F){A.drag(F)};this.upListener=function(F){A.endDrag(F)};n2i.listen(document,"mousemove",this.moveListener);n2i.listen(document,"mouseup",this.upListener);n2i.listen(document,"mousedown",this.upListener);C.stop();document.body.onselectstart=function(){return false};return false},calc:function(C,A){this.a=this.latestPosition.left-A;this.b=this.latestPosition.top-C;this.dist=Math.sqrt(Math.pow((this.a),2),Math.pow((this.b),2));this.latestTime=new Date().getMilliseconds();this.latestPosition={"top":C,"left":A}},drag:function(E){var A=new n2i.Event(E);this.element.style.right="auto";var D=(A.top()-this.dragState.top);var C=(A.left()-this.dragState.left);this.element.style.top=Math.max(D,0)+"px";this.element.style.left=Math.max(C,0)+"px";return false},endDrag:function(A){n2i.unListen(document,"mousemove",this.moveListener);n2i.unListen(document,"mouseup",this.upListener);n2i.unListen(document,"mousedown",this.upListener);document.body.onselectstart=null}};In2iGui.Formula=function(A){this.options=A;In2iGui.extend(this,A);this.addBehavior()};In2iGui.Formula.create=function(A){A=A||{};var C={"class":"in2igui_formula"};if(A.action){C.action=A.action}if(A.method){C.method=A.method}A.element=n2i.build("form",C);return new In2iGui.Formula(A)};In2iGui.Formula.prototype={addBehavior:function(){this.element.onsubmit=function(){return false}},submit:function(){this.fire("submit")},getValues:function(){var C={};var D=In2iGui.get().getDescendants(this);for(var A=0;A<D.length;A++){if(D[A].options&&D[A].options.key&&D[A].getValue){C[D[A].options.key]=D[A].getValue()}else{if(D[A].name&&D[A].getValue){C[D[A].name]=D[A].getValue()}}}return C},setValues:function(A){var E=In2iGui.get().getDescendants(this);for(var D=0;D<E.length;D++){if(E[D].options&&E[D].options.key){var C=E[D].options.key;if(C&&A[C]!=undefined){E[D].setValue(A[C])}}}},focus:function(){var C=In2iGui.get().getDescendants(this);for(var A=0;A<C.length;A++){if(C[A].focus){C[A].focus();return }}},reset:function(){var C=In2iGui.get().getDescendants(this);for(var A=0;A<C.length;A++){if(C[A].reset){C[A].reset()}}},add:function(A){this.element.appendChild(A.getElement())},createGroup:function(A){var C=In2iGui.Formula.Group.create(A);this.add(C);return C},buildGroup:function(A,D){var C=this.createGroup(A);n2i.each(D,function(F){if(In2iGui.Formula[F.type]){var E=In2iGui.Formula[F.type].create(F.options);C.add(E)}});return C},childValueChanged:function(A){this.fire("valuesChanged",this.getValues())},show:function(){this.element.style.display=""},hide:function(){this.element.style.display="none"}};In2iGui.Formula.Group=function(A){this.name=A.name;this.element=n2i.get(A.element);this.body=n2i.firstByTag(this.element,"tbody");this.options=n2i.override({above:true},A);In2iGui.extend(this)};In2iGui.Formula.Group.create=function(A){A=n2i.override({above:true},A);var C=A.element=n2i.build("table",{"class":"in2igui_formula_group"});if(A.above){n2i.addClass(C,"in2igui_formula_group_above")}C.appendChild(n2i.build("tbody"));return new In2iGui.Formula.Group(A)};In2iGui.Formula.Group.prototype={add:function(F){var E=n2i.build("tr");this.body.appendChild(E);var H=n2i.build("td",{"class":"in2igui_formula_group"});if(F.getLabel){var A=F.getLabel();if(A){if(this.options.above){n2i.build("label",{text:A,parent:H})}else{var D=n2i.build("th",{parent:E});n2i.build("label",{text:A,parent:D})}}}var C=n2i.build("div",{"class":"in2igui_formula_item"});C.appendChild(F.getElement());H.appendChild(C);E.appendChild(H)},createButtons:function(C){var D=n2i.build("tr",{parent:this.body});var E=n2i.build("td",{colspan:this.options.above?1:2,parent:D});var A=In2iGui.Buttons.create(C);E.appendChild(A.getElement());return A}};In2iGui.Formula.Text=function(C){this.options=n2i.override({label:null,key:null,lines:1,live:false,maxHeight:100},C);this.element=n2i.get(C.element);this.name=C.name;In2iGui.extend(this);this.input=n2i.firstByClass(this.element,"in2igui_formula_text");this.multiline=this.input.tagName.toLowerCase()=="textarea";this.placeholder=n2i.firstByClass(this.element,"in2igui_field_placeholder");this.value=this.input.value;if(this.placeholder){var A=this;In2iGui.onDomReady(function(){window.setTimeout(function(){A.value=A.input.value;A.updateClass()},500)})}this.addBehavior()};In2iGui.Formula.Text.create=function(C){C=n2i.override({lines:1},C);var D,A;if(C.lines>1||C.multiline){A=n2i.build("textarea",{"class":"in2igui_formula_text","rows":C.lines,style:"height: 32px;"});D=n2i.build("span",{"class":"in2igui_formula_text_multiline"});D.appendChild(A)}else{A=n2i.build("input",{"class":"in2igui_formula_text"});D=n2i.build("span",{"class":"in2igui_field_singleline"});D.appendChild(A)}if(C.value!==undefined){A.value=C.value}C.element=In2iGui.wrapInField(D);return new In2iGui.Formula.Text(C)};In2iGui.Formula.Text.prototype={addBehavior:function(){In2iGui.addFocusClass({element:this.input,classElement:this.element,"class":"in2igui_field_focused"});n2i.listen(this.input,"keyup",this.onKeyUp.bind(this));var A=this.element.getElementsByTagName("em")[0];if(A){this.updateClass();n2i.listen(A,"mousedown",function(){window.setTimeout(function(){this.input.focus();this.input.select()}.bind(this))}.bind(this));n2i.listen(A,"mouseup",function(){this.input.focus();this.input.select()}.bind(this))}},updateClass:function(){n2i.setClass(this.element,"in2igui_field_dirty",this.value.length>0)},onKeyUp:function(C){if(!this.multiline&&C.keyCode===n2i.KEY_RETURN){this.fire("submit");var A=In2iGui.get().getAncestor(this,"in2igui_formula");if(A){A.submit()}return }if(this.input.value==this.value){return }this.value=this.input.value;this.updateClass();this.expand(true);In2iGui.callAncestors(this,"childValueChanged",this.input.value);this.fire("valueChanged",this.input.value)},updateFromNode:function(A){if(A.firstChild){this.setValue(A.firstChild.nodeValue)}else{this.setValue(null)}},updateFromObject:function(A){this.setValue(A.value)},focus:function(){try{this.input.focus()}catch(A){}},select:function(){try{this.input.focus();this.input.select()}catch(A){}},reset:function(){this.setValue("")},setValue:function(A){if(A===undefined||A===null){A=""}this.value=A;this.input.value=A;this.expand(true)},getValue:function(){return this.input.value},getLabel:function(){return this.options.label},isEmpty:function(){return this.input.value==""},isBlank:function(){return this.input.value.strip()==""},setError:function(A){var C=A?true:false;n2i.setClass(this.element,"in2igui_field_error",C);if(typeof (A)=="string"){In2iGui.showToolTip({text:A,element:this.element,key:this.name})}if(!C){In2iGui.hideToolTip({key:this.name})}},$visibilityChanged:function(){window.setTimeout(this.expand.bind(this))},expand:function(A){if(!this.multiline){return }if(!n2i.dom.isVisible(this.element)){return }var C=In2iGui.getTextAreaHeight(this.input);C=Math.max(32,C);C=Math.min(C,this.options.maxHeight);if(A){this.updateOverflow();n2i.animate(this.input,"height",C+"px",300,{ease:n2i.ease.slowFastSlow,onComplete:function(){this.updateOverflow()}.bind(this)})}else{this.input.style.height=C+"px";this.updateOverflow()}},updateOverflow:function(){if(!this.multiline){return }this.input.style.overflowY=this.input.clientHeight>=this.options.maxHeight?"auto":"hidden"}};In2iGui.Formula.DateTime=function(A){this.inputFormats=["d-m-Y","d/m-Y","d/m/Y","d-m-Y H:i:s","d/m-Y H:i:s","d/m/Y H:i:s","d-m-Y H:i","d/m-Y H:i","d/m/Y H:i","d-m-Y H","d/m-Y H","d/m/Y H","d-m","d/m","d","Y","m-d-Y","m-d","m/d"];this.outputFormat="d-m-Y H:i:s";this.name=A.name;this.element=n2i.get(A.element);this.input=n2i.firstByTag(this.element,"input");this.options=n2i.override({returnType:null,label:null,allowNull:true,value:null},A);this.value=this.options.value;In2iGui.extend(this);this.addBehavior();this.updateUI()};In2iGui.Formula.DateTime.create=function(A){var C=n2i.build("span",{"class":"in2igui_formula_text_singleline"});n2i.build("input",{"class":"in2igui_formula_text",parent:C});A.element=In2iGui.wrapInField(C);return new In2iGui.Formula.DateTime(A)};In2iGui.Formula.DateTime.prototype={addBehavior:function(){In2iGui.addFocusClass({element:this.input,classElement:this.element,"class":"in2igui_field_focused"});n2i.listen(this.input,"blur",this.check.bind(this))},updateFromNode:function(A){if(A.firstChild){this.setValue(A.firstChild.nodeValue)}else{this.setValue(null)}},updateFromObject:function(A){this.setValue(A.value)},focus:function(){try{this.input.focus()}catch(A){}},reset:function(){this.setValue("")},setValue:function(A){if(!A){this.value=null}else{if(A.constructor==Date){this.value=A}else{this.value=new Date();this.value.setTime(parseInt(A)*1000)}}this.updateUI()},check:function(){var D=this.input.value;var A=null;for(var C=0;C<this.inputFormats.length&&A==null;C++){A=Date.parseDate(D,this.inputFormats[C])}if(this.options.allowNull||A!=null){this.value=A}this.updateUI()},getValue:function(){if(this.value!=null&&this.options.returnType=="seconds"){return Math.round(this.value.getTime()/1000)}return this.value},getElement:function(){return this.element},getLabel:function(){return this.options.label},updateUI:function(){if(this.value){this.input.value=this.value.dateFormat(this.outputFormat)}else{this.input.value=""}}};In2iGui.Formula.Number=function(C){this.options=n2i.override({min:0,max:10000,value:null,decimals:0,allowNull:false},C);this.name=C.name;var A=this.element=n2i.get(C.element);this.input=n2i.firstByTag(A,"input");this.up=n2i.firstByClass(A,"in2igui_number_up");this.down=n2i.firstByClass(A,"in2igui_number_down");this.value=this.options.value;In2iGui.extend(this);this.addBehavior()};In2iGui.Formula.Number.create=function(A){A.element=n2i.build("span",{"class":"in2igui_number",html:'<span><span><input type="text" value="'+(A.value!==undefined?A.value:"0")+'"/><a class="in2igui_number_up"></a><a class="in2igui_number_down"></a></span></span>'});return new In2iGui.Formula.Number(A)};In2iGui.Formula.Number.prototype={addBehavior:function(){var A=this.element;n2i.listen(this.input,"focus",function(){n2i.addClass(A,"in2igui_number_focused")});n2i.listen(this.input,"blur",this.blurEvent.bind(this));n2i.listen(this.input,"keyup",this.keyEvent.bind(this));n2i.listen(this.up,"mousedown",this.upEvent.bind(this));n2i.listen(this.down,"mousedown",this.downEvent.bind(this))},blurEvent:function(){n2i.removeClass(this.element,"in2igui_number_focused");this.updateField()},keyEvent:function(C){C=C||window.event;if(C.keyCode==n2i.KEY_UP){n2i.stop(C);this.upEvent()}else{if(C.keyCode==n2i.KEY_DOWN){this.downEvent()}else{var A=parseInt(this.input.value,10);if(!isNaN(A)){this.setLocalValue(A,true)}else{this.setLocalValue(null,true)}}}},downEvent:function(){if(this.value===null){this.setLocalValue(this.options.min,true)}else{this.setLocalValue(this.value-1,true)}this.updateField()},upEvent:function(){this.setLocalValue(this.value+1,true);this.updateField()},getValue:function(){return this.value},getLabel:function(){return this.options.label},setValue:function(A){A=parseInt(A,10);if(!isNaN(A)){this.setLocalValue(A,false)}this.updateField()},updateField:function(){this.input.value=this.value===null||this.value===undefined?"":this.value},setLocalValue:function(C,A){var D=this.value;if(C===null||C===undefined&&this.options.allowNull){this.value=null}else{this.value=Math.min(Math.max(C,this.options.min),this.options.max)}if(A&&D!==this.value){In2iGui.callAncestors(this,"childValueChanged",this.value);this.fire("valueChanged",this.value)}},reset:function(){if(this.options.allowNull){this.value=null}else{this.value=Math.min(Math.max(0,this.options.min),this.options.max)}this.updateField()}};In2iGui.Formula.DropDown=function(C){this.options=n2i.override({label:null,placeholder:null,url:null,source:null},C);this.name=C.name;var A=this.element=n2i.get(C.element);this.inner=A.getElementsByTagName("strong")[0];this.items=C.items||[];this.index=-1;this.value=this.options.value||null;this.dirty=true;In2iGui.extend(this);this.addBehavior();this.updateIndex();this.updateUI();if(this.options.url){this.options.source=new In2iGui.Source({url:this.options.url,delegate:this})}else{if(this.options.source){this.options.source.listen(this)}}};In2iGui.Formula.DropDown.create=function(A){A=A||{};A.element=n2i.build("a",{"class":"in2igui_dropdown",href:"#",html:"<span><span><strong></strong></span></span>"});return new In2iGui.Formula.DropDown(A)};In2iGui.Formula.DropDown.prototype={addBehavior:function(){In2iGui.addFocusClass({element:this.element,"class":"in2igui_dropdown_focused"});n2i.listen(this.element,"click",this.clicked.bind(this));n2i.listen(this.element,"blur",this.hideSelector.bind(this));n2i.listen(this.element,"keydown",this._keyDown.bind(this))},updateIndex:function(){this.index=-1;for(var A=0;A<this.items.length;A++){if(this.items[A].value==this.value){this.index=A}}},updateUI:function(){var C=this.items[this.index];if(C){var D=C.label||C.title||"";this.inner.innerHTML="";n2i.dom.addText(this.inner,n2i.wrap(D))}else{if(this.options.placeholder){this.inner.innerHTML="";this.inner.appendChild(n2i.build("em",{text:n2i.escape(this.options.placeholder)}))}else{this.inner.innerHTML=""}}if(!this.selector){return }var A=this.selector.getElementsByTagName("a");n2i.each(A,function(E,F){if(this.index==F){n2i.addClass(E,"in2igui_selected")}else{E.className=""}}.bind(this))},clicked:function(J){n2i.stop(J);this.buildSelector();var F=this.element,E=this.selector;F.focus();if(!this.items){return }var C=n2i.getDocumentHeight();if(C<200){var I=n2i.getLeft(this.element);n2i.setStyle(this.selector,{"left":I+"px",top:"5px"})}else{n2i.place({target:{element:this.element,vertical:1,horizontal:0},source:{element:this.selector,vertical:0,horizontal:0}})}n2i.setStyle(E,{visibility:"hidden",display:"block",width:""});var A=Math.min(C-n2i.getTop(E)-5,200);var D=Math.max(F.clientWidth-5,100,E.clientWidth+20);var H=n2i.getViewPortWidth()-n2i.getLeft(F)-20;D=Math.min(D,H);n2i.setStyle(E,{visibility:"visible",width:D+"px",zIndex:In2iGui.nextTopIndex(),maxHeight:A+"px"})},getValue:function(){return this.value},_keyDown:function(A){if(this.items.length==0){return }if(A.keyCode==40){n2i.stop(A);if(this.index>=this.items.length-1){this.value=this.items[0].value}else{this.value=this.items[this.index+1].value}this.updateIndex();this.updateUI();this.fireChange()}else{if(A.keyCode==38){n2i.stop(A);if(this.index>0){this.index--}else{this.index=this.items.length-1}this.value=this.items[this.index].value;this.updateUI();this.fireChange()}}},setValue:function(A){this.value=A;this.updateIndex();this.updateUI()},reset:function(){this.setValue(null)},getLabel:function(){return this.options.label},refresh:function(){if(this.options.source){this.options.source.refresh()}},getItem:function(A){if(this.index>=0){return this.items[this.index]}return 0},addItem:function(A){this.items.push(A);this.dirty=true;this.updateIndex();this.updateUI()},setItems:function(A){this.items=A;this.dirty=true;this.index=-1;this.updateIndex();this.updateUI()},$itemsLoaded:function(A){this.setItems(A)},hideSelector:function(){if(!this.selector){return }this.selector.style.display="none"},buildSelector:function(){if(!this.dirty||!this.items){return }if(!this.selector){this.selector=n2i.build("div",{"class":"in2igui_dropdown_selector"});document.body.appendChild(this.selector);n2i.listen(this.selector,"mousedown",function(C){n2i.stop(C)})}else{this.selector.innerHTML=""}var A=this;n2i.each(this.items,function(D,C){var E=n2i.build("a",{href:"#",text:D.label||D.title});n2i.listen(E,"mousedown",function(F){n2i.stop(F);A.itemClicked(D,C)});if(C==A.index){n2i.addClass(E,"in2igui_selected")}A.selector.appendChild(E)});this.dirty=false},itemClicked:function(C,A){this.index=A;var D=this.value!=this.items[A].value;this.value=this.items[A].value;this.updateUI();this.hideSelector();if(D){this.fireChange()}},fireChange:function(){In2iGui.callAncestors(this,"childValueChanged",this.value);this.fire("valueChanged",this.value)}};In2iGui.Formula.Radiobuttons=function(A){this.options=A;this.element=n2i.get(A.element);this.name=A.name;this.radios=[];this.value=A.value;this.defaultValue=this.value;In2iGui.extend(this)};In2iGui.Formula.Radiobuttons.prototype={click:function(){this.value=!this.value;this.updateUI()},updateUI:function(){for(var C=0;C<this.radios.length;C++){var A=this.radios[C];n2i.setClass(n2i.get(A.id),"in2igui_selected",A.value==this.value)}},setValue:function(A){this.value=A;this.updateUI()},getValue:function(){return this.value},reset:function(){this.setValue(this.defaultValue)},registerRadiobutton:function(C){this.radios.push(C);var D=n2i.get(C.id);var A=this;D.onclick=function(){A.setValue(C.value);A.fire("valueChanged",C.value)}}};In2iGui.Formula.Checkbox=function(A){this.element=n2i.get(A.element);this.control=n2i.firstByTag(this.element,"span");this.options=A;this.name=A.name;this.value=A.value==="true"||A.value===true;In2iGui.extend(this);this.addBehavior()};In2iGui.Formula.Checkbox.create=function(C){var A=C.element=n2i.build("a",{"class":"in2igui_checkbox",href:"#",html:"<span><span></span></span>"});if(C.value){n2i.addClass(A,"in2igui_checkbox_selected")}return new In2iGui.Formula.Checkbox(C)};In2iGui.Formula.Checkbox.prototype={addBehavior:function(){In2iGui.addFocusClass({element:this.element,"class":"in2igui_checkbox_focused"});n2i.listen(this.element,"click",this.click.bind(this))},click:function(A){n2i.stop(A);this.element.focus();this.value=!this.value;this.updateUI();In2iGui.callAncestors(this,"childValueChanged",this.value);this.fire("valueChanged",this.value)},updateUI:function(){n2i.setClass(this.element,"in2igui_checkbox_selected",this.value)},setValue:function(A){this.value=A===true||A==="true";this.updateUI()},getValue:function(){return this.value},reset:function(){this.setValue(false)},getLabel:function(){return this.options.label}};In2iGui.Formula.Checkboxes=function(A){this.options=A;this.element=n2i.get(A.element);this.name=A.name;this.items=A.items||[];this.sources=[];this.subItems=[];this.values=A.values||A.value||[];In2iGui.extend(this);this.addBehavior();this.updateUI();if(A.url){new In2iGui.Source({url:A.url,delegate:this})}};In2iGui.Formula.Checkboxes.create=function(A){A.element=n2i.build("div",{"class":A.vertical?"in2igui_checkboxes in2igui_checkboxes_vertical":"in2igui_checkboxes"});if(A.items){n2i.each(A.items,function(D){var C=n2i.build("a",{"class":"in2igui_checkbox",href:"javascript:void(0);",html:"<span><span></span></span>"+D.title});In2iGui.addFocusClass({element:C,"class":"in2igui_checkbox_focused"});A.element.appendChild(C)})}return new In2iGui.Formula.Checkboxes(A)};In2iGui.Formula.Checkboxes.prototype={addBehavior:function(){var A=n2i.byClass(this.element,"in2igui_checkbox");n2i.each(A,function(C,D){n2i.listen(C,"click",function(E){n2i.stop(E);this.flipValue(this.items[D].value)}.bind(this))}.bind(this))},getValue:function(){return this.values},getValues:function(){return this.values},checkValues:function(){var C=[];for(var D=0;D<this.values.length;D++){var F=this.values[D];var E=false;for(var A=0;A<this.items.length;A++){E=E||this.items[A].value===F}for(var A=0;A<this.subItems.length;A++){E=E||this.subItems[A].hasValue(F)}if(E){C.push(F)}}this.values=C},setValue:function(A){this.values=A;this.checkValues();this.updateUI()},setValues:function(A){this.setValue(A)},flipValue:function(A){n2i.flipInArray(this.values,A);this.checkValues();this.updateUI();this.fire("valueChanged",this.values);In2iGui.callAncestors(this,"childValueChanged",this.values)},updateUI:function(){for(var C=0;C<this.subItems.length;C++){this.subItems[C].updateUI()}var A=n2i.byClass(this.element,"in2igui_checkbox");for(var C=0;C<this.items.length;C++){var D=this.items[C];var E=n2i.inArray(this.values,D.value);n2i.setClass(A[C],"in2igui_checkbox_selected",E)}},refresh:function(){for(var A=0;A<this.subItems.length;A++){this.subItems[A].refresh()}},reset:function(){this.setValues([])},registerSource:function(A){A.parent=this;this.sources.push(A)},registerItem:function(A){if(parseInt(A.value)==A.value){A.value=parseInt(A.value)}this.items.push(A)},registerItems:function(A){A.parent=this;this.subItems.push(A)},getLabel:function(){return this.options.label},$itemsLoaded:function(A){n2i.each(A,function(D){var C=n2i.build("a",{"class":"in2igui_checkbox",href:"javascript:void(0);",html:"<span><span></span></span>"+n2i.escape(D.title)});n2i.listen(C,"click",function(E){n2i.stop(E);this.flipValue(D.value)}.bind(this));In2iGui.addFocusClass({element:C,"class":"in2igui_checkbox_focused"});this.element.appendChild(C);this.items.push(D)}.bind(this));this.checkValues();this.updateUI()}};In2iGui.Formula.Checkboxes.Items=function(A){this.element=n2i.get(A.element);this.name=A.name;this.parent=null;this.options=A;this.checkboxes=[];In2iGui.extend(this);if(this.options.source){this.options.source.listen(this)}};In2iGui.Formula.Checkboxes.Items.prototype={refresh:function(){if(this.options.source){this.options.source.refresh()}},$itemsLoaded:function(C){this.checkboxes=[];this.element.innerHTML="";var A=this;n2i.each(C,function(E){var D=n2i.build("a",{"class":"in2igui_checkbox",href:"#",html:"<span><span></span></span>"+E.title});n2i.listen(D,"click",function(F){n2i.stop(F);D.focus();A.itemWasClicked(E)});In2iGui.addFocusClass({element:D,"class":"in2igui_checkbox_focused"});A.element.appendChild(D);A.checkboxes.push({title:E.title,element:D,value:E.value})});this.parent.checkValues();this.updateUI()},itemWasClicked:function(A){this.parent.flipValue(A.value)},updateUI:function(){try{for(var C=0;C<this.checkboxes.length;C++){var D=this.checkboxes[C];var A=n2i.indexInArray(this.parent.values,D.value);n2i.setClass(D.element,"in2igui_checkbox_selected",A!=-1)}}catch(E){alert(typeof (this.parent.values));alert(E)}},hasValue:function(C){for(var A=0;A<this.checkboxes.length;A++){if(this.checkboxes[A].value==C){return true}}return false}};In2iGui.Formula.Tokens=function(A){this.options=n2i.override({label:null,key:null},A);this.element=n2i.get(A.element);this.name=A.name;this.value=[""];In2iGui.extend(this);this.updateUI()};In2iGui.Formula.Tokens.create=function(A){A=A||{};A.element=n2i.build("div",{"class":"in2igui_tokens"});return new In2iGui.Formula.Tokens(A)};In2iGui.Formula.Tokens.prototype={setValue:function(A){this.value=A;this.value.push("");this.updateUI()},reset:function(){this.value=[""];this.updateUI()},getValue:function(){var A=[];n2i.each(this.value,function(C){C=C.strip();if(C.length>0){A.push(C)}});return A},getLabel:function(){return this.options.label},updateUI:function(){this.element.innerHTML="";n2i.each(this.value,function(D,C){var A=n2i.build("input",{"class":"in2igui_tokens_token",parent:this.element});if(this.options.width){A.style.width=this.options.width+"px"}A.value=D;A.in2iguiIndex=C;n2i.listen(A,"keyup",function(){this.inputChanged(A,C)}.bind(this))}.bind(this))},inputChanged:function(A,C){if(C==this.value.length-1&&A.value!=this.value[C]){this.addField()}this.value[C]=A.value},addField:function(){var C=n2i.build("input",{"class":"in2igui_tokens_token"});if(this.options.width){C.style.width=this.options.width+"px"}var D=this.value.length;this.value.push("");this.element.appendChild(C);var A=this;n2i.listen(C,"keyup",function(){A.inputChanged(C,D)})}};In2iGui.Formula.StyleLength=function(D){this.options=n2i.override({value:null,min:0,max:1000,units:["px","pt","em","%"],defaultUnit:"px",allowNull:false},D);this.name=D.name;var C=this.element=n2i.get(D.element);this.input=n2i.firstByTag(C,"input");var A=C.getElementsByTagName("a");this.up=A[0];this.down=A[1];this.value=this.parseValue(this.options.value);In2iGui.extend(this);this.addBehavior()};In2iGui.Formula.StyleLength.prototype={addBehavior:function(){var A=this.element;n2i.listen(this.input,"focus",function(){n2i.addClass(A,"in2igui_number_focused")});n2i.listen(this.input,"blur",this.blurEvent.bind(this));n2i.listen(this.input,"keyup",this.keyEvent.bind(this));n2i.listen(this.up,"mousedown",this.upEvent.bind(this));n2i.listen(this.down,"mousedown",this.downEvent.bind(this))},parseValue:function(F){var C=parseFloat(F,10);if(isNaN(C)){return null}var A={number:C,unit:this.options.defaultUnit};for(var D=0;D<this.options.units.length;D++){var E=this.options.units[D];if(F.indexOf(E)!=-1){A.unit=E;break}}A.number=Math.max(this.options.min,Math.min(this.options.max,A.number));return A},blurEvent:function(){n2i.removeClass(this.element,"in2igui_number_focused");this.updateInput()},keyEvent:function(A){A=A||window.event;if(A.keyCode==n2i.KEY_UP){n2i.stop(A);this.upEvent()}else{if(A.keyCode==n2i.KEY_DOWN){this.downEvent()}else{this.checkAndSetValue(this.parseValue(this.input.value))}}},updateInput:function(){this.input.value=this.getValue()},checkAndSetValue:function(C){var A=this.value;var D=false;if(A===null&&C===null){}else{if(A!=null&&C!=null&&A.number===C.number&&A.unit===C.unit){}else{D=true}}this.value=C;if(D){this.fire("valueChanged",this.getValue())}},downEvent:function(){if(this.value){this.checkAndSetValue({number:Math.max(this.options.min,this.value.number-1),unit:this.value.unit})}else{this.checkAndSetValue({number:this.options.min,unit:this.options.defaultUnit})}this.updateInput()},upEvent:function(){if(this.value){this.checkAndSetValue({number:Math.min(this.options.max,this.value.number+1),unit:this.value.unit})}else{this.checkAndSetValue({number:this.options.min+1,unit:this.options.defaultUnit})}this.updateInput()},getValue:function(){return this.value?this.value.number+this.value.unit:""},setValue:function(A){this.value=this.parseValue(A);this.updateInput()}};In2iGui.Formula.Location=function(A){this.options=n2i.override({value:null},A);this.name=A.name;this.element=n2i.get(A.element);this.chooser=n2i.firstByTag(this.element,"a");this.latField=new In2iGui.TextField({element:n2i.firstByTag(this.element,"input"),validator:new In2iGui.NumberValidator({min:-90,max:90,allowNull:true})});this.latField.listen(this);this.lngField=new In2iGui.TextField({element:this.element.getElementsByTagName("input")[1],validator:new In2iGui.NumberValidator({min:-180,max:180,allowNull:true})});this.lngField.listen(this);this.value=this.options.value;In2iGui.extend(this);this.setValue(this.value);this.addBehavior()};In2iGui.Formula.Location.create=function(C){C=C||{};var D=C.element=n2i.build("div",{"class":"in2igui_location"});var A=n2i.build("span",{html:'<span class="in2igui_location_latitude"><span><input/></span></span><span class="in2igui_location_longitude"><span><input/></span></span>'});D.appendChild(In2iGui.wrapInField(A));D.appendChild(n2i.build("a",{"class":"in2igui_location_picker",href:"javascript:void(0);"}));return new In2iGui.Formula.Location(C)};In2iGui.Formula.Location.prototype={addBehavior:function(){n2i.listen(this.chooser,"click",this.showPicker.bind(this));In2iGui.addFocusClass({element:this.latField.element,classElement:this.element,"class":"in2igui_field_focused"});In2iGui.addFocusClass({element:this.lngField.element,classElement:this.element,"class":"in2igui_field_focused"})},getLabel:function(){return this.options.label},reset:function(){this.setValue()},getValue:function(){return this.value},setValue:function(A){if(A){this.latField.setValue(A.latitude);this.lngField.setValue(A.longitude);this.value=A}else{this.latField.setValue();this.lngField.setValue();this.value=null}this.updatePicker()},updatePicker:function(){if(this.picker){this.picker.setLocation(this.value)}},showPicker:function(){if(!this.picker){this.picker=new In2iGui.LocationPicker();this.picker.listen(this)}this.picker.show({node:this.chooser,location:this.value})},$locationChanged:function(A){this.setValue(A)},$valueChanged:function(){var C=this.latField.getValue();var A=this.lngField.getValue();if(C===null||A===null){this.value=null}else{this.value={latitude:C,longitude:A}}this.updatePicker()}};In2iGui.List=function(A){this.options=n2i.override({url:null,source:null},A);this.element=n2i.get(A.element);this.name=A.name;if(this.options.source){this.options.source.listen(this)}this.url=A.url;this.table=n2i.firstByTag(this.element,"table");this.head=n2i.firstByTag(this.element,"thead");this.body=n2i.firstByTag(this.element,"tbody");this.columns=[];this.rows=[];this.selected=[];this.navigation=n2i.firstByClass(this.element,"in2igui_list_navigation");this.count=n2i.firstByClass(this.navigation,"in2igui_list_count");this.windowPage=n2i.firstByClass(this.navigation,"window_page");this.windowPageBody=n2i.firstByClass(this.navigation,"window_page_body");this.parameters={};this.sortKey=null;this.sortDirection=null;this.window={size:null,page:0,total:0};if(A.windowSize!=""){this.window.size=parseInt(A.windowSize)}In2iGui.extend(this);if(this.url){this.refresh()}};In2iGui.List.create=function(A){A=n2i.override({},A);var C=A.element=n2i.build("div",{"class":"in2igui_list",html:'<div class="in2igui_list_navigation"><div class="in2igui_list_selection window_page"><div><div class="window_page_body"></div></div></div><span class="in2igui_list_count"></span></div><div class="in2igui_list_body"'+(A.maxHeight>0?' style="max-height: '+A.maxHeight+'px; overflow: auto;"':"")+'><table cellspacing="0" cellpadding="0"><thead><tr></tr></thead><tbody></tbody></table></div>'});return new In2iGui.List(A)};In2iGui.List.prototype={hide:function(){this.element.style.display="none"},show:function(){this.element.style.display="block";this.refresh()},registerColumn:function(A){this.columns.push(A)},getSelection:function(){var A=[];for(var C=0;C<this.selected.length;C++){A.push(this.rows[this.selected[C]])}return A},getFirstSelection:function(){var A=this.getSelection();if(A.length>0){return A[0]}else{return null}},setParameter:function(A,C){this.parameters[A]=C},loadData:function(A){this.setUrl(A)},setSource:function(A){if(this.options.source!=A){if(this.options.source){this.options.source.removeDelegate(this)}A.listen(this);this.options.source=A;A.refresh()}},setUrl:function(A){if(this.options.source){this.options.source.removeDelegate(this);this.options.source=null}this.url=A;this.selected=[];this.sortKey=null;this.sortDirection=null;this.resetState();this.refresh()},clear:function(){this.selected=[];this.columns=[];this.rows=[];this.navigation.style.display="none";n2i.dom.clear(this.body);n2i.dom.clear(this.head);if(this.options.source){this.options.source.removeDelegate(this)}this.options.source=null;this.url=null},resetState:function(){this.window={size:null,page:0,total:0};In2iGui.firePropertyChange(this,"window",this.window);In2iGui.firePropertyChange(this,"window.page",this.window.page)},valueForProperty:function(A){if(A=="window.page"){return this.window.page}if(A=="window.page"){return this.window.page}else{if(A=="sort.key"){return this.sortKey}else{if(A=="sort.direction"){return(this.sortDirection||"ascending")}else{return this[A]}}}},$sourceShouldRefresh:function(){return this.element.style.display!="none"},refresh:function(){if(this.options.source){this.options.source.refresh();return }if(!this.url){return }var A=this.url;if(typeof (this.window.page)=="number"){A+=A.indexOf("?")==-1?"?":"&";A+="windowPage="+this.window.page}if(this.window.size){A+=A.indexOf("?")==-1?"?":"&";A+="windowSize="+this.window.size}if(this.sortKey){A+=A.indexOf("?")==-1?"?":"&";A+="sort="+this.sortKey}if(this.sortDirection){A+=A.indexOf("?")==-1?"?":"&";A+="direction="+this.sortDirection}for(key in this.parameters){A+=A.indexOf("?")==-1?"?":"&";A+=key+"="+this.parameters[key]}In2iGui.request({url:A,onJSON:this.$objectsLoaded.bind(this),onXML:this.$listLoaded.bind(this)})},sort:function(A){var C=this.columns[A].key;if(C==this.sortKey){this.sortDirection=this.sortDirection=="ascending"?"descending":"ascending";In2iGui.firePropertyChange(this,"sort.direction",this.sortDirection)}else{In2iGui.firePropertyChange(this,"sort.key",C)}this.sortKey=C},$listLoaded:function(X){this.selected=[];this.parseWindow(X);this.buildNavigation();n2i.dom.clear(this.head);n2i.dom.clear(this.body);this.rows=[];this.columns=[];var U=document.createElement("tr");var T=X.getElementsByTagName("sort");this.sortKey=null;this.sortDirection=null;if(T.length>0){this.sortKey=T[0].getAttribute("key");this.sortDirection=T[0].getAttribute("direction")}var C=X.getElementsByTagName("header");for(var P=0;P<C.length;P++){var D="";var H=document.createElement("th");var M=C[P].getAttribute("width");var W=C[P].getAttribute("key");var E=C[P].getAttribute("sortable")=="true";if(M&&M!=""){H.style.width=M+"%"}if(E){var L=this;H.in2iguiIndex=P;H.onclick=function(){L.sort(this.in2iguiIndex)};D+="sortable"}if(this.sortKey&&W==this.sortKey){D+=" sort_"+this.sortDirection}H.className=D;var O=document.createElement("span");H.appendChild(O);O.appendChild(document.createTextNode(C[P].getAttribute("title")||""));U.appendChild(H);this.columns.push({"key":W,"sortable":E,"width":M})}this.head.appendChild(U);var A=document.createDocumentFragment();var K=X.getElementsByTagName("row");for(var P=0;P<K.length;P++){var F=K[P].getElementsByTagName("cell");var I=document.createElement("tr");var S=K[P].getAttribute("icon");var V=K[P].getAttribute("title");for(var N=0;N<F.length;N++){var J=document.createElement("td");this.parseCell(F[N],J);I.appendChild(J);if(!V){V=n2i.dom.getText(F[N])}if(!S){S=F[N].getAttribute("icon")}}var Q={id:K[P].getAttribute("id"),kind:K[P].getAttribute("kind"),icon:S,title:V,index:P};I.dragDropInfo=Q;this.addRowBehavior(I,P);A.appendChild(I);this.rows.push(Q)}this.body.appendChild(A);this.fire("selectionReset")},$objectsLoaded:function(A){if(A==null){}else{if(A.constructor==Array){this.setObjects(A)}else{this.setData(A)}}this.fire("selectionReset")},$sourceIsBusy:function(){this.busy=true;n2i.addClass(this.element,"in2igui_list_busy")},$sourceIsNotBusy:function(){this.busy=false;n2i.removeClass(this.element,"in2igui_list_busy")},filter:function(I){var A=20;var F=new RegExp("[\\w]{"+A+",}","g");var D=F.exec(I);if(D){for(var E=0;E<D.length;E++){var H="";for(var C=0;C<D[E].length;C++){H+=D[E][C];if((C+1)%A==0){H+="\u200B"}}I=I.replace(D[E],H)}}return I},parseCell:function(H,A){var F=H.getAttribute("icon");if(F!=null&&F!=""){A.appendChild(In2iGui.createIcon(F,1))}for(var E=0;E<H.childNodes.length;E++){var J=H.childNodes[E];if(n2i.dom.isDefinedText(J)){n2i.dom.addText(A,J.nodeValue)}else{if(n2i.dom.isElement(J,"break")){A.appendChild(document.createElement("br"))}else{if(n2i.dom.isElement(J,"icon")){A.appendChild(In2iGui.createIcon(J.getAttribute("icon"),1))}else{if(n2i.dom.isElement(J,"line")){var C=n2i.build("p",{"class":"in2igui_list_line"});if(J.getAttribute("dimmed")=="true"){n2i.addClass(C,"in2igui_list_dimmed")}A.appendChild(C);this.parseCell(J,C)}else{if(n2i.dom.isElement(J,"object")){var I=n2i.build("div",{"class":"object"});if(J.getAttribute("icon")){I.appendChild(In2iGui.createIcon(J.getAttribute("icon"),1))}if(J.firstChild&&J.firstChild.nodeType==n2i.TEXT_NODE&&J.firstChild.nodeValue.length>0){n2i.dom.addText(I,J.firstChild.nodeValue)}A.appendChild(I)}else{if(n2i.dom.isElement(J,"icons")){var D=n2i.build("span",{"class":"in2igui_list_icons"});this.parseCell(J,D);A.appendChild(D)}}}}}}}},parseWindow:function(C){var D=C.getElementsByTagName("window");if(D.length>0){var A=D[0];this.window.total=parseInt(A.getAttribute("total"));this.window.size=parseInt(A.getAttribute("size"));this.window.page=parseInt(A.getAttribute("page"))}else{this.window.total=0;this.window.size=0;this.window.page=0}},buildNavigation:function(){var D=this;var A=this.window.size>0?Math.ceil(this.window.total/this.window.size):0;if(A<2){this.navigation.style.display="none";return }this.navigation.style.display="block";var J=((this.window.page)*this.window.size+1);n2i.dom.setText(this.count,(J+"-"+Math.min((this.window.page+1)*this.window.size,this.window.total)+" / "+this.window.total));var H=this.windowPageBody;H.innerHTML="";if(A<2){this.windowPage.style.display="none"}else{var I=this.buildPages(A,this.window.page);for(var F=0;F<I.length;F++){var E=I[F];if(E===""){H.appendChild(n2i.build("span",{text:""}))}else{var C=document.createElement("a");C.appendChild(document.createTextNode(E+1));C.setAttribute("data-index",E);C.onmousedown=function(){D.windowPageWasClicked(this);return false};if(E==D.window.page){C.className="selected"}H.appendChild(C)}}this.windowPage.style.display="block"}},buildPages:function(F,E){var C=[];var A=false;for(var D=0;D<F;D++){if(D<1||D>F-2||Math.abs(E-D)<5){C.push(D);A=false}else{if(!A){C.push("")}A=true}}return C},setData:function(A){this.selected=[];var C=A.window||{};this.window.total=C.total||0;this.window.size=C.size||0;this.window.page=C.page||0;this.buildNavigation();this.buildHeaders(A.headers);this.buildRows(A.rows)},buildHeaders:function(C){n2i.dom.clear(this.head);this.columns=[];var A=n2i.build("tr",{parent:this.head});n2i.each(C,function(E,D){var F=n2i.build("th");if(E.width){F.style.width=E.width+"%"}if(E.sortable){n2i.listen(F,"click",function(){this.sort(D)}.bind(this));n2i.addClass(F,"sortable")}F.appendChild(n2i.build("span",{text:E.title}));A.appendChild(F);this.columns.push(E)}.bind(this))},buildRows:function(C){var A=this;n2i.dom.clear(this.body);this.rows=[];if(!C){return }n2i.each(C,function(F,D){var H=n2i.build("tr");var E=F.icon;var J=F.title;n2i.each(F.cells,function(L){var K=n2i.build("td");if(L.icon){K.appendChild(In2iGui.createIcon(L.icon,1));E=E||L.icon}if(L.text){K.appendChild(document.createTextNode(L.text));J=J||L.text}H.appendChild(K)});A.body.appendChild(H);var I={id:F.id,kind:F.kind,icon:E,title:J,index:D};H.dragDropInfo=I;A.rows.push({id:F.id,kind:F.kind,icon:E,title:J,index:D,data:F.data});this.addRowBehavior(H,D)}.bind(this))},setObjects:function(K){this.selected=[];this.body.update();this.rows=[];for(var F=0;F<K.length;F++){var L=n2i.build("tr");var E=K[F];var H=null;for(var D=0;D<this.columns.length;D++){var J=n2i.build("td");if(this.builder){J.appendChild(this.builder.buildColumn(this.columns[D],E))}else{var I=E[this.columns[D].key]||"";if(n2i.isArray(I)){for(var C=0;C<I.length;C++){if(I[C].constructor==Object){J.appendChild(this.createObject(I[C]))}else{J.appendChild(n2i.build("div",{text:I}))}}}else{if(I.constructor==Object){J.appendChild(this.createObject(I[D]))}else{n2i.dom.addText(J,I);H=H==null?I:H}}}L.appendChild(J)}var A={id:E.id,kind:E.kind,title:H};L.dragDropInfo=A;this.body.appendChild(L);this.addRowBehavior(L,F);this.rows.push(E)}},createObject:function(A){var C=n2i.build("div",{"class":"object"});if(A.icon){C.appendChild(In2iGui.createIcon(A.icon,1))}n2i.dom.addText(C,A.text||A.name||"");return C},addRowBehavior:function(D,C){var A=this;D.onmousedown=function(E){if(A.busy){return }A.rowDown(C);In2iGui.startDrag(E,D);return false};D.ondblclick=function(){if(A.busy){return }A.rowDoubleClick(C);return false}},changeSelection:function(A){var D=this.body.getElementsByTagName("tr");for(var C=0;C<this.selected.length;C++){n2i.removeClass(D[this.selected[C]],"selected")}for(var C=0;C<A.length;C++){n2i.addClass(D[A[C]],"selected")}this.selected=A;this.fire("selectionChanged",this.rows[A[0]])},rowDown:function(A){this.changeSelection([A])},rowDoubleClick:function(A){this.fire("listRowWasOpened",this.getFirstSelection())},windowPageWasClicked:function(A){var C=parseInt(A.getAttribute("data-index"));this.window.page=C;In2iGui.firePropertyChange(this,"window",this.window);In2iGui.firePropertyChange(this,"window.page",this.window.page)}};In2iGui.Tabs=function(E){E=E||{};this.name=E.name;this.element=n2i.get(E.element);this.activeTab=-1;var A=n2i.firstByClass(this.element,"in2igui_tabs_bar");this.bar=n2i.firstByTag(A,"ul");this.tabs=[];var C=this.bar.getElementsByTagName("li");for(var D=0;D<C.length;D++){this.tabs.push(C[D])}this.contents=n2i.byClass(this.element,"in2igui_tabs_tab");this.addBehavior();In2iGui.extend(this)};In2iGui.Tabs.create=function(C){C=C||{};var F=C.element=n2i.build("div",{"class":"in2igui_tabs"});var A="in2igui_tabs_bar";if(C.small){A+=" in2igui_tabs_bar_small"}if(C.centered){A+=" in2igui_tabs_bar_centered"}var E=n2i.build("div",{"class":A,parent:F});var D=n2i.build("ul",{parent:E});return new In2iGui.Tabs(C)};In2iGui.Tabs.prototype={addBehavior:function(){for(var A=0;A<this.tabs.length;A++){this.addTabBehavior(this.tabs[A],A)}},addTabBehavior:function(C,A){n2i.listen(C,"click",function(){this.tabWasClicked(A)}.bind(this))},registerTab:function(A){A.parent=this;this.tabs.push(A)},tabWasClicked:function(A){this.activeTab=A;this.updateGUI()},updateGUI:function(){for(var A=0;A<this.tabs.length;A++){n2i.setClass(this.tabs[A],"in2igui_tabs_selected",A==this.activeTab);this.contents[A].style.display=A==this.activeTab?"block":"none"}},createTab:function(A){A=A||{};var C=n2i.build("li",{html:"<a><span><span>"+n2i.escape(A.title)+"</span></span></a>",parent:this.bar});this.addTabBehavior(C,this.tabs.length);this.tabs.push(C);var D=A.element=n2i.build("div",{"class":"in2igui_tabs_tab"});if(A.padding>0){D.style.padding=A.padding+"px"}this.contents.push(D);this.element.appendChild(D);if(this.activeTab==-1){this.activeTab=0;n2i.addClass(C,"in2igui_tabs_selected")}else{D.style.display="none"}return new In2iGui.Tab(A)}};In2iGui.Tab=function(A){this.name=A.name;this.element=n2i.get(A.element)};In2iGui.Tab.prototype={add:function(A){this.element.appendChild(A.element)}};In2iGui.ObjectList=function(A){this.options=n2i.override({key:null},A);this.name=A.name;this.element=n2i.get(A.element);this.body=n2i.firstByTag(this.element,"tbody");this.template=[];this.objects=[];In2iGui.extend(this)};In2iGui.ObjectList.create=function(F){F=F||{};var E=F.element=n2i.build("table",{"class":"in2igui_objectlist",cellpadding:"0",cellspacing:"0"});if(F.template){var C="<thead><tr>";for(var A=0;A<F.template.length;A++){C+="<th>"+(F.template[A].label||"")+"</th>"}C+="</tr></thead>";E.innerHTML=C}n2i.build("tbody",{parent:E});var D=new In2iGui.ObjectList(F);if(F.template){n2i.each(F.template,function(H){D.registerTemplateItem(new In2iGui.ObjectList.Text(H.key))})}return D};In2iGui.ObjectList.prototype={ignite:function(){this.addObject({})},addObject:function(C,E){if(this.objects.length==0||E){var D=new In2iGui.ObjectList.Object(this.objects.length,C,this);this.objects.push(D);this.body.appendChild(D.getElement())}else{var A=this.objects[this.objects.length-1];var D=new In2iGui.ObjectList.Object(A.index,C,this);A.index++;this.objects.push(D);this.objects.push(A);this.body.insertBefore(D.getElement(),A.getElement())}},reset:function(){for(var C=0;C<this.objects.length;C++){var A=this.objects[C].getElement();if(!A.parentNode){n2i.log("no parent for...");n2i.log(A)}else{A.parentNode.removeChild(A)}}this.objects=[];this.addObject({})},addObjects:function(C){for(var A=0;A<C.length;A++){this.addObject(C[A])}},setObjects:function(A){this.reset();this.addObjects(A)},getObjects:function(D){var C=[];for(var A=0;A<this.objects.length-1;A++){C.push(this.objects[A].getData())}return C},getValue:function(){return this.getObjects()},setValue:function(A){this.setObjects(A)},registerTemplateItem:function(A){this.template.push(A)},objectDidChange:function(A){if(A.index>=this.objects.length-1){this.addObject({},true)}},getLabel:function(){return this.options.label}};In2iGui.ObjectList.Object=function(A,D,C){this.data=D;this.index=A;this.list=C;this.fields=[]};In2iGui.ObjectList.Object.prototype={getElement:function(){if(!this.element){var C=this;this.element=document.createElement("tr");for(var D=0;D<this.list.template.length;D++){var E=this.list.template[D];var F=E.clone();F.object=this;this.fields.push(F);var A=document.createElement("td");if(D==0){A.className="first"}A.appendChild(F.getElement());F.setValue(this.data[E.key]);this.element.appendChild(A)}}return this.element},valueDidChange:function(){this.list.objectDidChange(this)},getData:function(){var C=this.data;for(var A=0;A<this.fields.length;A++){C[this.fields[A].key]=this.fields[A].getValue()}return C}};In2iGui.ObjectList.Text=function(A){this.key=A;this.value=null};In2iGui.ObjectList.Text.prototype={clone:function(){return new In2iGui.ObjectList.Text(this.key)},getElement:function(){var A=n2i.build("input",{"class":"in2igui_formula_text"});var C=In2iGui.wrapInField(A);this.wrapper=new In2iGui.TextField({element:A});this.wrapper.listen(this);return C},$valueChanged:function(A){this.value=A;this.object.valueDidChange()},getValue:function(){return this.value},setValue:function(A){this.value=A;this.wrapper.setValue(A)}};In2iGui.ObjectList.Select=function(A){this.key=A;this.value=null;this.options=[]};In2iGui.ObjectList.Select.prototype={clone:function(){var A=new In2iGui.ObjectList.Select(this.key);A.options=this.options;return A},getElement:function(){this.select=n2i.build("select");for(var C=0;C<this.options.length;C++){this.select.options[this.select.options.length]=new Option(this.options[C].label,this.options[C].value)}var A=this;this.select.onchange=function(){A.object.valueDidChange()};return this.select},getValue:function(){return this.select.value},setValue:function(A){this.select.value=A},addOption:function(C,A){this.options.push({value:C,label:A})}};In2iGui.Alert=function(A){this.options=n2i.override({modal:false},A);this.element=n2i.get(A.element);this.name=A.name;this.body=n2i.firstByClass(this.element,"in2igui_alert_body");this.content=n2i.firstByClass(this.element,"in2igui_alert_content");this.emotion=this.options.emotion;this.title=n2i.firstByTag(this.element,"h1");In2iGui.extend(this)};In2iGui.Alert.create=function(C){C=n2i.override({title:"",text:"",emotion:null,title:null},C);var D=C.element=n2i.build("div",{"class":"in2igui_alert"});var A=n2i.build("div",{"class":"in2igui_alert_body",parent:D});var E=n2i.build("div",{"class":"in2igui_alert_content",parent:A});document.body.appendChild(D);var F=new In2iGui.Alert(C);if(C.emotion){F.setEmotion(C.emotion)}if(C.title){F.setTitle(C.title)}if(C.text){F.setText(C.text)}return F};In2iGui.Alert.prototype={show:function(){var A=In2iGui.nextAlertIndex();if(this.options.modal){In2iGui.showCurtain({widget:this,zIndex:A});A++}this.element.style.zIndex=A;this.element.style.display="block";this.element.style.top=(n2i.getScrollTop()+100)+"px";n2i.animate(this.element,"opacity",1,200);n2i.animate(this.element,"margin-top","40px",600,{ease:n2i.ease.elastic})},hide:function(){n2i.animate(this.element,"opacity",0,200,{hideOnComplete:true});n2i.animate(this.element,"margin-top","0px",200);In2iGui.hideCurtain(this)},setTitle:function(A){if(!this.title){this.title=n2i.build("h1",{parent:this.content})}n2i.dom.setText(this.title,A)},setText:function(A){if(!this.text){this.text=n2i.build("p",{parent:this.content})}n2i.dom.setText(this.text,A||"")},setEmotion:function(A){if(this.emotion){n2i.removeClass(this.body,this.emotion)}this.emotion=A;n2i.addClass(this.body,A)},update:function(A){A=A||{};this.setTitle(A.title||null);this.setText(A.text||null);this.setEmotion(A.emotion||null)},addButton:function(A){if(!this.buttons){this.buttons=In2iGui.Buttons.create({align:"right"});this.body.appendChild(this.buttons.element)}this.buttons.add(A)}};In2iGui.Button=function(A){this.options=A;this.name=A.name;this.element=n2i.get(A.element);this.enabled=!n2i.hasClass(this.element,"in2igui_button_disabled");In2iGui.extend(this);this.addBehavior()};In2iGui.Button.create=function(H){var H=n2i.override({text:"",highlighted:false,enabled:true},H);var E="in2igui_button"+(H.highlighted?" in2igui_button_highlighted":"");if(H.small&&H.rounded){E+=" in2igui_button_small_rounded"}if(!H.enabled){E+=" in2igui_button_disabled"}var A=H.element=n2i.build("a",{"class":E,href:"#"});var F=document.createElement("span");A.appendChild(F);var D=document.createElement("span");F.appendChild(D);if(H.icon){var C=n2i.build("em",{"class":"in2igui_button_icon",style:"background-image:url("+In2iGui.getIconUrl(H.icon,1)+")"});if(!H.text||H.text.length==0){n2i.addClass(C,"in2igui_button_icon_notext")}D.appendChild(C)}if(H.text&&H.text.length>0){n2i.dom.addText(D,H.text)}if(H.title&&H.title.length>0){n2i.dom.addText(D,H.title)}return new In2iGui.Button(H)};In2iGui.Button.prototype={addBehavior:function(){var A=this;n2i.listen(this.element,"click",function(C){n2i.stop(C);A.clicked()})},clicked:function(){if(this.enabled){if(this.options.confirm){In2iGui.confirmOverlay({widget:this,text:this.options.confirm.text,okText:this.options.confirm.okText,cancelText:this.options.confirm.cancelText,onOk:this.fireClick.bind(this)})}else{this.fireClick()}}else{this.element.blur()}},fireClick:function(){this.fire("click");if(this.options.submit){var A=In2iGui.get().getAncestor(this,"in2igui_formula");if(A){A.submit()}}},click:function(A){if(A){this.listen({$click:A});return this}else{this.clicked()}},onClick:function(A){this.listen({$click:A})},setEnabled:function(A){this.enabled=A;this.updateUI()},enable:function(){this.setEnabled(true)},disable:function(){this.setEnabled(false)},setHighlighted:function(A){n2i.setClass(this.element,"in2igui_button_highlighted",A)},updateUI:function(){n2i.setClass(this.element,"in2igui_button_disabled",!this.enabled)},setText:function(A){n2i.dom.setText(this.element.getElementsByTagName("span")[1],A)}};In2iGui.Buttons=function(A){this.name=A.name;this.element=n2i.get(A.element);this.body=n2i.firstByClass(this.element,"in2igui_buttons_body");In2iGui.extend(this)};In2iGui.Buttons.create=function(C){C=n2i.override({top:0},C);var A=C.element=n2i.build("div",{"class":"in2igui_buttons"});if(C.align=="right"){n2i.addClass(A,"in2igui_buttons_right")}if(C.align=="center"){n2i.addClass(A,"in2igui_buttons_center")}if(C.top>0){A.style.paddingTop=C.top+"px"}n2i.build("div",{"class":"in2igui_buttons_body",parent:A});return new In2iGui.Buttons(C)};In2iGui.Buttons.prototype={add:function(A){this.body.appendChild(A.element);return this}};In2iGui.Selection=function(A){this.options=n2i.override({value:null},A);this.element=n2i.get(A.element);this.name=A.name;this.items=[];this.subItems=[];this.selection=null;if(this.options.value!=null){this.selection={value:this.options.value}}In2iGui.extend(this)};In2iGui.Selection.create=function(A){A=n2i.override({width:0},A);var C=A.element=n2i.build("div",{"class":"in2igui_selection"});if(A.width>0){C.style.width=A.width+"px"}return new In2iGui.Selection(A)};In2iGui.Selection.prototype={getValue:function(){return this.selection},valueForProperty:function(A){if(A==="value"){return this.selection?this.selection.value:null}else{if(A==="kind"){return this.selection?this.selection.kind:null}}return undefined},setValue:function(C){var A=this.getSelectionWithValue(C);if(A===null){this.selection=null}else{this.selection=A;this.kind=A.kind}this.updateUI();this.fireChange()},getSelectionWithValue:function(E){for(var D=0;D<this.items.length;D++){if(this.items[D].value==E){return this.items[D]}}for(var D=0;D<this.subItems.length;D++){var A=this.subItems[D].items;for(var C=0;C<A.length;C++){if(A[C].value==E){return A[C]}}}return null},reset:function(){this.setValue(null)},updateUI:function(){for(var A=0;A<this.items.length;A++){n2i.setClass(this.items[A].element,"in2igui_selected",this.isSelection(this.items[A]))}for(var A=0;A<this.subItems.length;A++){this.subItems[A].updateUI()}},changeSelection:function(C){for(var A=0;A<this.subItems.length;A++){this.subItems[A].selectionChanged(this.selection,C)}this.selection=C;this.updateUI();this.fireChange()},fireChange:function(){this.fire("selectionChanged",this.selection);this.fireProperty("value",this.selection?this.selection.value:null);this.fireProperty("kind",this.selection?this.selection.kind:null);for(var A=0;A<this.subItems.length;A++){this.subItems[A].parentValueChanged()}},registerItems:function(A){A.parent=this;this.subItems.push(A)},registerItem:function(J,I,E,A,H,D){var C=n2i.get(J);var F={id:J,title:I,icon:E,badge:A,element:C,value:H,kind:D};this.items.push(F);this.addItemBehavior(C,F);this.selection=this.getSelectionWithValue(this.options.value)},addItemBehavior:function(C,A){n2i.listen(C,"click",function(){this.itemWasClicked(A)}.bind(this));n2i.listen(C,"dblclick",function(){this.itemWasDoubleClicked(A)}.bind(this));C.dragDropInfo=A},setObjects:function(A){this.items=[];n2i.each(A,function(E){this.items.push(E);var D=n2i.build("div",{"class":"in2igui_selection_item"});E.element=D;this.element.appendChild(D);var C=n2i.build("span",{"class":"in2igui_selection_label",text:E.title});if(E.icon){D.appendChild(In2iGui.createIcon(E.icon,1))}D.appendChild(C);n2i.listen(D,"click",function(){this.itemWasClicked(E)}.bind(this));n2i.listen(D,"dblclick",function(F){n2i.stop(F);this.itemWasDoubleClicked(E)}.bind(this))}.bind(this))},isSelection:function(C){if(this.selection===null){return false}var A=C.value==this.selection.value;if(this.selection.kind){A=A&&C.kind==this.selection.kind}return A},itemWasClicked:function(A){this.changeSelection(A)},itemWasDoubleClicked:function(A){this.fire("selectionWasOpened",A)}};In2iGui.Selection.Items=function(A){this.options=n2i.override({source:null},A);this.element=n2i.get(A.element);this.title=n2i.get(this.element.id+"_title");this.name=A.name;this.parent=null;this.items=[];In2iGui.extend(this);if(this.options.source){this.options.source.listen(this)}};In2iGui.Selection.Items.prototype={refresh:function(){if(this.options.source){this.options.source.refresh()}},$objectsLoaded:function(A){this.$itemsLoaded(A)},$itemsLoaded:function(A){this.items=[];this.element.innerHTML="";this.buildLevel(this.element,A,0);if(this.title){this.title.style.display=this.items.length>0?"block":"none"}this.parent.updateUI()},buildLevel:function(E,C,F){if(!C){return }var A=this.isHierarchy(C);var D=F==0;var H=n2i.build("div",{"class":"in2igui_selection_level",style:(D?"display:block":"display:none"),parent:E});n2i.each(C,function(O){if(O.type=="title"){var I=n2i.build("div",{"class":"in2igui_selection_title",html:"<span>"+O.title+"</span>",parent:H});return }var M=O.children&&O.children.length>0;var K=F*16+6;if(!A&&F>0||A&&!M){K+=13}var L=n2i.build("div",{"class":"in2igui_selection_item"});L.style.paddingLeft=K+"px";if(O.badge){L.appendChild(n2i.build("strong",{"class":"in2igui_selection_badge",text:O.badge}))}if(A&&M){var P=this;var N=n2i.build("span",{"class":"in2igui_disclosure",parent:L});n2i.listen(N,"click",function(S){n2i.stop(S);P.toggle(N)})}var Q=n2i.build("span",{"class":"in2igui_selection_label",text:O.title});if(O.icon){L.appendChild(n2i.build("span",{"class":"in2igui_icon_1",style:"background-image: url("+In2iGui.getIconUrl(O.icon,1)+")"}))}L.appendChild(Q);n2i.listen(L,"click",function(S){this.parent.itemWasClicked(O)}.bind(this));n2i.listen(L,"dblclick",function(S){this.parent.itemWasDoubleClicked(O)}.bind(this));H.appendChild(L);var J={title:O.title,icon:O.icon,badge:O.badge,kind:O.kind,element:L,value:O.value};L.dragDropInfo=J;this.items.push(J);this.buildLevel(H,O.children,F+1)}.bind(this))},toggle:function(A){if(n2i.hasClass(A,"in2igui_disclosure_open")){n2i.getNext(A.parentNode).style.display="none";n2i.removeClass(A,"in2igui_disclosure_open")}else{n2i.getNext(A.parentNode).style.display="block";n2i.addClass(A,"in2igui_disclosure_open")}},isHierarchy:function(A){if(!A){return false}for(var C=0;C<A.length;C++){if(A[C]!==null&&A[C].children&&A[C].children.length>0){return true}}return false},getValue:function(){if(this.parent.selection==null){return null}for(var A=0;A<this.items.length;A++){if(this.items[A].value==this.parent.selection.value){return this.items[A]}}return null},updateUI:function(){for(var A=0;A<this.items.length;A++){n2i.setClass(this.items[A].element,"in2igui_selected",this.parent.isSelection(this.items[A]))}},selectionChanged:function(C,A){for(var D=0;D<this.items.length;D++){var E=this.items[D].value;if(E==A.value){this.fireProperty("value",A.value);return }}this.fireProperty("value",null)},parentValueChanged:function(){for(var A=0;A<this.items.length;A++){if(this.parent.isSelection(this.items[A])){this.fireProperty("value",this.items[A].value);return }}this.fireProperty("value",null)}};In2iGui.Toolbar=function(A){this.element=n2i.get(A.element);this.name=A.name;In2iGui.extend(this)};In2iGui.Toolbar.create=function(A){A=A||{};A.element=n2i.build("div",{"class":A.labels?"in2igui_toolbar in2igui_toolbar_nolabels":"in2igui_toolbar"});return new In2iGui.Toolbar(A)};In2iGui.Toolbar.prototype={add:function(A){this.element.appendChild(A.getElement())},addDivider:function(){this.element.appendChild(n2i.build("span",{"class":"in2igui_divider"}))}};In2iGui.RevealingToolbar=function(A){this.element=n2i.get(A.element);this.name=A.name;In2iGui.extend(this)};In2iGui.RevealingToolbar.create=function(A){A=A||{};A.element=n2i.build("div",{className:"in2igui_revealing_toolbar",style:"display:none",parent:document.body});var C=new In2iGui.RevealingToolbar(A);C.setToolbar(In2iGui.Toolbar.create());return C};In2iGui.RevealingToolbar.prototype={setToolbar:function(A){this.toolbar=A;this.element.appendChild(A.getElement())},getToolbar:function(){return this.toolbar},show:function(A){this.element.style.display="";n2i.ani(this.element,"height","58px",A?0:600,{ease:n2i.ease.slowFastSlow})},hide:function(){n2i.ani(this.element,"height","0px",500,{ease:n2i.ease.slowFastSlow,hideOnComplete:true})}};In2iGui.Toolbar.Icon=function(A){this.options=A;this.element=n2i.get(A.element);this.name=A.name;this.enabled=!n2i.hasClass(this.element,"in2igui_toolbar_icon_disabled");this.element.tabIndex=this.enabled?0:-1;this.icon=n2i.firstByClass(this.element,"in2igui_icon");In2iGui.extend(this);this.addBehavior()};In2iGui.Toolbar.Icon.create=function(C){var D=C.element=n2i.build("a",{"class":"in2igui_toolbar_icon"});var F=n2i.build("span",{"class":"in2igui_icon",style:"background-image: url("+In2iGui.getIconUrl(C.icon,2)+")"});var A=n2i.build("span",{"class":"in2igui_toolbar_inner_icon",parent:D});var E=n2i.build("span",{"class":"in2igui_toolbar_inner_icon",parent:A});var H=n2i.build("strong",{text:C.title});if(C.overlay){n2i.build("span",{"class":"in2igui_icon_overlay",parent:F,style:"background-image: url("+In2iGui.getIconUrl("overlay/"+C.overlay,2)+")"})}E.appendChild(F);E.appendChild(H);return new In2iGui.Toolbar.Icon(C)};In2iGui.Toolbar.Icon.prototype={addBehavior:function(){var A=this;this.element.onclick=function(){A.wasClicked()}},setEnabled:function(A){this.enabled=A;this.element.tabIndex=A?0:-1;n2i.setClass(this.element,"in2igui_toolbar_icon_disabled",!this.enabled)},disable:function(){this.setEnabled(false)},enable:function(){this.setEnabled(true)},setSelected:function(A){n2i.setClass(this.element,"in2igui_toolbar_icon_selected",A)},wasClicked:function(){if(this.enabled){if(this.options.confirm){In2iGui.confirmOverlay({widget:this,text:this.options.confirm.text,okText:this.options.confirm.okText,cancelText:this.options.confirm.cancelText,onOk:this.fireClick.bind(this)})}else{this.fireClick()}}},fireClick:function(){In2iGui.callDelegates(this,"toolbarIconWasClicked");In2iGui.callDelegates(this,"click")}};In2iGui.Toolbar.SearchField=function(A){this.options=A;this.element=n2i.get(A.element);this.name=A.name;this.field=n2i.firstByTag(this.element,"input");this.value=this.field.value;In2iGui.extend(this);this.addBehavior()};In2iGui.Toolbar.SearchField.create=function(A){A=A||{};A.element=n2i.build("div",{"class":A.adaptive?"in2igui_toolbar_search in2igui_toolbar_search_adaptive":"in2igui_toolbar_search",html:'<div class="in2igui_searchfield"><strong class="in2igui_searchfield_button"></strong><div><div><input type="text"/></div></div></div><span>'+n2i.escape(A.title)+"</span>"});return new In2iGui.Toolbar.SearchField(A)};In2iGui.Toolbar.SearchField.prototype={getValue:function(){return this.field.value},addBehavior:function(){var A=this;this.field.onkeyup=function(){A.fieldChanged()};if(!this.options.adaptive){this.field.onfocus=function(){n2i.ani(this,"width","120px",500,{ease:n2i.ease.slowFastSlow})};this.field.onblur=function(){n2i.ani(this,"width","80px",500,{ease:n2i.ease.slowFastSlow})}}},fieldChanged:function(){if(this.field.value!=this.value){this.value=this.field.value;In2iGui.callDelegates(this,"valueChanged");In2iGui.firePropertyChange(this,"value",this.value)}}};In2iGui.Toolbar.Badge=function(A){this.element=ni2.get(A.element);this.name=A.name;this.label=n2i.firstByTag(this.element,"strong");this.text=n2i.firstByTag(this.element,"span");In2iGui.extend(this)};In2iGui.Toolbar.Badge.prototype={setLabel:function(A){n2i.dom.setText(this.label,A)},setText:function(A){n2i.dom.setText(this.text,A)}};In2iGui.ImagePicker=function(A){this.name=A.name;this.options=A||{};this.element=n2i.get(A.element);this.images=[];this.object=null;this.thumbnailsLoaded=false;In2iGui.extend(this);this.addBehavior()};In2iGui.ImagePicker.prototype={addBehavior:function(){this.element.onclick=this.showPicker.bind(this)},setObject:function(A){this.object=A;this.updateUI()},getObject:function(){return this.object},reset:function(){this.object=null;this.updateUI()},updateUI:function(){if(this.object==null){this.element.style.backgroundImage=""}else{var A=In2iGui.resolveImageUrl(this,this.object,48,48);this.element.style.backgroundImage="url("+A+")"}},showPicker:function(){if(!this.picker){var C=this;this.picker=In2iGui.BoundPanel.create();this.content=n2i.build("div",{"class":"in2igui_imagepicker_thumbs"});var D=In2iGui.Buttons.create({align:"right"});var E=In2iGui.Button.create({text:"Luk",highlighted:true});E.listen({$click:function(){C.hidePicker()}});var A=In2iGui.Button.create({text:"Fjern"});A.listen({$click:function(){C.setObject(null);C.hidePicker()}});D.add(A).add(E);this.picker.add(this.content);this.picker.add(D)}this.picker.position(this.element);this.picker.show();if(!this.thumbnailsLoaded){this.updateImages();this.thumbnailsLoaded=true}},hidePicker:function(){this.picker.hide()},updateImages:function(){var A=this;n2i.request({onSuccess:function(C){A.parse(C.responseXML)},url:this.options.source})},parse:function(I){this.content.innerHTML="";var A=I.getElementsByTagName("image");var E=this;for(var H=0;H<A.length;H++){var J=A[H].getAttribute("id");var D={id:A[H].getAttribute("id")};var F=In2iGui.resolveImageUrl(this,D,48,48);var C=n2i.build("div",{"class":"in2igui_imagepicker_thumbnail",style:"background-image:url("+F+")"});C.in2iguiObject={"id":J};C.onclick=function(){E.setObject(this.in2iguiObject);E.hidePicker()};this.content.appendChild(C)}}};In2iGui.BoundPanel=function(A){this.element=n2i.get(A.element);this.name=A.name;this.visible=false;this.content=n2i.firstByClass(this.element,"in2igui_boundpanel_content");this.arrow=n2i.firstByClass(this.element,"in2igui_boundpanel_arrow");In2iGui.extend(this)};In2iGui.BoundPanel.create=function(A){var A=n2i.override({name:null,top:0,left:0,width:null,padding:null},A);var C='<div class="in2igui_boundpanel_arrow"></div><div class="in2igui_boundpanel_top"><div><div></div></div></div><div class="in2igui_boundpanel_body"><div class="in2igui_boundpanel_body"><div class="in2igui_boundpanel_body"><div class="in2igui_boundpanel_content" style="';if(A.width){C+="width:"+A.width+"px;"}if(A.padding){C+="padding:"+A.padding+"px;"}C+='"></div></div></div></div><div class="in2igui_boundpanel_bottom"><div><div></div></div></div>';A.element=n2i.build("div",{"class":"in2igui_boundpanel",style:"display:none;zIndex:"+In2iGui.nextPanelIndex()+";top:"+A.top+"px;left:"+A.left+"px",html:C,parent:document.body});return new In2iGui.BoundPanel(A)};In2iGui.BoundPanel.prototype={show:function(){if(!this.visible){if(!n2i.browser.msie){n2i.setOpacity(this.element,0)}if(this.relativePosition=="left"){this.element.style.marginLeft="30px"}else{this.element.style.marginLeft="-30px"}n2i.setStyle(this.element,{visibility:"hidden",display:"block"});var A=this.element.clientWidth;n2i.setStyle(this.element,{width:A+"px",visibility:"visible"});this.element.style.marginTop="0px";this.element.style.display="block";if(!n2i.browser.msie){n2i.animate(this.element,"opacity",1,400,{ease:n2i.ease.fastSlow})}n2i.animate(this.element,"margin-left","0px",800,{ease:n2i.ease.bounce})}this.element.style.zIndex=In2iGui.nextPanelIndex();this.visible=true},hide:function(){if(n2i.browser.msie){this.element.style.display="none"}else{n2i.animate(this.element,"opacity",0,300,{ease:n2i.ease.slowFast,hideOnComplete:true})}this.visible=false},add:function(A){if(A.getElement){this.content.appendChild(A.getElement())}else{this.content.appendChild(A)}},addSpace:function(A){this.add(n2i.build("div",{style:"font-size:0px;height:"+A+"px"}))},getDimensions:function(){if(this.element.style.display=="none"){this.element.style.visibility="hidden";this.element.style.display="block";var C=this.element.clientWidth;var A=this.element.clientHeight;this.element.style.display="none";this.element.style.visibility=""}else{var C=this.element.clientWidth;var A=this.element.clientHeight}return{width:C,height:A}},position:function(D){D=n2i.get(D);var H={left:n2i.getLeft(D),top:n2i.getTop(D)};var I={left:n2i.getScrollLeft(),top:n2i.getScrollTop()};var L=this.getDimensions();var E=n2i.getViewPortWidth();var N=H.left-I.left+n2i.getScrollLeft();var M=D.clientWidth;var A=D.clientHeight;var F=H.top-I.top+n2i.getScrollTop();if((N+M/2)/E<0.5){this.relativePosition="left";var C=N+M+10;this.arrow.className="in2igui_boundpanel_arrow in2igui_boundpanel_arrow_left";var J=-14}else{this.relativePosition="right";var C=N-L.width-10;this.arrow.className="in2igui_boundpanel_arrow in2igui_boundpanel_arrow_right";var J=L.width-4}var K=Math.max(0,F+(A-L.height)/2);this.arrow.style.marginTop=(L.height-32)/2+Math.min(0,F+(A-L.height)/2)+"px";this.arrow.style.marginLeft=J+"px";if(this.visible){n2i.animate(this.element,"top",K+"px",500,{ease:n2i.ease.fastSlow});n2i.animate(this.element,"left",C+"px",500,{ease:n2i.ease.fastSlow})}else{this.element.style.top=K+"px";this.element.style.left=C+"px"}}};In2iGui.RichText=function(A){this.name=A.name;var C=this.element=n2i.get(A.element);this.options=n2i.override({debug:false,value:"",autoHideToolbar:true,style:"font-family: sans-serif;"},A);this.textarea=n2i.build("textarea");C.appendChild(this.textarea);this.editor=WysiHat.Editor.attach(this.textarea);this.editor.setAttribute("frameborder","0");this.toolbar=n2i.firstByClass(C,"in2igui_richtext_toolbar");this.toolbarContent=n2i.firstByClass(C,"in2igui_richtext_toolbar_content");this.value=this.options.value;this.document=null;this.ignited=false;this.buildToolbar();this.ignite();In2iGui.extend(this)};In2iGui.RichText.actions=[{key:"bold",cmd:"bold",value:null,icon:"edit/text_bold"},{key:"italic",cmd:"italic",value:null,icon:"edit/text_italic"},{key:"underline",cmd:"underline",value:null,icon:"edit/text_underline"},null,{key:"justifyleft",cmd:"justifyleft",value:null,icon:"edit/text_align_left"},{key:"justifycenter",cmd:"justifycenter",value:null,icon:"edit/text_align_center"},{key:"justifyright",cmd:"justifyright",value:null,icon:"edit/text_align_right"},null,{key:"increasefontsize",cmd:"increasefontsize",value:null,icon:"edit/increase_font_size"},{key:"decreasefontsize",cmd:"decreasefontsize",value:null,icon:"edit/decrease_font_size"},{key:"color",cmd:null,value:null,icon:"common/color"}];In2iGui.RichText.replaceInput=function(C){C=C||{};var A=$(C.input);A.style.display="none";C.value=A.value;var D=In2iGui.RichText.create(C);A.parentNode.insertBefore(D.element,A);D.ignite()};In2iGui.RichText.create=function(A){A=A||{};A.element=n2i.build("div",{"class":"in2igui_richtext",html:'<div class="in2igui_richtext_toolbar"><div class="in2igui_richtext_inner_toolbar"><div class="in2igui_richtext_toolbar_content"></div></div></div>'});return new In2iGui.RichText(A)};In2iGui.RichText.prototype={isCompatible:function(){var A=navigator.userAgent.toLowerCase();return true;return(A.indexOf("msie 6")>-1||A.indexOf("msie 7")>-1||(A.indexOf("gecko")>-1&&A.indexOf("safari")<0))},ignite:function(){var A=this;this.editor.observe("wysihat:loaded",function(C){if(this.ignited){return }this.editor.setStyle(this.options.style);this.editor.setRawContent(this.value);this.document=this.editor.getDocument();if(this.document.body){this.document.body.style.minHeight="100%";this.document.body.style.margin="0";this.document.documentElement.style.cursor="text";this.document.documentElement.style.minHeight="100%";Element.setStyle(this.document.body,this.options.style)}this.window=this.editor.getWindow();Event.observe(this.window,"focus",function(){A.documentFocused()});Event.observe(this.window,"blur",function(){A.documentBlurred()});this.document.body.focus();this.ignited=true}.bind(this));this.editor.observe("wysihat:change",function(C){this.documentChanged()}.bind(this))},setHeight:function(A){this.editor.style.height=A+"px"},focus:function(){try{var A=this.document.createRange();A.selectNodeContents(this.document.body);this.window.getSelection().addRange(A)}catch(C){}if(this.window){this.window.focus()}},setValue:function(A){this.value=A;this.editor.setRawContent(this.value)},getValue:function(){return this.value},deactivate:function(){if(this.colorPicker){this.colorPicker.hide()}if(this.toolbar){this.toolbar.style.display="none"}},buildToolbar:function(){this.toolbar.onmousedown=function(){this.toolbarMouseDown=true}.bind(this);this.toolbar.onmouseup=function(){this.toolbarMouseDown=false}.bind(this);var C=this;var E=In2iGui.RichText.actions;for(var D=0;D<E.length;D++){if(E[D]==null){this.toolbarContent.appendChild(n2i.build("div",{"class":"in2igui_richtext_divider"}))}else{var F=n2i.build("div",{"class":"action action_"+E[D].key});F.title=E[D].key;F.in2iguiRichTextAction=E[D];F.onclick=F.ondblclick=function(H){return C.actionWasClicked(this.in2iguiRichTextAction,H)};var A=n2i.build("img");A.src=In2iGui.context+"/In2iGui/gfx/trans.png";if(E[D].icon){F.style.backgroundImage="url("+In2iGui.getIconUrl(E[D].icon,1)+")"}F.appendChild(A);this.toolbarContent.appendChild(F);F.onmousedown=In2iGui.RichText.stopEvent}}},documentFocused:function(){if(n2i.browser.msie){this.toolbar.style.display="block";return }if(this.toolbar.style.display!="block"){this.toolbar.style.marginTop="-40px";n2i.setOpacity(this.toolbar,0);this.toolbar.style.display="block";n2i.ani(this.toolbar,"opacity",1,300);n2i.ani(this.toolbar,"margin-top","-32px",300)}},documentBlurred:function(){if(this.toolbarMouseDown){return }if(this.options.autoHideToolbar){if(n2i.browser.msie){var A=this;window.setTimeout(function(){A.toolbar.style.display="none"},100);return }n2i.ani(this.toolbar,"opacity",0,300,{hideOnComplete:true});n2i.ani(this.toolbar,"margin-top","-40px",300)}this.documentChanged();In2iGui.callDelegates(this,"richTextDidChange")},documentChanged:function(){this.value=this.editor.content();if(this.options.input){$(this.options.input).value=this.value}},disabler:function(C){var A=C?C:window.event;if(A.returnValue){A.returnValue=false}else{if(A.preventDefault){A.preventDefault()}}return false},actionWasClicked:function(A,C){In2iGui.RichText.stopEvent(C);if(A.key=="color"){this.showColorPicker()}else{this.execCommand(A)}this.document.body.focus();return false},execCommand:function(A){this.editor.execCommand(A.cmd,false,A.value);this.documentChanged()},showColorPicker:function(){if(!this.colorPicker){var A=In2iGui.Window.create({variant:"dark"});var C=In2iGui.ColorPicker.create();C.listen(this);A.add(C);A.show();this.colorPicker=A}this.colorPicker.show()},$colorWasHovered:function(A){},$colorWasSelected:function(A){this.document.execCommand("forecolor",false,A);this.documentChanged()}};In2iGui.RichText.stopEvent=function(C){var A=C?C:window.event;if(A.returnValue){A.returnValue=false}else{if(A.preventDefault){A.preventDefault()}else{return false}}};In2iGui.ImageViewer=function(A){this.options=n2i.override({maxWidth:800,maxHeight:600,perimeter:100,sizeSnap:100,margin:0,ease:n2i.ease.slowFastSlow,easeEnd:n2i.ease.bounce,easeAuto:n2i.ease.slowFastSlow,easeReturn:n2i.ease.cubicInOut,transition:400,transitionEnd:1000,transitionReturn:300},A);this.element=n2i.get(A.element);this.box=this.options.box;this.viewer=n2i.firstByClass(this.element,"in2igui_imageviewer_viewer");this.innerViewer=n2i.firstByClass(this.element,"in2igui_imageviewer_inner_viewer");this.status=n2i.firstByClass(this.element,"in2igui_imageviewer_status");this.previousControl=n2i.firstByClass(this.element,"in2igui_imageviewer_previous");this.controller=n2i.firstByClass(this.element,"in2igui_imageviewer_controller");this.nextControl=n2i.firstByClass(this.element,"in2igui_imageviewer_next");this.playControl=n2i.firstByClass(this.element,"in2igui_imageviewer_play");this.closeControl=n2i.firstByClass(this.element,"in2igui_imageviewer_close");this.text=n2i.firstByClass(this.element,"in2igui_imageviewer_text");this.dirty=false;this.width=600;this.height=460;this.index=0;this.playing=false;this.name=A.name;this.images=[];this.box.listen(this);this.addBehavior();In2iGui.extend(this)};In2iGui.ImageViewer.create=function(A){A=A||{};var C=A.element=n2i.build("div",{"class":"in2igui_imageviewer",html:'<div class="in2igui_imageviewer_viewer"><div class="in2igui_imageviewer_inner_viewer"></div></div><div class="in2igui_imageviewer_text"></div><div class="in2igui_imageviewer_status"></div><div class="in2igui_imageviewer_controller"><div><div><a class="in2igui_imageviewer_previous"></a><a class="in2igui_imageviewer_play"></a><a class="in2igui_imageviewer_next"></a><a class="in2igui_imageviewer_close"></a></div></div></div>'});var D=In2iGui.Box.create({absolute:true,modal:true,closable:true});D.add(C);D.addToDocument();A.box=D;return new In2iGui.ImageViewer(A)};In2iGui.ImageViewer.prototype={addBehavior:function(){var A=this;this.nextControl.onclick=function(){A.next(true)};this.previousControl.onclick=function(){A.previous(true)};this.playControl.onclick=function(){A.playOrPause()};this.closeControl.onclick=this.hide.bind(this);n2i.listen(this.viewer,"click",this.zoom.bind(this));this.timer=function(){A.next(false)};this.keyListener=function(C){C=n2i.event(C);if(C.rightKey){A.next(true)}else{if(C.leftKey){A.previous(true)}else{if(C.escapeKey){A.hide()}else{if(C.returnKey){A.playOrPause()}}}}},n2i.listen(this.viewer,"mousemove",this.mouseMoveEvent.bind(this));n2i.listen(this.controller,"mouseenter",function(){A.overController=true});n2i.listen(this.controller,"mouseleave",function(){A.overController=false});n2i.listen(this.viewer,"mouseout",function(C){if(!In2iGui.isWithin(C,this.viewer)){A.hideController()}}.bind(this))},mouseMoveEvent:function(){window.clearTimeout(this.ctrlHider);if(this.shouldShowController()){this.ctrlHider=window.setTimeout(this.hideController.bind(this),2000);if(n2i.browser.msie){this.controller.show()}else{In2iGui.fadeIn(this.controller,200)}}},hideController:function(){if(!this.overController){if(n2i.browser.msie){this.controller.hide()}else{In2iGui.fadeOut(this.controller,500)}}},zoom:function(E){var A=this.images[this.index];if(A.width<=this.width&&A.height<=this.height){return }if(!this.zoomer){this.zoomer=n2i.build("div",{"class":"in2igui_imageviewer_zoomer",style:"width:"+this.viewer.clientWidth+"px;height:"+this.viewer.clientHeight+"px"});this.element.insertBefore(this.zoomer,n2i.firstByTag(this.element,"*"));n2i.listen(this.zoomer,"mousemove",this.zoomMove.bind(this));n2i.listen(this.zoomer,"click",function(){this.style.display="none"})}this.pause();var D=this.getLargestSize({width:2000,height:2000},A);var C=In2iGui.resolveImageUrl(this,A,D.width,D.height);this.zoomer.innerHTML='<div style="width:'+D.width+"px;height:"+D.height+'px;"><img src="'+C+'"/></div>';this.zoomer.style.display="block";this.zoomInfo={width:D.width,height:D.height};this.zoomMove(E)},zoomMove:function(C){C=new n2i.Event(C);if(!this.zoomInfo){return }var D={left:n2i.getLeft(this.zoomer),top:n2i.getTop(this.zoomer)};var A=(C.left()-D.left)/this.zoomer.clientWidth*(this.zoomInfo.width-this.zoomer.clientWidth);var E=(C.top()-D.top)/this.zoomer.clientHeight*(this.zoomInfo.height-this.zoomer.clientHeight);this.zoomer.scrollLeft=A;this.zoomer.scrollTop=E},getLargestSize:function(A,C){if(C.width<=A.width&&C.height<=A.height){return{width:C.width,height:C.height}}else{if(A.width/A.height>C.width/C.height){return{width:Math.round(A.height/C.height*C.width),height:A.height}}else{if(A.width/A.height<C.width/C.height){return{width:A.width,height:Math.round(A.width/C.width*C.height)}}else{return{width:A.width,height:A.height}}}}},calculateSize:function(){var A=this.options.sizeSnap;var H=n2i.getViewPortWidth()-this.options.perimeter;H=Math.floor(H/A)*A;H=Math.min(H,this.options.maxWidth);var C=n2i.getViewPortHeight()-this.options.perimeter;C=Math.floor(C/A)*A;C=Math.min(C,this.options.maxHeight);var F=0;var E=0;for(var D=0;D<this.images.length;D++){var I=this.getLargestSize({width:H,height:C},this.images[D]);F=Math.max(F,I.width);E=Math.max(E,I.height)}C=Math.floor(Math.min(C,E));H=Math.floor(Math.min(H,F));if(H!=this.width||C!=this.height){this.width=H;this.height=C;this.dirty=true}},adjustSize:function(){},showById:function(C){for(var A=0;A<this.images.length;A++){if(this.images[A].id==C){this.show(A);break}}},show:function(A){this.index=A||0;this.calculateSize();this.updateUI();var C=this.options.margin;n2i.setStyle(this.element,{width:(this.width+C)+"px",height:(this.height+C*2-1)+"px"});n2i.setStyle(this.viewer,{width:(this.width+C)+"px",height:(this.height-1)+"px"});n2i.setStyle(this.innerViewer,{width:((this.width+C)*this.images.length)+"px",height:(this.height-1)+"px"});n2i.setStyle(this.controller,{marginLeft:((this.width-180)/2+C*0.5)+"px",display:"none"});this.box.show();this.goToImage(false,0,false);n2i.listen(document,"keydown",this.keyListener)},hide:function(A){this.pause();this.box.hide();n2i.unListen(document,"keydown",this.keyListener)},$boxCurtainWasClicked:function(){this.hide()},$boxWasClosed:function(){this.hide()},updateUI:function(){if(this.dirty){this.innerViewer.innerHTML="";for(var C=0;C<this.images.length;C++){var A=n2i.build("div",{"class":"in2igui_imageviewer_image"});n2i.setStyle(A,{"width":(this.width+this.options.margin)+"px","height":(this.height-1)+"px"});this.innerViewer.appendChild(A)}if(this.shouldShowController()){this.controller.style.display="block"}else{this.controller.style.display="none"}this.dirty=false;this.preload()}},shouldShowController:function(){return this.images.length>1},goToImage:function(D,E,C){if(D){if(E>1){n2i.ani(this.viewer,"scrollLeft",this.index*(this.width+this.options.margin),Math.min(E*this.options.transitionReturn,2000),{ease:this.options.easeReturn})}else{var A=this.index==0||this.index==this.images.length-1;var H=(A?this.options.easeEnd:this.options.ease);if(!C){H=this.options.easeAuto}n2i.ani(this.viewer,"scrollLeft",this.index*(this.width+this.options.margin),(A?this.options.transitionEnd:this.options.transition),{ease:H})}}else{this.viewer.scrollLeft=this.index*(this.width+this.options.margin)}var F=this.images[this.index].text;if(F){this.text.innerHTML=F;this.text.style.display="block"}else{this.text.innerHTML="";this.text.style.display="none"}},clearImages:function(){this.images=[];this.dirty=true},addImages:function(A){for(var C=0;C<A.length;C++){this.addImage(A[C])}},addImage:function(A){this.images.push(A);this.dirty=true},play:function(){if(!this.interval){this.interval=window.setInterval(this.timer,6000)}this.next(false);this.playing=true;this.playControl.className="in2igui_imageviewer_pause"},pause:function(){window.clearInterval(this.interval);this.interval=null;this.playControl.className="in2igui_imageviewer_play";this.playing=false},playOrPause:function(){if(this.playing){this.pause()}else{this.play()}},resetPlay:function(){if(this.playing){window.clearInterval(this.interval);this.interval=window.setInterval(this.timer,6000)}},previous:function(A){var C=1;this.index--;if(this.index<0){this.index=this.images.length-1;C=this.images.length-1}this.goToImage(true,C,A);this.resetPlay()},next:function(A){var C=1;this.index++;if(this.index==this.images.length){this.index=0;C=this.images.length-1}this.goToImage(true,C,A);this.resetPlay()},preload:function(){var C=new n2i.Preloader();C.addImages(In2iGui.context+"In2iGui/gfx/imageviewer_controls.png");var A=this;C.setDelegate({allImagesDidLoad:function(){A.preloadImages()}});C.load()},preloadImages:function(){var A=new n2i.Preloader();A.setDelegate(this);for(var D=0;D<this.images.length;D++){var C=In2iGui.resolveImageUrl(this,this.images[D],this.width,this.height);if(C!==null){A.addImages(C)}}this.status.innerHTML="0%";this.status.style.display="";A.load(this.index)},allImagesDidLoad:function(){this.status.style.display="none"},imageDidLoad:function(D,E,C){this.status.innerHTML=Math.round(D/E*100)+"%";var A=In2iGui.resolveImageUrl(this,this.images[C],this.width,this.height);A=A.replace(/&amp;/g,"&");this.innerViewer.childNodes[C].style.backgroundImage="url('"+A+"')";n2i.setClass(this.innerViewer.childNodes[C],"in2igui_imageviewer_image_abort",false);n2i.setClass(this.innerViewer.childNodes[C],"in2igui_imageviewer_image_error",false)},imageDidGiveError:function(C,D,A){n2i.setClass(this.innerViewer.childNodes[A],"in2igui_imageviewer_image_error",true)},imageDidAbort:function(C,D,A){n2i.setClass(this.innerViewer.childNodes[A],"in2igui_imageviewer_image_abort",true)}};In2iGui.Picker=function(A){A=this.options=n2i.override({itemWidth:100,itemHeight:150,itemsVisible:null,shadow:true,valueProperty:"value"},A);this.element=n2i.get(A.element);this.name=A.name;this.container=n2i.firstByClass(this.element,"in2igui_picker_container");this.content=n2i.firstByClass(this.element,"in2igui_picker_content");this.title=n2i.firstByClass(this.element,"in2igui_picker_title");this.objects=[];this.selected=null;this.value=null;this.addBehavior();In2iGui.extend(this)};In2iGui.Picker.create=function(A){A=n2i.override({shadow:true},A);A.element=n2i.build("div",{"class":"in2igui_picker",html:'<div class="in2igui_picker_top"><div><div></div></div></div><div class="in2igui_picker_middle"><div class="in2igui_picker_middle">'+(A.title?'<div class="in2igui_picker_title">'+A.title+"</div>":"")+'<div class="in2igui_picker_container"><div class="in2igui_picker_content"></div></div></div></div><div class="in2igui_picker_bottom"><div><div></div></div></div>'});if(A.shadow==true){n2i.addClass(A.element,"in2igui_picker_shadow")}return new In2iGui.Picker(A)};In2iGui.Picker.prototype={addBehavior:function(){var A=this;n2i.listen(this.content,"mousedown",function(C){A.startDrag(C);return false})},setObjects:function(A){this.selected=null;this.objects=A||[];this.updateUI()},setValue:function(A){this.value=A;this.updateSelection()},getValue:function(){return this.value},reset:function(){this.value=null;this.updateSelection()},updateUI:function(){var A=this;this.content.innerHTML="";this.container.scrollLeft=0;if(this.options.itemsVisible){var C=this.options.itemsVisible*(this.options.itemWidth+14)}else{var C=this.container.clientWidth}n2i.setStyle(this.container,{width:C+"px",height:(this.options.itemHeight+10)+"px"});this.content.style.width=(this.objects.length*(this.options.itemWidth+14))+"px";this.content.style.height=(this.options.itemHeight+10)+"px";n2i.each(this.objects,function(D,E){var F=n2i.build("div",{"class":"in2igui_picker_item",title:D.title});if(A.value!=null&&D[A.options.valueProperty]==A.value){n2i.addClass(F,"in2igui_picker_item_selected")}F.innerHTML='<div class="in2igui_picker_item_middle"><div class="in2igui_picker_item_middle"><div style="width:'+A.options.itemWidth+"px;height:"+A.options.itemHeight+"px; overflow: hidden; background-image:url('"+D.image+"')\"><strong>"+n2i.escape(D.title)+'</strong></div></div></div><div class="in2igui_picker_item_bottom"><div><div></div></div></div>';n2i.listen(F,"mouseup",function(){A.selectionChanged(D[A.options.valueProperty])});A.content.appendChild(F)})},updateSelection:function(){var C=this.content.childNodes;for(var A=0;A<C.length;A++){n2i.setClass(C[A],"in2igui_picker_item_selected",this.value!=null&&this.objects[A][this.options.valueProperty]==this.value)}},selectionChanged:function(A){if(this.dragging){return }if(this.value==A){return }this.value=A;this.updateSelection();this.fire("selectionChanged",A)},startDrag:function(C){C=new n2i.Event(C);C.stop();var A=this;this.dragX=C.left();this.dragScroll=this.container.scrollLeft;In2iGui.Picker.mousemove=function(D){A.drag(D);return false};In2iGui.Picker.mouseup=In2iGui.Picker.mousedown=function(D){A.endDrag(D);return false};n2i.listen(window.document,"mousemove",In2iGui.Picker.mousemove);n2i.listen(window.document,"mouseup",In2iGui.Picker.mouseup);n2i.listen(window.document,"mousedown",In2iGui.Picker.mouseup)},drag:function(A){A=new n2i.Event();this.dragging=true;A.stop();this.container.scrollLeft=this.dragX-A.left()+this.dragScroll},endDrag:function(C){this.dragging=false;n2i.stop(C);n2i.unListen(window.document,"mousemove",In2iGui.Picker.mousemove);n2i.unListen(window.document,"mouseup",In2iGui.Picker.mouseup);n2i.unListen(window.document,"mousedown",In2iGui.Picker.mouseup);var A=this.options.itemWidth+14;n2i.ani(this.container,"scrollLeft",Math.round(this.container.scrollLeft/A)*A,500,{ease:n2i.ease.bounceOut})},$visibilityChanged:function(){this.container.style.display="none";if(this.options.itemsVisible){var A=this.options.itemsVisible*(this.options.itemWidth+14)}else{var A=this.container.parentNode.clientWidth-12}A=Math.max(A,0);n2i.setStyle(this.container,{width:A+"px",display:"block"})}};In2iGui.Editor=function(){this.name="In2iGuiEditor";this.options={rowClass:"row",columnClass:"column",partClass:"part"};this.parts=[];this.rows=[];this.partControllers=[];this.activePart=null;this.active=false;this.dragProxy=null;In2iGui.extend(this)};In2iGui.Editor.get=function(){if(!In2iGui.Editor.instance){In2iGui.Editor.instance=new In2iGui.Editor()}return In2iGui.Editor.instance};In2iGui.Editor.prototype={ignite:function(){this.reload()},addPartController:function(C,D,A){this.partControllers.push({key:C,"title":D,"controller":A})},setOptions:function(A){n2i.override(this.options,A)},getPartController:function(A){var C=null;n2i.each(this.partControllers,function(D){if(D.key==A){C=D}});return C},reload:function(){if(this.partControls){this.partControls.hide()}var A=this;this.parts=[];var C=n2i.byClass(document.body,this.options.partClass);n2i.each(C,function(H,F){var E=n2i.byClass(H,A.options.columnClass);A.reloadColumns(E,F);n2i.each(E,function(J,I){var K=J.select("."+A.options.partClass);A.reloadParts(K,F,I)})});var D=n2i.byClass(document.body,this.options.partClass);n2i.each(this.parts,function(E){var F=D.indexOf(E.element);if(F!=-1){delete (D[F])}});this.reloadParts(D,-1,-1)},partExists:function(A){},reloadColumns:function(C,D){var A=this;n2i.each(C,function(F,E){n2i.lsiten(F,"mouseover",function(){A.hoverColumn(F)});n2i.listen(F,"mouseout",function(){A.blurColumn()});n2i.listen(F,"contextmenu",function(H){A.contextColumn(F,D,E,H)})})},reloadParts:function(E,F,D){var A=this;var C=new RegExp(this.options.partClass+"_([\\w]+)","i");n2i.each(E,function(J,L){if(!J){return }var I=J.className.match(C);if(I&&I[1]){var K=A.getPartController(I[1]);if(K){var H=new K.controller(J,F,D,L);H.type=I[1];n2i.listen(J,"click",function(){A.editPart(H)});n2i.listen(J,"mouseover",function(M){A.hoverPart(H)});n2i.listen(J,"mouseout",function(M){A.blurPart(M)});n2i.listen(J,"mousedown",function(M){A.startPartDrag(M)});A.parts.push(H)}}})},activate:function(){this.active=true},deactivate:function(){this.active=false;if(this.activePart){this.activePart.deactivate()}if(this.partControls){this.partControls.hide()}},hoverColumn:function(A){this.hoveredColumn=A;if(!this.active||this.activePart){return }n2i.addClass(A,"in2igui_editor_column_hover")},blurColumn:function(){if(!this.active||!this.hoveredColumn){return }n2i.removeClass(this.hoveredColumn,"in2igui_editor_column_hover")},contextColumn:function(D,I,C,F){if(!this.active||this.activePart){return }if(!this.columnMenu){var H=In2iGui.Menu.create({name:"In2iGuiEditorColumnMenu"});H.addItem({title:"Rediger kolonne",value:"editColumn"});H.addItem({title:"Slet kolonne",value:"removeColumn"});H.addItem({title:"Tilfj kolonne",value:"addColumn"});H.addDivider();for(var A=0;A<this.partControllers.length;A++){var E=this.partControllers[A];H.addItem({title:E.title,value:E.key})}this.columnMenu=H;H.listen(this)}this.hoveredRow=I;this.hoveredColumnIndex=C;this.columnMenu.showAtPointer(F)},$itemWasClicked$In2iGuiEditorColumnMenu:function(A){if(A=="removeColumn"){this.fire("removeColumn",{"row":this.hoveredRow,"column":this.hoveredColumnIndex})}else{if(A=="editColumn"){this.editColumn(this.hoveredRow,this.hoveredColumnIndex)}else{if(A=="addColumn"){this.fire("addColumn",{"row":this.hoveredRow,"position":this.hoveredColumnIndex+1})}else{this.fire("addPart",{"row":this.hoveredRow,"column":this.hoveredColumnIndex,"position":0,type:A})}}}},editColumn:function(D,A){this.closeColumn();var C=this.activeColumn=$$(".row")[D].select(".column")[A];n2i.addClass(C,"in2igui_editor_column_edit");this.showColumnWindow();this.columnEditorForm.setValues({width:C.getStyle("width"),paddingLeft:C.getStyle("padding-left")})},closeColumn:function(){if(this.activeColumn){n2i.removeClass(this.activeColumn,"in2igui_editor_column_edit")}},showColumnWindow:function(){if(!this.columnEditor){var A=this.columnEditor=In2iGui.Window.create({name:"columnEditor",title:"Rediger kolonne",width:200});var H=this.columnEditorForm=In2iGui.Formula.create();var D=H.createGroup();var C=In2iGui.Formula.Text.create({label:"Bredde",key:"width"});C.listen({$valueChanged:function(I){this.changeColumnWidth(I)}.bind(this)});D.add(C);var F=In2iGui.Formula.Text.create({label:"Venstremargen",key:"left"});F.listen({$valueChanged:function(I){this.changeColumnLeftMargin(I)}.bind(this)});D.add(F);var E=In2iGui.Formula.Text.create({label:"Hjremargen",key:"right"});E.listen({$valueChanged:this.changeColumnRightMargin.bind(this)});D.add(E);A.add(H);A.listen(this)}this.columnEditor.show()},$userClosedWindow$columnEditor:function(){this.closeColumn();var A=this.columnEditorForm.getValues();A.row=this.hoveredRow;A.column=this.hoveredColumnIndex;this.fire("updateColumn",A)},changeColumnWidth:function(A){this.activeColumn.style.width=A},changeColumnLeftMargin:function(A){this.activeColumn.setStyle({"paddingLeft":A})},changeColumnRightMargin:function(A){this.activeColumn.setStyle({"paddingRight":A})},hoverPart:function(C,D){if(!this.active||this.activePart){return }this.hoveredPart=C;n2i.addClass(C.element,"in2igui_editor_part_hover");var A=this;this.partControlTimer=window.setTimeout(function(){A.showPartControls()},200)},blurPart:function(A){window.clearTimeout(this.partControlTimer);if(!this.active){return }if(this.partControls&&!In2iGui.isWithin(A,this.partControls.element)){this.hidePartControls();n2i.removeClass(this.hoveredPart.element,"in2igui_editor_part_hover")}if(!this.partControls&&this.hoveredPart){n2i.removeClass(this.hoveredPart.element,"in2igui_editor_part_hover")}},showPartEditControls:function(){if(!this.partEditControls){this.partEditControls=In2iGui.Overlay.create({name:"In2iGuiEditorPartEditActions"});this.partEditControls.addIcon("save","common/save");this.partEditControls.addIcon("cancel","common/close");this.partEditControls.listen(this)}this.partEditControls.showAtElement(this.activePart.element,{"horizontal":"right","vertical":"topOutside"})},showPartControls:function(){if(!this.partControls){this.partControls=In2iGui.Overlay.create({name:"In2iGuiEditorPartActions"});this.partControls.addIcon("edit","common/edit");this.partControls.addIcon("new","common/new");this.partControls.addIcon("delete","common/delete");var A=this;n2i.listen(this.partControls.getElement(),"mouseout",function(C){A.blurControls(C)});n2i.listen(this.partControls.getElement(),"mouseover",function(C){A.hoverControls(C)});this.partControls.listen(this)}if(this.hoveredPart.column==-1){this.partControls.hideIcons(["new","delete"])}else{this.partControls.showIcons(["new","delete"])}this.partControls.showAtElement(this.hoveredPart.element,{"horizontal":"right"})},hoverControls:function(A){n2i.addClass(this.hoveredPart.element,"in2igui_editor_part_hover")},blurControls:function(A){n2i.removeClass(this.hoveredPart.element,"in2igui_editor_part_hover");if(!In2iGui.isWithin(A,this.hoveredPart.element)){this.hidePartControls()}},$iconWasClicked$In2iGuiEditorPartActions:function(A,C){if(A=="delete"){this.deletePart(this.hoveredPart)}else{if(A=="new"){this.newPart(C)}else{if(A=="edit"){this.editPart(this.hoveredPart)}}}},$iconWasClicked$In2iGuiEditorPartEditActions:function(A,C){if(A=="cancel"){this.cancelPart(this.activePart)}else{if(A=="save"){this.savePart(this.activePart)}}},hidePartControls:function(){if(this.partControls){this.partControls.hide()}},hidePartEditControls:function(){if(this.partEditControls){this.partEditControls.hide()}},editPart:function(A){if(!this.active||this.activePart){return }if(this.activePart){this.activePart.deactivate()}if(this.hoveredPart){n2i.removeClass(this.hoveredPart.element,"in2igui_editor_part_hover")}this.activePart=A;this.showPartEditControls();n2i.addClass(A.element,"in2igui_editor_part_active");A.activate();window.clearTimeout(this.partControlTimer);this.hidePartControls();this.blurColumn();this.showPartEditor()},showPartEditor:function(){},updatePartProperties:function(A){n2i.setStyle(this.activePart.element,{marginTop:A.top,marginBottom:A.bottom,marginLeft:A.left,marginRight:A.right});this.activePart.properties=A;n2i.log(A)},hidePartEditor:function(){if(this.partEditor){this.partEditor.hide()}},cancelPart:function(A){A.cancel();this.hidePartEditor()},savePart:function(A){A.save();this.hidePartEditor()},getEditorForElement:function(C){for(var A=0;A<this.parts.length;A++){if(this.parts[A].element==C){return this.parts[A]}}return null},partDidDeacivate:function(A){n2i.removeClass(A.element,"in2igui_editor_part_active");this.activePart=null;this.hidePartEditControls()},partChanged:function(A){In2iGui.callDelegates(A,"partChanged")},deletePart:function(A){In2iGui.callDelegates(A,"deletePart");this.partControls.hide()},newPart:function(A){if(!this.newPartMenu){var C=In2iGui.Menu.create({name:"In2iGuiEditorNewPartMenu"});n2i.each(this.partControllers,function(D){C.addItem({title:D.title,value:D.key})});C.listen(this);this.newPartMenu=C}this.newPartMenu.showAtPointer(A)},itemWasClicked$In2iGuiEditorNewPartMenu:function(A){var C={row:this.hoveredPart.row,column:this.hoveredPart.column,position:this.hoveredPart.position+1,type:A};In2iGui.callDelegates(this,"addPart",C)},startPartDrag:function(C){return true;if(!this.active||this.activePart){return true}if(!this.dragProxy){this.dragProxy=n2i.build("div",{"class":"in2igui_editor_dragproxy part part_header",parent:document.body})}var A=this.hoveredPart.element;this.dragProxy.style.width=A.clientWidth+"px";this.dragProxy.innerHTML=A.innerHTML;In2iGui.Editor.startDrag(C,this.dragProxy);return ;n2i.listen(document.body,"mouseup",function(){self.endPartDrag()})},dragPart:function(){},endPartDrag:function(){In2iGui.get()}};In2iGui.Editor.startDrag=function(C,A){In2iGui.Editor.dragElement=A;n2i.listen(document.body,"mousemove",In2iGui.Editor.dragListener);n2i.listen(document.body,"mouseup",In2iGui.Editor.dragEndListener);In2iGui.Editor.startDragPos={top:C.pointerY(),left:C.pointerX()};C.stop();return false};In2iGui.Editor.dragListener=function(C){C=n2i.event(C);var A=In2iGui.Editor.dragElement;A.style.left=C.getLeft()+"px";A.style.top=C.getTop()+"px";A.style.display="block";return false};In2iGui.Editor.dragEndListener=function(A){n2i.unListen(document.body,"mousemove",In2iGui.Editor.dragListener);n2i.unListen(document.body,"mouseup",In2iGui.Editor.dragEndListener);In2iGui.Editor.dragElement.style.display="none";In2iGui.Editor.dragElement=null};In2iGui.Editor.getPartId=function(C){var A=C.id.match(/part\-([\d]+)/i);if(A&&A.length>0){return A[1]}};In2iGui.Editor.Header=function(C,E,D,A){this.element=$(C);this.row=E;this.column=D;this.position=A;this.id=In2iGui.Editor.getPartId(this.element);this.header=this.element.firstDescendant();this.field=null};In2iGui.Editor.Header.prototype={activate:function(){this.value=this.header.innerHTML;this.field=n2i.build("textarea",{className:"in2igui_editor_header"});this.field.value=this.value;this.header.style.visibility="hidden";this.updateFieldStyle();this.element.insertBefore(this.field,this.header);this.field.focus();this.field.select();n2i.listen(this.field,"keydown",function(A){if(A.keyCode==Event.KEY_RETURN){this.save()}}.bind(this))},save:function(){var A=this.field.value;this.header.innerHTML=A;this.deactivate();if(A!=this.value){this.value=A;In2iGui.Editor.get().partChanged(this)}},cancel:function(){this.deactivate()},deactivate:function(){this.header.style.visibility="";this.element.removeChild(this.field);In2iGui.Editor.get().partDidDeacivate(this)},updateFieldStyle:function(){n2i.setStyle(this.field,{width:this.header.getWidth()+"px",height:this.header.getHeight()+"px"});n2i.copyStyle(this.header,this.field,["fontSize","lineHeight","marginTop","fontWeight","fontFamily","textAlign","color","fontStyle"])},getValue:function(){return this.value}};In2iGui.Editor.Html=function(C,E,D,A){this.element=$(C);this.row=E;this.column=D;this.position=A;this.id=In2iGui.Editor.getPartId(this.element);this.field=null};In2iGui.Editor.Html.prototype={activate:function(){this.value=this.element.innerHTML;var A=this.element.clientHeight;this.element.innerHTML="";var C=this.buildStyle();this.editor=In2iGui.RichText.create({autoHideToolbar:false,style:C});this.editor.setHeight(A);this.element.appendChild(this.editor.getElement());this.editor.listen(this);this.editor.ignite();this.editor.setValue(this.value);this.editor.focus()},buildStyle:function(){return{"textAlign":n2i.getStyle(this.element,"text-align"),"fontFamily":n2i.getStyle(this.element,"font-family"),"fontSize":n2i.getStyle(this.element,"font-size"),"fontWeight":n2i.getStyle(this.element,"font-weight"),"color":n2i.getStyle(this.element,"color")}},cancel:function(){this.deactivate();this.element.innerHTML=this.value},save:function(){this.deactivate();var A=this.editor.value;if(A!=this.value){this.value=A;In2iGui.Editor.get().partChanged(this)}this.element.innerHTML=this.value},deactivate:function(){if(this.editor){this.editor.deactivate();this.element.innerHTML=this.value}In2iGui.Editor.get().partDidDeacivate(this)},richTextDidChange:function(){},getValue:function(){return this.value}};In2iGui.Menu=function(A){this.options=n2i.override({autoHide:false,parentElement:null},A);this.element=n2i.get(A.element);this.name=A.name;this.value=null;this.subMenus=[];this.visible=false;In2iGui.extend(this);this.addBehavior()};In2iGui.Menu.create=function(A){A=A||{};A.element=n2i.build("div",{"class":"in2igui_menu"});var C=new In2iGui.Menu(A);document.body.appendChild(A.element);return C};In2iGui.Menu.prototype={addBehavior:function(){var C=this;this.hider=function(){C.hide()};if(this.options.autoHide){var A=function(D){if(!In2iGui.isWithin(D,C.element)&&(!C.options.parentElement||!In2iGui.isWithin(D,C.options.parentElement))){if(!C.isSubMenuVisible()){C.hide()}}};n2i.listen(this.element,"mouseout",A);if(this.options.parentElement){n2i.listen(this.options.parentElement,"mouseout",A)}}},addDivider:function(){n2i.build("div",{"class":"in2igui_menu_divider",parent:this.element})},addItem:function(E){var A=this;var C=n2i.build("div",{"class":"in2igui_menu_item",text:E.title});n2i.listen(C,"click",function(F){n2i.stop(F);A.itemWasClicked(E.value)});if(E.children){var D=In2iGui.Menu.create({autoHide:true,parentElement:C});D.addItems(E.children);n2i.listen(C,"mouseover",function(F){D.showAtElement(C,F,"horizontal")});A.subMenus.push(D);n2i.addClass(C,"in2igui_menu_item_children")}this.element.appendChild(C)},addItems:function(A){for(var C=0;C<A.length;C++){if(A[C]==null){this.addDivider()}else{this.addItem(A[C])}}},getValue:function(){return this.value},itemWasClicked:function(A){this.value=A;this.fire("itemWasClicked",A);this.fire("select",A);this.hide()},showAtPointer:function(A){A=n2i.event(A);A.stop();this.showAtPoint({"top":A.getTop(),"left":A.getLeft()})},showAtElement:function(D,E,C){E=n2i.event(E);E.stop();D=n2i.get(D);var A=n2i.getPosition(D);if(C=="horizontal"){A.left+=D.clientWidth}else{if(C=="vertical"){A.top+=D.clientHeight}}this.showAtPoint(A)},showAtPoint:function(J){var H=n2i.getViewPortWidth();var A=n2i.getViewPortHeight();var D=n2i.getScrollTop();var F=n2i.getScrollLeft();if(!this.visible){n2i.setStyle(this.element,{"display":"block","visibility":"hidden",opacity:0})}var C=this.element.clientWidth;var K=this.element.clientHeight;var E=Math.min(J.left,H-C-26+F);var I=Math.max(0,Math.min(J.top,A-K-20+D));n2i.setStyle(this.element,{"top":I+"px","left":E+"px","visibility":"visible",zIndex:In2iGui.nextTopIndex()});if(!this.element.style.width){this.element.style.width=(C+6)+"px"}if(!this.visible){n2i.setStyle(this.element,{opacity:1});this.addHider();this.visible=true}},hide:function(){if(!this.visible){return }var A=this;n2i.animate(this.element,"opacity",0,200,{onComplete:function(){A.element.style.display="none"}});this.removeHider();for(var C=0;C<this.subMenus.length;C++){this.subMenus[C].hide()}this.visible=false},isSubMenuVisible:function(){for(var A=0;A<this.subMenus.length;A++){if(this.subMenus[A].visible){return true}}return false},addHider:function(){n2i.listen(document.body,"click",this.hider)},removeHider:function(){n2i.unListen(document.body,"click",this.hider)}};In2iGui.Overlay=function(A){this.options=A;this.element=n2i.get(A.element);this.content=n2i.byClass(this.element,"in2igui_inner_overlay")[1];this.name=A.name;this.icons={};this.visible=false;In2iGui.extend(this);this.addBehavior()};In2iGui.Overlay.create=function(A){A=A||{};var C=A.element=n2i.build("div",{className:"in2igui_overlay",style:"display:none",html:'<div class="in2igui_inner_overlay"><div class="in2igui_inner_overlay"></div></div>'});document.body.appendChild(C);return new In2iGui.Overlay(A)};In2iGui.Overlay.prototype={addBehavior:function(){var A=this;this.hider=function(C){if(A.boundElement){if(In2iGui.isWithin(C,A.boundElement)||In2iGui.isWithin(C,A.element)){return }n2i.removeClass(A.boundElement,"in2igui_overlay_bound");A.boundElement=null;A.hide()}};n2i.listen(this.element,"mouseout",this.hider)},addIcon:function(D,E){var A=this;var C=n2i.build("div",{className:"in2igui_overlay_icon"});C.style.backgroundImage="url("+In2iGui.getIconUrl(E,2)+")";n2i.listen(C,"click",function(F){A.iconWasClicked(D,F)});this.icons[D]=C;this.content.appendChild(C)},addText:function(A){this.content.appendChild(n2i.build("span",{"class":"in2igui_overlay_text",text:A}))},add:function(A){this.content.appendChild(A.getElement())},hideIcons:function(C){for(var A=0;A<C.length;A++){this.icons[C[A]].style.display="none"}},showIcons:function(C){for(var A=0;A<C.length;A++){this.icons[C[A]].style.display=""}},iconWasClicked:function(A,C){In2iGui.callDelegates(this,"iconWasClicked",A,C)},showAtElement:function(C,A){A=A||{};In2iGui.positionAtElement(this.element,C,A);if(this.visible){return }if(n2i.browser.msie){this.element.style.display="block"}else{n2i.setStyle(this.element,{"display":"block","opacity":0});n2i.ani(this.element,"opacity",1,150)}this.visible=true;if(A.autoHide){this.boundElement=C;n2i.listen(C,"mouseout",this.hider);n2i.addClass(C,"in2igui_overlay_bound")}if(this.options.modal){var D=In2iGui.nextAlertIndex();this.element.style.zIndex=D+1;In2iGui.showCurtain({widget:this,zIndex:D})}return },show:function(C){C=C||{};if(!this.visible){n2i.setStyle(this.element,{"display":"block",visibility:"hidden"})}if(C.element){n2i.place({source:{element:this.element,vertical:0,horizontal:0.5},target:{element:C.element,vertical:0.5,horizontal:0.5}})}if(this.visible){return }In2iGui.bounceIn(this.element);this.visible=true;if(C.autoHide&&C.element){this.boundElement=C.element;n2i.listen(C.element,"mouseout",this.hider);n2i.addClass(C.element,"in2igui_overlay_bound")}if(this.options.modal){var D=In2iGui.nextAlertIndex();this.element.style.zIndex=D+1;var A=n2i.getStyle(document.body,"background-color");In2iGui.showCurtain({widget:this,zIndex:D,color:A})}},$curtainWasClicked:function(){this.hide()},hide:function(){In2iGui.hideCurtain(this);this.element.style.display="none";this.visible=false},clear:function(){In2iGui.destroyDescendants(this.content);this.content.innerHTML=""}};In2iGui.Upload=function(A){this.options=n2i.override({url:"",parameters:{},maxItems:50,maxSize:"20480",types:"*.*",useFlash:true,fieldName:"file",chooseButton:"Choose files..."},A);this.element=n2i.get(A.element);this.itemContainer=n2i.firstByClass(this.element,"in2igui_upload_items");this.status=n2i.firstByClass(this.element,"in2igui_upload_status");this.placeholder=n2i.firstByClass(this.element,"in2igui_upload_placeholder");this.name=A.name;this.items=[];this.busy=false;this.loaded=false;this.useFlash=this.options.useFlash;if(this.options.useFlash){this.useFlash=In2iGui.Flash.getMajorVersion()>=10}In2iGui.extend(this);this.addBehavior()};In2iGui.Upload.nameIndex=0;In2iGui.Upload.create=function(A){A=A||{};A.element=n2i.build("div",{"class":"in2igui_upload",html:'<div class="in2igui_upload_items"></div><div class="in2igui_upload_status"></div>'+(A.placeholder?'<div class="in2igui_upload_placeholder"><span class="in2igui_upload_icon"></span>'+(A.placeholder.title?"<h2>"+n2i.escape(A.placeholder.title)+"</h2>":"")+(A.placeholder.text?"<p>"+n2i.escape(A.placeholder.text)+"</p>":"")+"</div>":"")});return new In2iGui.Upload(A)};In2iGui.Upload.prototype={addBehavior:function(){if(!this.useFlash){this.createIframeVersion();return }In2iGui.onDomReady(this.createFlashVersion.bind(this))},setParameter:function(A,E){if(this.useFlash){alert("Not implemented for flash")}else{var D=this.form.getElementsByTagName("input");for(var C=0;C<D.length;C++){if(D[C].name==A){D[C].value=E;return }}this.form.appendChild(n2i.build("input",{"type":"hidden","name":A,"value":E}))}},createIframeVersion:function(){In2iGui.Upload.nameIndex++;var A="in2igui_upload_"+In2iGui.Upload.nameIndex;var F=this.form=n2i.build("form");F.setAttribute("action",this.options.url||"");F.setAttribute("method","post");F.setAttribute("enctype","multipart/form-data");F.setAttribute("encoding","multipart/form-data");F.setAttribute("target",A);if(this.options.parameters){for(key in this.options.parameters){var H=n2i.build("input",{"type":"hidden","name":key});H.value=this.options.parameters[key];F.appendChild(H)}}var E=this.iframe=n2i.build("iframe",{name:A,id:A,src:In2iGui.context+"/In2iGui/html/blank.html",style:"display:none"});this.element.appendChild(E);this.fileInput=n2i.build("input",{"type":"file","class":"file","name":this.options.fieldName});n2i.listen(this.fileInput,"change",this.iframeSubmit.bind(this));F.appendChild(this.fileInput);var C=n2i.build("span",{"class":"in2igui_upload_button"});var D=n2i.build("span",{"class":"in2igui_upload_button_input"});D.appendChild(F);C.appendChild(D);if(this.options.widget){In2iGui.onDomReady(function(){var I=In2iGui.get(this.options.widget);I.element.parentNode.insertBefore(C,I.element);I.element.parentNode.removeChild(I.element);C.appendChild(I.element)}.bind(this))}else{C.innerHTML='<a href="javascript:void(0);" class="in2igui_button"><span><span>'+this.options.chooseButton+"</span></span></a>";this.element.appendChild(C)}n2i.listen(E,"load",function(){this.iframeUploadComplete()}.bind(this))},iframeUploadComplete:function(){if(!this.uploading){return }n2i.log("iframeUploadComplete uploading: "+this.uploading+" ("+this.name+")");this.uploading=false;this.form.reset();var C=n2i.getFrameDocument(this.iframe);var A=this.items[this.items.length-1];if(C.body.innerHTML.indexOf("SUCCESS")!=-1){if(A){A.update({progress:1,filestatus:"Frdig"})}this.fire("uploadDidComplete",{});n2i.log("Iframe upload succeeded")}else{if(A){A.setError("Upload af filen fejlede!");n2i.log("Iframe upload failed!");this.fire("uploadDidFail",{})}}this.fire("uploadDidCompleteQueue");this.iframe.src=In2iGui.context+"/In2iGui/html/blank.html";this.endIframeProgress()},iframeSubmit:function(){this.startIframeProgress();this.uploading=true;if(n2i.browser.msie){var A=this.options.parameters;n2i.each(this.options.parameters,function(D,E){this.form[D].value=E}.bind(this))}this.form.submit();this.fire("uploadDidStartQueue");var C=this.fileInput.value.split("\\").pop();this.addItem({name:C,filestatus:"I gang"}).setWaiting();n2i.log("Iframe upload started!")},startIframeProgress:function(){this.form.style.display="none"},endIframeProgress:function(){this.form.style.display="block";this.form.reset()},clear:function(){for(var A=0;A<this.items.length;A++){if(this.items[A]){this.items[A].destroy()}}this.items=[];this.itemContainer.hide();this.status.hide();if(this.placeholder){this.placeholder.show()}},getAbsoluteUrl:function(C){var D=new String(document.location);var A=D.slice(0,D.lastIndexOf("/"));while(C.indexOf("../")===0){C=C.substring(3);A=A.slice(0,A.lastIndexOf("/"))}A+="/"+C;return A},createFlashVersion:function(){n2i.log("Creating flash verison");var F=this.getAbsoluteUrl(this.options.url);var D=n2i.cookie.get("JSESSIONID");if(D){F+=";jsessionid="+D}var H=n2i.cookie.get("PHPSESSID");if(H){F+="?PHPSESSID="+H}var E=n2i.build("span",{"class":"in2igui_upload_button"});var I=n2i.build("span",{"class":"in2igui_upload_button_object",parent:E});if(this.options.widget){var A=In2iGui.get(this.options.widget);A.element.parentNode.insertBefore(E,A.element);A.element.parentNode.removeChild(A.element);E.appendChild(A.element)}else{E.innerHTL='<a href="javascript:void(0);" class="in2igui_button"><span><span>'+this.options.chooseButton+"</span></span></a>";this.element.appendChild(E)}var C=this;this.loader=new SWFUpload({upload_url:F,flash_url:In2iGui.context+"/In2iGui/lib/swfupload/swfupload.swf",file_size_limit:this.options.maxSize,file_queue_limit:this.options.maxItems,file_post_name:this.options.fieldName,file_upload_limit:this.options.maxItems,file_types:this.options.types,debug:true,post_params:this.options.parameters,button_placeholder_id:"x",button_placeholder:I,button_width:"100%",button_height:30,swfupload_loaded_handler:this.flashLoaded.bind(this),file_queued_handler:C.fileQueued.bind(C),file_queue_error_handler:this.fileQueueError.bind(this),file_dialog_complete_handler:this.fileDialogComplete.bind(this),upload_start_handler:this.uploadStart.bind(this),upload_progress_handler:this.uploadProgress.bind(this),upload_error_handler:this.uploadError.bind(this),upload_success_handler:this.uploadSuccess.bind(this),upload_complete_handler:this.uploadComplete.bind(this)})},startNextUpload:function(){this.loader.startUpload()},flashLoaded:function(){n2i.log("flash loaded");this.loaded=true},addError:function(C,A){var D=this.addItem(C);D.setError(A)},fileQueued:function(A){this.addItem(A)},fileQueueError:function(C,A,D){if(C!==null){this.addError(C,A)}else{In2iGui.showMessage({text:In2iGui.Upload.errors[A],duration:4000})}},fileDialogComplete:function(){n2i.log("fileDialogComplete");this.startNextUpload()},uploadStart:function(){this.status.style.display="block";n2i.log("uploadStart");if(!this.busy){this.fire("uploadDidStartQueue")}this.busy=true},uploadProgress:function(C,A,D){this.updateStatus();this.items[C.index].updateProgress(A,D)},uploadError:function(C,A,D){n2i.log("uploadError file:"+C+", error:"+A+", message:"+D);if(C){this.items[C.index].update(C)}},uploadSuccess:function(A,C){n2i.log("uploadSuccess file:"+A+", data:"+C);this.items[A.index].updateProgress(A.size,A.size)},uploadComplete:function(C){this.items[C.index].update(C);this.startNextUpload();var A=this;this.fire("uploadDidComplete",C);if(this.loader.getStats().files_queued==0){this.fire("uploadDidCompleteQueue")}this.updateStatus();this.busy=false},addItem:function(C){var A=C.index;if(A===undefined){A=this.items.length;C.index=A}var D=new In2iGui.Upload.Item(C);this.items[A]=D;this.itemContainer.appendChild(D.element);this.itemContainer.style.display="block";if(this.placeholder){this.placeholder.style.display="none"}return D},updateStatus:function(){var A=this.loader.getStats();if(this.items.length==0){this.status.style.display="none"}else{n2i.dom.setText(this.status,"Status: "+Math.round(A.successful_uploads/this.items.length*100)+"%");this.status.style.display="block"}n2i.log(A)}};In2iGui.Upload.Item=function(A){this.element=n2i.build("div",{className:"in2igui_upload_item"});if(A.index%2==1){n2i.addClass(this.element,"in2igui_upload_item_alt")}this.content=n2i.build("div",{className:"in2igui_upload_item_content"});this.icon=In2iGui.createIcon("file/generic",2);this.element.appendChild(this.icon);this.element.appendChild(this.content);this.info=document.createElement("strong");this.status=document.createElement("em");this.progress=In2iGui.ProgressBar.create({small:true});this.content.appendChild(this.progress.getElement());this.content.appendChild(this.info);this.content.appendChild(this.status);this.update(A)};In2iGui.Upload.Item.prototype={update:function(A){n2i.dom.setText(this.status,In2iGui.Upload.status[A.filestatus]||A.filestatus);if(A.name){n2i.dom.setText(this.info,A.name)}if(A.progress!==undefined){this.setProgress(A.progress)}if(A.filestatus==SWFUpload.FILE_STATUS.ERROR){n2i.addClass(this.element,"in2igui_upload_item_error");this.progress.hide()}},setError:function(A){this.status.update(In2iGui.Upload.errors[A]||A);n2i.addClass(this.element,"in2igui_upload_item_error");this.progress.hide()},updateProgress:function(A,C){this.progress.setValue(A/C);return this},setProgress:function(A){this.progress.setValue(A);return this},setWaiting:function(A){this.progress.setWaiting();return this},hide:function(){this.element.hide()},destroy:function(){this.element.remove()}};if(window.SWFUpload){(function(){var C=In2iGui.Upload.errors={};C[SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED]="Der er valgt for mange filer";C[SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT]="Filen er for stor";C[SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE]="Filen er tom";C[SWFUpload.QUEUE_ERROR.INVALID_FILETYPE]="Filens type er ikke understttet";C[SWFUpload.UPLOAD_ERROR.HTTP_ERROR]="Der skete en netvrksfejl";C[SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL]="Upload-adressen findes ikke";C[SWFUpload.UPLOAD_ERROR.IO_ERROR]="Der skete en IO-fejl";C[SWFUpload.UPLOAD_ERROR.SECURITY_ERROR]="Der skete en sikkerhedsfejl";C[SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED]="Upload-strrelsen er overskredet";C[SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED]="Upload af filen fejlede";C[SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND]="Filens id kunne ikke findes";C[SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED]="Validering af filen fejlede";C[SWFUpload.UPLOAD_ERROR.FILE_CANCELLED]="Filen blev afbrudt";C[SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED]="Upload af filen blev stoppet";var A=In2iGui.Upload.status={};A[SWFUpload.FILE_STATUS.QUEUED]="I k";A[SWFUpload.FILE_STATUS.IN_PROGRESS]="I gang";A[SWFUpload.FILE_STATUS.ERROR]="Filen gav fejl";A[SWFUpload.FILE_STATUS.COMPLETE]="Frdig";A[SWFUpload.FILE_STATUS.CANCELLED]="Afbrudt"}())}In2iGui.ProgressBar=function(A){this.element=n2i.get(A.element);this.name=A.name;this.WAITING=A.small?"in2igui_progressbar_small_waiting":"in2igui_progressbar_waiting";this.COMPLETE=A.small?"in2igui_progressbar_small_complete":"in2igui_progressbar_complete";this.options=A||{};this.indicator=n2i.firstByTag(this.element,"div");In2iGui.extend(this)};In2iGui.ProgressBar.create=function(C){C=C||{};var A=C.element=n2i.build("div",{"class":C.small?"in2igui_progressbar in2igui_progressbar_small":"in2igui_progressbar"});A.appendChild(document.createElement("div"));return new In2iGui.ProgressBar(C)};In2iGui.ProgressBar.prototype={setValue:function(C){var A=this.element;if(this.waiting){n2i.removeClass(A,this.WAITING)}n2i.setClass(A,this.COMPLETE,C==1);n2i.ani(this.indicator,"width",(C*100)+"%",200)},setWaiting:function(){this.waiting=true;this.indicator.style.width=0;n2i.addClass(this.element,this.WAITING)},reset:function(){var A=this.element;if(this.waiting){n2i.removeClass(A,this.WAITING)}n2i.removeClass(A,this.COMPLETE);this.indicator.style.width="0%"},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display="block"}};In2iGui.Gallery=function(A){this.options=A||{};this.name=A.name;this.element=n2i.get(A.element);this.objects=[];this.nodes=[];this.selected=[];this.width=100;this.height=100;this.revealing=false;In2iGui.extend(this);if(this.options.source){this.options.source.listen(this)}if(this.element.parentNode&&n2i.hasClass(this.element.parentNode,"in2igui_overflow")){this.revealing=true;n2i.listen(this.element.parentNode,"scroll",this._reveal.bind(this))}};In2iGui.Gallery.create=function(A){A=A||{};A.element=n2i.build("div",{"class":"in2igui_gallery"});return new In2iGui.Gallery(A)};In2iGui.Gallery.prototype={setObjects:function(A){this.objects=A;this.render();this.fire("selectionReset")},getObjects:function(){return this.objects},$objectsLoaded:function(A){this.setObjects(A)},$itemsLoaded:function(A){this.setObjects(A)},render:function(){this.nodes=[];this.maxRevealed=0;this.element.innerHTML="";var A=this;n2i.each(this.objects,function(E,F){var D=A.resolveImageUrl(E);if(D!==null){D=D.replace(/&amp;/,"&")}if(E.height<E.width){var I=(A.height-(A.height*E.height/E.width))/2}else{var I=0}var C=n2i.build("img",{style:"margin:"+I+"px auto 0px"});C.setAttribute(A.revealing?"data-src":"src",D);var H=n2i.build("div",{"class":"in2igui_gallery_item",style:"width:"+A.width+"px; height:"+A.height+"px"});H.appendChild(C);n2i.listen(H,"click",function(){A.itemClicked(F)});H.dragDropInfo={kind:"image",icon:"common/image",id:E.id,title:E.name||E.title};H.onmousedown=function(J){In2iGui.startDrag(J,H);return false};n2i.listen(H,"dblclick",function(){A.itemDoubleClicked(F)});A.element.appendChild(H);A.nodes.push(H)});this._reveal()},$$layout:function(){if(this.nodes.length>0){this._reveal()}},_reveal:function(){if(!this.revealing){return }var D=this.element.parentNode;var C=D.scrollTop+D.clientHeight;if(C<=this.maxRevealed){return }this.maxRevealed=C;for(var F=0,A=this.nodes.length;F<A;F++){var H=this.nodes[F];if(H.revealed){continue}if(H.offsetTop<C){var E=H.getElementsByTagName("img")[0];H.className="in2igui_gallery_item in2igui_gallery_item_busy";E.onload=function(){n2i.log("loaded");H.className="in2igui_gallery_item";n2i.log("loaded"+H.className)};E.src=E.getAttribute("data-src");H.revealed=true}}},updateUI:function(){var C=this.selected;for(var A=0;A<this.nodes.length;A++){n2i.setClass(this.nodes[A],"in2igui_gallery_item_selected",n2i.inArray(C,A))}},resolveImageUrl:function(A){return In2iGui.resolveImageUrl(this,A,this.width,this.height);for(var C=0;C<this.delegates.length;C++){if(this.delegates[C]["$resolveImageUrl"]){return this.delegates[C]["$resolveImageUrl"](A,this.width,this.height)}}return""},itemClicked:function(A){this.selected=[A];this.fire("selectionChanged");this.updateUI()},getFirstSelection:function(){if(this.selected.length>0){return this.objects[this.selected[0]]}return null},itemDoubleClicked:function(A){this.fire("itemOpened",this.objects[A])},setSource:function(A){if(this.options.source!=A){if(this.options.source){this.options.source.removeDelegate(this)}A.listen(this);this.options.source=A;A.refresh()}}};In2iGui.Calendar=function(A){this.name=A.name;this.options=n2i.override({startHour:7,endHour:24},A);this.element=n2i.get(A.element);this.head=n2i.firstByTag(this.element,"thead");this.body=n2i.firstByTag(this.element,"tbody");this.date=new Date();In2iGui.extend(this);this.buildUI();this.updateUI();if(this.options.source){this.options.source.listen(this)}};In2iGui.Calendar.prototype={show:function(){this.element.style.display="block";if(this.options.source){this.options.source.refresh()}},hide:function(){this.element.style.display="none"},getFirstDay:function(){var A=new Date(this.date.getTime());A.setDate(A.getDate()-A.getDay()+1);A.setHours(0);A.setMinutes(0);A.setSeconds(0);return A},getLastDay:function(){var A=new Date(this.date.getTime());A.setDate(A.getDate()-A.getDay()+7);A.setHours(23);A.setMinutes(59);A.setSeconds(59);return A},clearEvents:function(){this.events=[];var A=n2i.byClass(this.element,"in2igui_calendar_event");for(var C=0;C<A.length;C++){n2i.dom.remove(A[C])}this.hideEventViewer()},$objectsLoaded:function(A){try{this.setEvents(A)}catch(C){n2i.log(C)}},$sourceIsBusy:function(){this.setBusy(true)},$sourceShouldRefresh:function(){return this.element.style.display!="none"},setEvents:function(E){E=E||[];for(var D=0;D<E.length;D++){var H=E[D];if(typeof (H.startTime)!="object"){H.startTime=new Date(parseInt(H.startTime)*1000)}if(typeof (H.endTime)!="object"){H.endTime=new Date(parseInt(H.endTime)*1000)}}this.setBusy(false);this.clearEvents();this.events=E;var A=this;var I=(this.options.endHour-this.options.startHour)*40;var C=this.getFirstDay().getWeekOfYear();var F=this.getFirstDay().getYear();n2i.each(this.events,function(N){var K=n2i.byClass(A.body,"in2igui_calendar_day")[N.startTime.getDay()-1];if(!K){return }if(N.startTime.getWeekOfYear()!=C||N.startTime.getYear()!=F){return }var M=n2i.build("div",{"class":"in2igui_calendar_event",parent:K});var O=((N.startTime.getHours()*60+N.startTime.getMinutes())/60-A.options.startHour)*40-1;var J=(N.endTime.getTime()-N.startTime.getTime())/1000/60/60*40+1;var J=Math.min(I-O,J);n2i.setStyle(M,{"marginTop":O+"px","height":J+"px",visibility:"hidden"});var L=n2i.build("div",{parent:M});n2i.build("p",{"class":"in2igui_calendar_event_time",text:N.startTime.dateFormat("H:i"),parent:L});n2i.build("p",{"class":"in2igui_calendar_event_text",text:N.text,parent:L});if(N.location){n2i.build("p",{"class":"in2igui_calendar_event_location",text:N.location,parent:L})}window.setTimeout(function(){In2iGui.bounceIn(M)},Math.random()*200);n2i.listen(M,"click",function(){A.eventWasClicked(M)})})},eventWasClicked:function(A){this.showEvent(A)},setBusy:function(A){n2i.setClass(this.element,"in2igui_calendar_busy",A)},updateUI:function(){var D=this.getFirstDay();var E=n2i.byClass(this.head,"day");for(var C=0;C<E.length;C++){var A=new Date(D.getTime());A.setDate(A.getDate()+C);n2i.dom.setText(E[C],A.dateFormat("l \\d. d M"))}},buildUI:function(){var H=n2i.firstByClass(this.element,"in2igui_calendar_bar");this.toolbar=In2iGui.Toolbar.create({labels:false});H.appendChild(this.toolbar.getElement());var F=In2iGui.Button.create({name:"in2iguiCalendarPrevious",text:"",icon:"monochrome/previous"});F.listen(this);this.toolbar.add(F);var A=In2iGui.Button.create({name:"in2iguiCalendarToday",text:"Idag"});A.click(function(){this.setDate(new Date())}.bind(this));this.toolbar.add(A);var D=In2iGui.Button.create({name:"in2iguiCalendarNext",text:"",icon:"monochrome/next"});D.listen(this);this.toolbar.add(D);this.datePickerButton=In2iGui.Button.create({name:"in2iguiCalendarDatePicker",text:"Vlg dato..."});this.datePickerButton.listen(this);this.toolbar.add(this.datePickerButton);var I=n2i.firstByClass(this.body,"in2igui_calendar_day");for(var C=this.options.startHour;C<=this.options.endHour;C++){var E=n2i.build("div",{"class":"in2igui_calendar_time",html:"<span><em>"+C+":00</em></span>"});if(C==this.options.startHour){n2i.addClass(E,"in2igui_calendar_time_first")}if(C==this.options.endHour){n2i.addClass(E,"in2igui_calendar_time_last")}I.appendChild(E)}},$click$in2iguiCalendarPrevious:function(){var A=new Date(this.date.getTime());A.setDate(this.date.getDate()-7);this.setDate(A)},$click$in2iguiCalendarNext:function(){var A=new Date(this.date.getTime());A.setDate(this.date.getDate()+7);this.setDate(A)},setDate:function(A){this.date=new Date(A.getTime());this.updateUI();this.refresh();if(this.datePicker){this.datePicker.setValue(this.date)}},$click$in2iguiCalendarDatePicker:function(){this.showDatePicker()},refresh:function(){this.clearEvents();this.setBusy(true);var A={"startTime":this.getFirstDay(),"endTime":this.getLastDay()};this.fire("calendarSpanChanged",A);In2iGui.firePropertyChange(this,"startTime",this.getFirstDay());In2iGui.firePropertyChange(this,"endTime",this.getLastDay())},valueForProperty:function(A){if(A=="startTime"){return this.getFirstDay()}if(A=="endTime"){return this.getLastDay()}return this[A]},showDatePicker:function(){if(!this.datePickerPanel){this.datePickerPanel=In2iGui.BoundPanel.create();this.datePicker=In2iGui.DatePicker.create({name:"in2iguiCalendarDatePicker",value:this.date});this.datePicker.listen(this);this.datePickerPanel.add(this.datePicker);this.datePickerPanel.addSpace(3);var A=In2iGui.Button.create({name:"in2iguiCalendarDatePickerClose",text:"Luk",small:true,rounded:true});A.listen(this);this.datePickerPanel.add(A)}this.datePickerPanel.position(this.datePickerButton.getElement());this.datePickerPanel.show()},$click$in2iguiCalendarDatePickerClose:function(){this.datePickerPanel.hide()},$dateChanged$in2iguiCalendarDatePicker:function(A){this.setDate(A)},showEvent:function(C){if(!this.eventViewerPanel){this.eventViewerPanel=In2iGui.BoundPanel.create({width:270,padding:3});this.eventInfo=In2iGui.InfoView.create(null,{height:240,clickObjects:true});this.eventViewerPanel.add(this.eventInfo);this.eventViewerPanel.addSpace(5);var A=In2iGui.Button.create({name:"in2iguiCalendarEventClose",text:"Luk"});A.listen(this);this.eventViewerPanel.add(A)}this.eventInfo.clear();this.eventInfo.setBusy(true);this.eventViewerPanel.position(C);this.eventViewerPanel.show();In2iGui.callDelegates(this,"requestEventInfo");return },updateEventInfo:function(A,C){this.eventInfo.setBusy(false);this.eventInfo.update(C)},click$in2iguiCalendarEventClose:function(){this.hideEventViewer()},hideEventViewer:function(){if(this.eventViewerPanel){this.eventViewerPanel.hide()}}};In2iGui.DatePicker=function(A){this.name=A.name;this.element=n2i.get(A.element);this.options={};n2i.override(this.options,A);this.cells=[];this.title=n2i.firstByTag(this.element,"strong");this.today=new Date();this.value=this.options.value?new Date(this.options.value.getTime()):new Date();this.viewDate=new Date(this.value.getTime());this.viewDate.setDate(1);In2iGui.extend(this);this.addBehavior();this.updateUI()};In2iGui.DatePicker.create=function(L){var C=L.element=n2i.build("div",{"class":"in2igui_datepicker",html:'<div class="in2igui_datepicker_header"><a class="in2igui_datepicker_next"></a><a class="in2igui_datepicker_previous"></a><strong></strong></div>'});var J=n2i.build("table",{parent:C});var F=n2i.build("thead",{parent:J});var H=n2i.build("tr",{parent:F});for(var D=0;D<7;D++){H.appendChild(n2i.build("th",{text:Date.dayNames[D].substring(0,3)}))}var E=n2i.build("tbody",{parent:J});for(var D=0;D<6;D++){var K=n2i.build("tr",{parent:E});for(var A=0;A<7;A++){var I=n2i.build("td",{parent:K})}}return new In2iGui.DatePicker(L)};In2iGui.DatePicker.prototype={addBehavior:function(){var A=this;this.cells=n2i.firstByClass(this.element,"td");this.each(this.cells,function(E,F){n2i.listen(E,"mousedown",function(){A.selectCell(F)})});var C=n2i.firstByClass(this.element,"in2igui_datepicker_next");var D=n2i.firstByClass(this.element,"in2igui_datepicker_previous");n2i.listen(C,"mousedown",function(){A.next()});n2i.listen(D,"mousedown",function(){A.previous()})},setValue:function(A){this.value=new Date(A.getTime());this.viewDate=new Date(A.getTime());this.viewDate.setDate(1);this.updateUI()},updateUI:function(){this.title.update(this.viewDate.dateFormat("F Y"));var D=this.value.getFullYear()==this.viewDate.getFullYear();var F=this.viewDate.getMonth();for(var E=0;E<this.cells.length;E++){var C=this.indexToDate(E);var A=this.cells[E];if(C.getMonth()<F){A.className="in2igui_datepicker_dimmed"}else{if(C.getMonth()>F){A.className="in2igui_datepicker_dimmed"}else{A.className=""}}if(C.getDate()==this.value.getDate()&&C.getMonth()==this.value.getMonth()&&D){n2i.addClass(A,"in2igui_datepicker_selected")}if(C.getDate()==this.today.getDate()&&C.getMonth()==this.today.getMonth()&&C.getFullYear()==this.today.getFullYear()){ni2.addClass(A,"in2igui_datepicker_today")}n2i.dom.setText(A,C.getDate())}},getPreviousMonth:function(){var A=new Date(this.viewDate.getTime());A.setMonth(A.getMonth()-1);return A},getNextMonth:function(){var A=new Date(this.viewDate.getTime());A.setMonth(A.getMonth()+1);return A},previous:function(){this.viewDate=this.getPreviousMonth();this.updateUI()},next:function(){this.viewDate=this.getNextMonth();this.updateUI()},selectCell:function(A){this.value=this.indexToDate(A);this.viewDate=new Date(this.value.getTime());this.viewDate.setDate(1);this.updateUI();In2iGui.callDelegates(this,"dateChanged",this.value)},indexToDate:function(C){var E=this.viewDate.getDay();var F=this.viewDate.getDaysInMonth();var D=this.getPreviousMonth().getDaysInMonth();if(C<E){var A=this.getPreviousMonth();A.setDate(D-E+C+1);return A}else{if(C>E+F-1){var A=this.getPreviousMonth();A.setDate(C-E-F+1);return A;cell.update(i-E-F+1)}else{var A=new Date(this.viewDate.getTime());A.setDate(C+1-E);return A}}}};Date.monthNames=["Januar","Februar","Marts","April","Maj","Juni","Juli","August","September","Oktober","November","December"];Date.dayNames=["Sndag","Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lrdag"];In2iGui.Layout=function(A){this.name=A.name;this.options=A||{};this.element=n2i.get(A.element);In2iGui.extend(this)};In2iGui.Layout.prototype={$$layout:function(){if(!n2i.browser.msie7&&!n2i.browser.msie8){return }if(this.diff===undefined){var F=n2i.firstByClass(this.element,"in2igui_layout_top");var H=n2i.firstByTag(F,"*").clientHeight;var E=n2i.firstByTag(n2i.firstByTag(this.element,"tfoot"),"td");var C=0;if(E){C=n2i.firstByTag(E,"*").clientHeight}H+=n2i.getTop(this.element);this.diff=C+H;if(this.element.parentNode!==document.body){this.diff+=15}else{}}var D=n2i.firstByTag(this.element,"tbody");var A=n2i.firstByTag(D,"td");A.style.height=(n2i.getViewPortHeight()-this.diff+5)+"px"}};In2iGui.Columns=function(A){this.name=A.name;this.options=A||{};this.element=n2i.get(A.element);this.body=n2i.firstByTag(this.element,"tr");In2iGui.extend(this)};In2iGui.Columns.create=function(A){A=A||{};A.element=n2i.build("table",{"class":"in2igui_columns",html:"<tbody><tr></tr></tbody>"});return new In2iGui.Columns(A)};In2iGui.Columns.prototype={addToColumn:function(A,C){var D=this.ensureColumn(A);D.appendChild(C.getElement())},setColumnStyle:function(A,C){var D=this.ensureColumn(A);n2i.setStyle(D,C)},setColumnWidth:function(A,C){var D=this.ensureColumn(A);D.style.width=C+"px"},ensureColumn:function(A){var D=n2i.getChildren(this.body);for(var C=D.length-1;C<A;C++){this.body.appendChild(n2i.build("td",{"class":"in2igui_columns_column"}))}return n2i.getChildren(this.body)[A]}};In2iGui.Dock=function(A){this.options=A;this.element=n2i.get(A.element);this.iframe=n2i.firstByTag(this.element,"iframe");this.name=A.name;In2iGui.extend(this);this.diff=-69;if(this.options.tabs){this.diff-=15}};In2iGui.Dock.prototype={setUrl:function(A){n2i.getFrameDocument(this.iframe).location.href=A},$$layout:function(){var A=n2i.getViewPortHeight();this.iframe.style.height=(A+this.diff)+"px"}};In2iGui.Box=function(A){this.options=n2i.override({},A);this.name=A.name;this.element=n2i.get(A.element);this.body=n2i.firstByClass(this.element,"in2igui_box_body");this.close=n2i.firstByClass(this.element,"in2igui_box_close");if(this.close){n2i.listen(this.close,"click",function(C){n2i.stop(C);this.hide();this.fire("boxWasClosed")}.bind(this))}In2iGui.extend(this)};In2iGui.Box.create=function(A){A=A||{};A.element=n2i.build("div",{"class":A.absolute?"in2igui_box in2igui_box_absolute":"in2igui_box",html:(A.closable?'<a class="in2igui_box_close" href="#"></a>':"")+'<div class="in2igui_box_top"><div><div></div></div></div><div class="in2igui_box_middle"><div class="in2igui_box_middle">'+(A.title?'<div class="in2igui_box_header"><strong class="in2igui_box_title">'+n2i.escape(A.title)+"</strong></div>":"")+'<div class="in2igui_box_body"'+(A.padding?' style="padding: '+A.padding+'px;"':"")+'></div></div></div><div class="in2igui_box_bottom"><div><div></div></div></div>',style:A.width?A.width+"px":null});return new In2iGui.Box(A)};In2iGui.Box.prototype={addToDocument:function(){document.body.appendChild(this.element)},add:function(A){if(A.getElement){this.body.appendChild(A.getElement())}else{this.body.appendChild(A)}},show:function(){var E=this.element;if(this.options.modal){var C=In2iGui.nextPanelIndex();E.style.zIndex=C+1;In2iGui.showCurtain({widget:this,zIndex:C})}if(this.options.absolute){n2i.setStyle(E,{display:"block",visibility:"hidden"});var A=E.clientWidth;var D=(n2i.getViewPortHeight()-E.clientHeight)/2+n2i.getScrollTop();n2i.setStyle(E,{"marginLeft":(A/-2)+"px",top:D+"px"});n2i.setStyle(E,{display:"block",visibility:"visible"})}else{E.style.display="block"}In2iGui.callVisible(this)},hide:function(){In2iGui.hideCurtain(this);this.element.style.display="none"},curtainWasClicked:function(){this.fire("boxCurtainWasClicked")}};In2iGui.Wizard=function(A){this.options=A||{};this.element=n2i.get(A.element);this.name=A.name;this.container=n2i.firstByClass(this.element,"in2igui_wizard_steps");this.steps=n2i.byClass(this.element,"in2igui_wizard_step");this.anchors=n2i.byClass(this.element,"in2igui_wizard_selection");this.selected=0;In2iGui.extend(this);this.addBehavior()};In2iGui.Wizard.prototype={addBehavior:function(){var A=this;n2i.each(this.anchors,function(D,C){n2i.listen(D,"mousedown",function(E){n2i.stop(E);A.goToStep(C)});n2i.listen(D,"click",function(E){n2i.stop(E)})})},goToStep:function(A){var C=this.container;C.style.height=C.clientHeight+"px";n2i.removeClass(this.anchors[this.selected],"in2igui_selected");this.steps[this.selected].style.display="none";n2i.addClass(this.anchors[A],"in2igui_selected");this.steps[A].style.display="block";this.selected=A;n2i.ani(C,"height",this.steps[A].clientHeight+"px",500,{ease:n2i.ease.slowFastSlow,onComplete:function(){C.style.height=""}});In2iGui.callVisible(this)},next:function(){if(this.selected<this.steps.length-1){this.goToStep(this.selected+1)}},previous:function(){if(this.selected>0){this.goToStep(this.selected-1)}}};In2iGui.Articles=function(A){this.options=A;this.name=A.name;this.element=n2i.get(A.element);if(A.source){A.source.listen(this)}};In2iGui.Articles.prototype={$articlesLoaded:function(J){this.element.innerHTML="";var I=J.getElementsByTagName("article");for(var D=0;D<I.length;D++){var E=n2i.build("div",{"class":"in2igui_article"});var F=I[D].childNodes;for(var C=0;C<F.length;C++){if(n2i.dom.isElement(F[C],"title")){var H=n2i.dom.getText(F[C]);E.appendChild(n2i.build("h2",{text:H}))}else{if(n2i.dom.isElement(F[C],"paragraph")){var K=n2i.dom.getText(F[C]);var A=n2i.build("p",{text:K});if(F[C].getAttribute("dimmed")==="true"){A.className="in2igui_dimmed"}E.appendChild(A)}}}this.element.appendChild(E)}},$sourceFailed:function(){this.element.innerHTML="<div>Failed!</div>"},$sourceIsBusy:function(){this.element.innerHTML='<div class="in2igui_articles_loading">Loading...</div>'},$sourceIsNotBusy:function(){n2i.removeClass(this.element,"in2igui_list_busy")}};In2iGui.TextField=function(A){this.options=n2i.override({placeholderElement:null,validator:null},A);var C=this.element=n2i.get(A.element);this.element.setAttribute("autocomplete","off");this.value=this.validate(this.element.value);this.isPassword=this.element.type=="password";this.name=A.name;In2iGui.extend(this);this.addBehavior();if(this.options.placeholderElement&&this.value!=""){In2iGui.fadeOut(this.options.placeholderElement,0)}this.checkPlaceholder();try{if(C==document.activeElement){this.focused()}}catch(C){}};In2iGui.TextField.prototype={addBehavior:function(){var C=this.element;n2i.listen(C,"keyup",this.keyDidStrike.bind(this));var A=this.options.placeholderElement;n2i.listen(C,"blur",this.onBlur.bind(this));if(A){n2i.listen(C,"focus",this.focused.bind(this));n2i.listen(C,"blur",this.checkPlaceholder.bind(this));if(A){A.style.cursor="text";n2i.listen(A,"mousedown",this.focus.bind(this));n2i.listen(A,"click",this.focus.bind(this))}}},focused:function(){var C=this.element,A=this.options.placeholderElement;if(A&&C.value==""){In2iGui.fadeOut(A,0)}},validate:function(D){var C=this.options.validator,A;if(C){A=C.validate(D);n2i.setClass(this.element,"in2igui_invalid",!A.valid);return A.value}return D},checkPlaceholder:function(){if(this.options.placeholderElement&&this.value==""){In2iGui.fadeIn(this.options.placeholderElement,200)}if(this.isPassword&&!n2i.browser.msie){this.element.type="password"}},keyDidStrike:function(){if(this.value!==this.element.value){var A=this.validate(this.element.value);var C=A!==this.value;this.value=A;if(C){this.fire("valueChanged",this.value)}}},onBlur:function(){n2i.removeClass(this.element,"in2igui_invalid");this.element.value=this.value||""},getValue:function(){return this.value},setValue:function(A){if(A===undefined||A===null){A=""}this.element.value=A;this.value=this.validate(A)},isEmpty:function(){return this.value==""},isBlank:function(){return this.value.strip()==""},focus:function(){this.element.focus()},setError:function(A){var C=A?true:false;n2i.setClass(this.element,"in2igui_field_error",C);if(typeof (A)=="string"){In2iGui.showToolTip({text:A,element:this.element,key:this.name})}if(!C){In2iGui.hideToolTip({key:this.name})}}};In2iGui.InfoView=function(A){this.options=n2i.override({clickObjects:false},A);this.element=n2i.get(A.element);this.body=this.element.select("tbody")[0];this.name=A.name;In2iGui.extend(this)};In2iGui.InfoView.create=function(A){A=A||{};var C=A.element=n2i.build("div",{"class":"in2igui_infoview",html:"<table><tbody></tbody></table>"});if(A.height){ni2.setStyle(C,{height:A.height+"px","overflow":"auto","overflowX":"hidden"})}if(A.margin){C.style.margin=A.margin+"px"}return new In2iGui.InfoView(A)};In2iGui.InfoView.prototype={addHeader:function(C){var A=n2i.build("tr",{parent:this.body});n2i.build("th",{"class":"in2igui_infoview_header",colspan:"2",text:C,parent:A})},addProperty:function(A,D){var C=n2i.build("tr",{parent:this.body});n2i.build("th",{parent:C,text:A});n2i.build("td",{parent:C,text:D})},addObjects:function(C,E){if(!E||E.length==0){return }var F=n2i.build("tr",{parent:this.body});F.appendChild(n2i.build("th",{text:C}));var A=n2i.build("td",{parent:F});var D=this.options.clickObjects;n2i.each(E,function(I){var H=n2i.build("div",{text:I.title,parent:A});if(D){n2i.addClass(H,"in2igui_infoview_click");n2i.listen(H,"click",function(){In2iGui.callDelegates(this,"objectWasClicked",I)})}})},setBusy:function(A){n2i.setClass(this,element,"in2igui_infoview_busy",A)},clear:function(){n2i.dom.clear(this.body)},update:function(C){this.clear();for(var A=0;A<C.length;A++){switch(C[A].type){case"header":this.addHeader(C[A].value);break;case"property":this.addProperty(C[A].label,C[A].value);break;case"objects":this.addObjects(C[A].label,C[A].value);break}}}};In2iGui.Overflow=function(A){this.options=A;this.element=n2i.get(A.element);this.name=A.name;In2iGui.extend(this)};In2iGui.Overflow.create=function(A){A=A||{};var C=A.element=n2i.build("div",{"class":"in2igui_overflow"});if(A.height){C.style.height=A.height+"px"}return new In2iGui.Overflow(A)};In2iGui.Overflow.prototype={calculate:function(){var H,C,E,A;A=n2i.getViewPortHeight();E=this.element.parentNode;H=n2i.getTop(this.element);C=n2i.getTop(E)+E.clientHeight;var F=n2i.getAllNext(this.element);for(var D=0;D<F.length;D++){C-=F[D].clientHeight}this.diff=-1*(H+(A-C));if(n2i.browser.webkit){this.diff++}},add:function(A){if(A.getElement){this.element.appendChild(A.getElement())}else{this.element.appendChild(A)}return this},$$layout:function(){if(!this.options.dynamic){if(this.options.vertical){var A=n2i.getViewPortHeight();this.element.style.height=Math.max(0,A-this.options.vertical)+"px"}return }if(this.diff===undefined){this.calculate()}var A=n2i.getViewPortHeight();this.element.style.height=Math.max(0,A+this.diff)+"px"}};In2iGui.SearchField=function(A){this.options=n2i.override({expandedWidth:null},A);this.element=n2i.get(A.element);this.name=A.name;this.field=n2i.firstByTag(this.element,"input");this.value=this.field.value;this.adaptive=n2i.hasClass(this.element,"in2igui_searchfield_adaptive");In2iGui.onDomReady(function(){this.initialWidth=parseInt(n2i.getStyle(this.element,"width"))}.bind(this));In2iGui.extend(this);this.addBehavior();this.updateClass()};In2iGui.SearchField.create=function(A){A=A||{};A.element=n2i.build("span",{"class":A.adaptive?"in2igui_searchfield in2igui_searchfield_adaptive":"in2igui_searchfield",html:'<em class="in2igui_searchfield_placeholder"></em><a href="javascript:void(0);" class="in2igui_searchfield_reset"></a><span><span><input type="text"/></span></span>'});return new In2iGui.SearchField(A)};In2iGui.SearchField.prototype={addBehavior:function(){var C=this;n2i.listen(this.field,"keyup",this.onKeyUp.bind(this));var D=n2i.firstByTag(this.element,"a");D.tabIndex=-1;var A=function(){C.field.focus();C.field.select()};n2i.listen(this.element,"mousedown",A);n2i.listen(this.element,"mouseup",A);n2i.listen(D,"mousedown",function(E){n2i.stop(E);C.reset();A()});n2i.listen(n2i.firstByTag(this.element,"em"),"mousedown",A);n2i.listen(this.field,"focus",function(){C.focused=true;C.updateClass()});n2i.listen(this.field,"blur",function(){C.focused=false;C.updateClass()});if(this.options.expandedWidth>0){this.field.onfocus=function(){n2i.ani(C.element,"width",C.options.expandedWidth+"px",500,{ease:n2i.ease.slowFastSlow})};this.field.onblur=function(){n2i.ani(C.element,"width",C.initialWidth+"px",500,{ease:n2i.ease.slowFastSlow,delay:100})}}},onKeyUp:function(A){this.fieldChanged();if(A.keyCode===Event.KEY_RETURN){this.fire("submit")}},setValue:function(A){this.field.value=A===undefined||A===null?"":A;this.fieldChanged()},getValue:function(){return this.field.value},isEmpty:function(){return this.field.value==""},isBlank:function(){return this.field.value.strip()==""},reset:function(){this.field.value="";this.fieldChanged()},updateClass:function(){var A="in2igui_searchfield";if(this.adaptive){A+=" in2igui_searchfield_adaptive"}if(this.focused&&this.value!=""){A+=" in2igui_searchfield_focus_dirty"}else{if(this.focused){A+=" in2igui_searchfield_focus"}else{if(this.value!=""){A+=" in2igui_searchfield_dirty"}}}this.element.className=A},fieldChanged:function(){if(this.field.value!=this.value){this.value=this.field.value;this.updateClass();this.fire("valueChanged",this.value);In2iGui.firePropertyChange(this,"value",this.value)}}};In2iGui.Fragment=function(A){this.options=A;this.element=n2i.get(A.element);this.name=A.name;In2iGui.extend(this)};In2iGui.Fragment.prototype={show:function(){this.element.style.display="block"},hide:function(){this.element.style.display="none"}};In2iGui.LocationPicker=function(A){A=A||{};this.name=A.name;this.options=A.options||{};this.element=n2i.get(A.element);this.defaultCenter=new google.maps.LatLng(57.0465,9.9185);In2iGui.extend(this)};In2iGui.LocationPicker.prototype={show:function(D){if(!this.panel){var A=this.panel=In2iGui.BoundPanel.create({width:300});var I=n2i.build("div",{style:"width:300px;height:300px"});A.add(I);var H=In2iGui.Buttons.create({align:"right",top:5});var E=In2iGui.Button.create({text:"Luk"});E.listen({$click:function(){A.hide()}});A.add(H.add(E));n2i.setStyle(A.element,{left:"-10000px",top:"-10000px",display:""});var F=this.buildLatLng();var C={zoom:15,mapTypeId:google.maps.MapTypeId.TERRAIN};this.map=new google.maps.Map(I,C);google.maps.event.addListener(this.map,"click",function(J){var K={latitude:J.latLng.lat(),longitude:J.latLng.lng()};this.setLocation(K);this.fire("locationChanged",K)}.bind(this));A.element.style.display="none"}this.setLocation(D.location);if(D.node){this.panel.position(D.node)}this.panel.show()},setLocation:function(A){if(!A&&this.marker){this.marker.setMap(null);this.map.setCenter(this.defaultCenter);return }A=this.buildLatLng(A);if(!this.marker){this.marker=new google.maps.Marker({position:A,map:this.map})}else{this.marker.setPosition(A);this.marker.setMap(this.map)}this.map.setCenter(A)},buildLatLng:function(A){if(!A){A={latitude:57.0465,longitude:9.9185}}return new google.maps.LatLng(A.latitude,A.longitude)}};In2iGui.Bar=function(A){this.options=n2i.override({},A);this.name=A.name;this.element=n2i.get(A.element);In2iGui.extend(this)};In2iGui.Bar.create=function(C){C=C||{};var A="in2igui_bar";if(C.variant){A+=" in2igui_bar_"+C.variant}if(C.absolute){A+=" in2igui_bar_absolute"}C.element=n2i.build("div",{"class":A});n2i.build("div",{"class":"in2igui_bar_body",parent:C.element});return new In2iGui.Bar(C)};In2iGui.Bar.prototype={addToDocument:function(){document.body.appendChild(this.element)},add:function(C){var A=n2i.firstByClass(this.element,"in2igui_bar_body");A.appendChild(C.getElement())},placeAbove:function(A){n2i.place({source:{element:this.element,vertical:1,horizontal:0},target:{element:A.getElement(),vertical:0,horizontal:0}});this.element.style.zIndex=In2iGui.nextTopIndex()},show:function(){this.element.style.visibility="visible"},hide:function(){this.element.style.visibility="hidden"}};In2iGui.Bar.Button=function(A){this.options=n2i.override({},A);this.name=A.name;this.element=n2i.get(A.element);n2i.listen(this.element,"click",this.onClick.bind(this));if(this.options.stopEvents){n2i.listen(this.element,"mousedown",function(C){n2i.stop(C)})}In2iGui.extend(this)};In2iGui.Bar.Button.create=function(A){A=A||{};var C=A.element=n2i.build("a",{"class":"in2igui_bar_button"});if(A.icon){C.appendChild(In2iGui.createIcon(A.icon,1))}return new In2iGui.Bar.Button(A)};In2iGui.Bar.Button.prototype={onClick:function(A){this.fire("click");if(this.options.stopEvents){n2i.stop(A)}},setSelected:function(A){n2i.setClass(this.element,"in2igui_bar_button_selected",A)}};In2iGui.IFrame=function(A){this.options=A;this.element=n2i.get(A.element);this.name=A.name;In2iGui.extend(this)};In2iGui.IFrame.prototype={setUrl:function(A){this.element.setAttribute("src",A)},getDocument:function(){return n2i.getFrameDocument(this.element)},getWindow:function(){return n2i.getFrameWindow(this.element)},reload:function(){this.getWindow().location.reload()}};In2iGui.VideoPlayer=function(A){this.options=A;this.element=n2i.get(A.element);this.placeholder=n2i.firstByClass(this.element,"div");this.name=A.name;this.state={duration:0,time:0,loaded:0};this.handlers=[In2iGui.VideoPlayer.HTML5,In2iGui.VideoPlayer.QuickTime,In2iGui.VideoPlayer.Embedded];this.handler=null;In2iGui.extend(this);if(this.options.video){if(this.placeholder){n2i.listen(this.placeholder,"click",function(){this.setVideo(this.options.video)}.bind(this))}else{In2iGui.onReady(function(){this.setVideo(this.options.video)}.bind(this))}}};In2iGui.VideoPlayer.prototype={setVideo:function(A){this.handler=this.getHandler(A);this.element.appendChild(this.handler.element);if(this.handler.showController()){this.buildController()}},getHandler:function(D){for(var A=0;A<this.handlers.length;A++){var C=this.handlers[A];if(C.isSupported(D)){return new C(D,this)}}},buildController:function(){var A=n2i.build("div",{"class":"in2igui_videoplayer_controller",parent:this.element});this.playButton=n2i.build("a",{href:"javascript:void(0);","class":"in2igui_videoplayer_playpause",text:"wait!",parent:A});n2i.listen(this.playButton,"click",this.playPause.bind(this));this.status=n2i.build("span",{"class":"in2igui_videoplayer_status",parent:A})},onCanPlay:function(){this.playButton.update("Play")},onLoad:function(){this.state.loaded=this.state.duration;this.updateStatus()},onDurationChange:function(A){this.state.duration=A;this.updateStatus()},onTimeChange:function(A){this.state.time=A;this.updateStatus()},onLoadProgressChange:function(A){this.state.loaded=A;this.updateStatus()},playPause:function(){if(this.handler.isPlaying()){this.pause()}else{this.play()}},play:function(){this.handler.play()},pause:function(){this.handler.pause()},updateStatus:function(){this.status.innerHTML=this.state.time+" / "+this.state.duration+" / "+this.state.loaded}};In2iGui.VideoPlayer.HTML5=function(C,A){var D=this.element=n2i.build("video",{width:C.width,height:C.height,src:C.src});n2i.listen(D,"load",A.onLoad.bind(A));n2i.listen(D,"canplay",A.onCanPlay.bind(A));n2i.listen(D,"durationchange",function(E){A.onDurationChange(D.duration)});n2i.listen(D,"timeupdate",function(){A.onTimeChange(this.element.currentTime)}.bind(this))};In2iGui.VideoPlayer.HTML5.isSupported=function(A){if(n2i.browser.webkitVersion>528&&(A.type==="video/quicktime"||A.type==="video/mp4")){return true}return false};In2iGui.VideoPlayer.HTML5.prototype={showController:function(){return true},pause:function(){this.element.pause()},play:function(){this.element.play()},getTime:function(){return this.element.currentTime},isPlaying:function(){return !this.element.paused}};In2iGui.VideoPlayer.QuickTime=function(C,A){this.player=A;var D=this.element=n2i.build("object",{width:C.width,height:C.height,data:C.src,type:"video/quicktime"});D.innerHTML='<param value="false" name="controller"/><param value="true" name="enablejavascript"/><param value="undefined" name="posterframe"/><param value="false" name="showlogo"/><param value="false" name="autostart"/><param value="true" name="cache"/><param value="white" name="bgcolor"/><param value="false" name="aggressivecleanup"/><param value="true" name="saveembedtags"/><param value="true" name="postdomevents"/>';n2i.listen(D,"qt_canplay",A.onCanPlay.bind(A));n2i.listen(D,"qt_load",A.onLoad.bind(A));n2i.listen(D,"qt_progress",function(){A.onLoadProgressChange(D.GetMaxTimeLoaded()/3000)});n2i.listen(D,"qt_durationchange",function(E){A.onDurationChange(D.GetDuration()/3000)});n2i.listen(D,"qt_timechanged",function(){A.onTimeChange(D.GetTime())})};In2iGui.VideoPlayer.QuickTime.isSupported=function(A){return A.html==undefined};In2iGui.VideoPlayer.QuickTime.prototype={showController:function(){return true},pause:function(){window.clearInterval(this.observer);this.element.Stop()},play:function(){this.element.Play();this.observer=window.setInterval(this.observeVideo.bind(this),100)},observeVideo:function(){this.player.onTimeChange(this.element.GetTime()/3000)},getTime:function(){return this.element.GetTime()},isPlaying:function(){return this.element.GetRate()!==0}};In2iGui.VideoPlayer.Embedded=function(C,A){var D=this.element=n2i.build("div",{width:C.width,height:C.height,html:C.html})};In2iGui.VideoPlayer.Embedded.isSupported=function(A){return A.html!==undefined};In2iGui.VideoPlayer.Embedded.prototype={showController:function(){return false},pause:function(){},play:function(){},getTime:function(){},isPlaying:function(){}};In2iGui.Segmented=function(A){this.options=n2i.override({value:null,allowNull:false},A);this.element=n2i.get(A.element);this.name=A.name;this.value=this.options.value;In2iGui.extend(this);n2i.listen(this.element,"mousedown",this.onClick.bind(this))};In2iGui.Segmented.prototype={onClick:function(F){F=new n2i.Event(F);var C=F.findByTag("a");if(C){var H=false;var E=C.getAttribute("rel");var A=n2i.byClass(this.element,"in2igui_segmented_selected");for(var D=0;D<A.length;D++){n2i.removeClass(A[D],"in2igui_segmented_selected")}if(E===this.value&&this.options.allowNull){H=true;this.value=null;this.fire("valueChanged",this.value)}else{n2i.addClass(C,"in2igui_segmented_selected");H=this.value!==E;this.value=E}if(H){this.fire("valueChanged",this.value)}}},setValue:function(D){if(D===undefined){D=null}var A=this.element.getElementsByTagName("a");this.value=null;for(var C=0;C<A.length;C++){if(A[C].getAttribute("rel")===D){n2i.addClass(A[C],"in2igui_segmented_selected");this.value=D}else{n2i.removeClass(A[C],"in2igui_segmented_selected")}}},getValue:function(){return this.value}};In2iGui.Flash={fullVersion:undefined,getMajorVersion:function(){var C=this.getFullVersion();if(C===null||C===undefined){return null}var A=(C+"").match(/[0-9]+/gi);return A.length>0?parseInt(A[0]):null},getFullVersion:function(){if(this.fullVersion!==undefined){return this.fullVersion}var I=null;if(navigator.plugins!=null&&navigator.plugins.length>0){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var H=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"";var A=navigator.plugins["Shockwave Flash"+H].description;var F=A.split(" ");var D=F[2].split(".");var J=D[0];var C=D[1];var E=F[3];if(E==""){E=F[4]}if(E[0]=="d"){E=E.substring(1)}else{if(E[0]=="r"){E=E.substring(1);if(E.indexOf("d")>0){E=E.substring(0,E.indexOf("d"))}}}var I=J+"."+C+"."+E}}else{if(navigator.userAgent.toLowerCase().indexOf("webtv/2.6")!=-1){I=4}else{if(navigator.userAgent.toLowerCase().indexOf("webtv/2.5")!=-1){I=3}else{if(navigator.userAgent.toLowerCase().indexOf("webtv")!=-1){I=2}else{if(n2i.browser.msie){I=this.getActiveXVersion()}}}}}this.fullVersion=I;return I},getActiveXVersion:function(){var A;var C;var D;try{C=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");A=C.GetVariable("$version")}catch(D){}if(!A){try{C=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");A="WIN 6,0,21,0";C.AllowScriptAccess="always";A=C.GetVariable("$version")}catch(D){}}if(!A){try{C=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");A=C.GetVariable("$version")}catch(D){}}if(!A){try{C=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");A="WIN 3,0,18,0"}catch(D){}}if(!A){try{C=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");A="WIN 2,0,0,11"}catch(D){A=-1}}return A}};In2iGui.Link=function(A){this.options=A;this.name=A.name;this.element=n2i.get(A.element);In2iGui.extend(this);this.addBehavior()};In2iGui.Link.prototype={addBehavior:function(){var A=this;n2i.listen(this.element,"click",function(C){n2i.stop(C);window.setTimeout(function(){A.fire("click")})})}};In2iGui.Links=function(A){this.options=A;this.element=n2i.get(A.element);this.name=A.name;In2iGui.extend(this);this.items=[];this.addBehavior();this.selectedIndex=null;this.inputs={}};In2iGui.Links.prototype={addBehavior:function(){n2i.listen(this.element,"click",this.onClick.bind(this));n2i.listen(this.element,"dblclick",this.onDblClick.bind(this))},reset:function(){this.setValue([])},setValue:function(A){this.items=A;this.selectedIndex=null;this.build()},getValue:function(){return this.items},onDblClick:function(E){E=new n2i.Event(E);n2i.selection.clear();E.stop(E);var C=this.selectAndGetRow(E);var A={text:C.text};A[C.kind]=C.value;this.editedLink=C;var D=this.getEditWindow();this.editForm.reset();this.editForm.setValues(A);D.show()},onClick:function(C){C=new n2i.Event(C);C.stop();var A=C.getElement();if(n2i.hasClass(A,"in2igui_links_remove")){var D=C.findByClass("in2igui_links_row");In2iGui.confirmOverlay({element:A,text:"Vil du fjerne linket?",okText:"Ja, fjern",cancelText:"Annuller",onOk:function(){this.items.splice(D.in2igui_index,1);if(this.selectedIndex===D.in2igui_index){this.selectedIndex=null}this.build()}.bind(this)})}else{this.selectAndGetRow(C)}},selectAndGetRow:function(D){var E=D.findByClass("in2igui_links_row");if(E){var C=E.in2igui_index;if(this.selectedIndex!==null){var A=n2i.byClass(this.element,"in2igui_links_row")[this.selectedIndex];n2i.removeClass(A,"in2igui_links_row_selected")}this.selectedIndex=C;n2i.addClass(E,"in2igui_links_row_selected");return this.items[C]}},build:function(){var F=this.list||n2i.firstByClass(this.element,"in2igui_links_list");F.innerHTML="";for(var C=0;C<this.items.length;C++){var E=this.items[C];var I=n2i.build("div",{"class":"in2igui_links_row"});I.in2igui_index=C;I.appendChild(In2iGui.createIcon(E.icon,1));var H=n2i.build("div",{"class":"in2igui_links_text",text:E.text});I.appendChild(H);var D=n2i.build("div",{"class":"in2igui_links_info",text:n2i.wrap(E.info)});I.appendChild(D);var A=In2iGui.createIcon("monochrome/round_x",1);n2i.addClass(A,"in2igui_links_remove");I.appendChild(A);F.appendChild(I)}},addLink:function(){this.editedLink=null;this.getEditWindow().show();this.editForm.reset();this.editForm.focus()},getEditWindow:function(){if(!this.editWindow){var I=this.editWindow=In2iGui.Window.create({title:"Link",width:300,padding:5});var H=this.editForm=In2iGui.Formula.create();var F=H.buildGroup({above:false},[{type:"Text",options:{label:"Tekst",key:"text"}}]);var E=In2iGui.Formula.Text.create({label:"URL",key:"url"});F.add(E);this.inputs["url"]=E;var D=In2iGui.Formula.Text.create({label:"E-mail",key:"email"});F.add(D);this.inputs["email"]=D;page=In2iGui.Formula.DropDown.create({label:"Side",key:"page",source:this.options.pageSource});F.add(page);this.inputs["page"]=page;file=In2iGui.Formula.DropDown.create({label:"Fil",key:"file",source:this.options.fileSource});F.add(file);this.inputs["file"]=file;var C=this;n2i.each(this.inputs,function(J,K){K.listen({$valueChanged:function(){C.changeType(J)}})});var A=F.createButtons().add(In2iGui.Button.create({text:"Gem",submit:true,highlighted:true}));this.editForm.listen({$submit:this.saveLink.bind(this)});I.add(H);if(this.options.pageSource){this.options.pageSource.refresh()}if(this.options.fileSource){this.options.fileSource.refresh()}}return this.editWindow},saveLink:function(){var A=this.editForm.getValues();var C=this.valuesToLink(A);var D=this.editedLink;if(D){n2i.override(D,C)}else{this.items.push(C)}this.build();this.editForm.reset();this.editWindow.hide();this.editedLink=null},valuesToLink:function(A){var C={};C.text=A.text;if(A.email!=""){C.kind="email";C.value=A.email;C.info=A.email;C.icon="monochrome/email"}else{if(A.url!=""){C.kind="url";C.value=A.url;C.info=A.url;C.icon="monochrome/globe"}else{if(n2i.isDefined(A.page)){C.kind="page";C.value=A.page;C.info=this.inputs["page"].getItem().title;C.icon="common/page"}else{if(n2i.isDefined(A.file)){C.kind="file";C.value=A.file;C.info=this.inputs["file"].getItem().title;C.icon="monochrome/file"}}}}return C},changeType:function(A){n2i.each(this.inputs,function(C,D){if(C!=A){D.setValue()}})}};In2iGui.MarkupEditor=function(A){this.name=A.name;this.options=n2i.override({debug:false,value:"",autoHideToolbar:true,style:"font-family: sans-serif; font-size: 11px;"},A);if(A.replace){A.replace=n2i.get(A.replace);A.element=n2i.build("div",{className:"in2igui_markupeditor"});A.replace.parentNode.insertBefore(A.element,A.replace);A.replace.style.display="none";A.value=A.replace.innerHTML}this.element=n2i.get(A.element);this.impl=In2iGui.MarkupEditor.webkit;this.impl.initialize({element:this.element,controller:this});if(A.value){this.impl.setHTML(A.value)}In2iGui.extend(this);this.addBehavior()};In2iGui.MarkupEditor.create=function(A){A=A||{};A.element=n2i.build("div",{className:"in2igui_markupeditor"});return new In2iGui.MarkupEditor(A)};In2iGui.MarkupEditor.prototype={addBehavior:function(){},getValue:function(){return this.impl.getHTML()},setValue:function(A){this.impl.setHTML(A)},focus:function(){this.impl.focus()},focused:function(){this.showBar()},blurred:function(){this.bar.hide();this.fire("blur")},showBar:function(){if(!this.bar){var A=[{key:"bold",icon:"edit/text_bold"},{key:"italic",icon:"edit/text_italic"},{key:"color",icon:"common/color"},{key:"addLink",icon:"common/link"},{key:"align",value:"left",icon:"edit/text_align_left"},{key:"align",value:"center",icon:"edit/text_align_center"},{key:"align",value:"right",icon:"edit/text_align_right"},{key:"align",value:"justify",icon:"edit/text_align_justify"},{key:"clear",icon:"monochrome/round_x"},{key:"strong",icon:"edit/text_bold"}];this.bar=In2iGui.Bar.create({absolute:true,variant:"mini",small:true});n2i.each(A,function(D){var C=new In2iGui.Bar.Button.create({icon:D.icon,stopEvents:true});C.listen({$click:function(){this._buttonClicked(D)}.bind(this)});this.bar.add(C)}.bind(this));this.bar.addToDocument()}this.bar.placeAbove(this);this.bar.show()},_buttonClicked:function(A){if(A.key=="color"){this._showColorPicker()}else{if(A.key=="addLink"){this._showLinkEditor()}else{if(A.key=="align"){this.impl.align(A.value)}else{if(A.key=="clear"){this.impl.removeFormat()}else{this.impl.format(A)}}}}this._valueChanged()},_showColorPicker:function(){if(!this.colorPicker){this.colorPicker=In2iGui.Window.create();var A=In2iGui.ColorPicker.create();A.listen(this);this.colorPicker.add(A)}this.colorPicker.show({avoid:this.element})},_showLinkEditor:function(){if(!this.linkEditor){this.linkEditor=In2iGui.Window.create({padding:5,width:300});this.linkForm=In2iGui.Formula.create();this.linkEditor.add(this.linkForm);var D=this.linkForm.buildGroup({},[{type:"Text",options:{key:"url",label:"Address:"}}]);this.linkEditor.add(this.linkForm);var C=D.createButtons();var A=In2iGui.Button.create({text:"OK",submit:true});this.linkForm.listen({$submit:this._updateLink.bind(this)});C.add(A)}this.temporaryLink=this.impl.getOrCreateLink();this.linkForm.setValues({url:this.temporaryLink.href});this.linkEditor.show({avoid:this.element});this.linkForm.focus()},_updateLink:function(){var A=this.linkForm.getValues();this.temporaryLink.href=A.url;this.linkForm.reset();this.temporaryLink=null;this.linkEditor.hide();this._valueChanged()},$colorWasSelected:function(A){this.impl.colorize(A);this._valueChanged()},_valueChanged:function(){this.fire("valueChanged",this.impl.getHTML())}};In2iGui.MarkupEditor.webkit={initialize:function(A){this.element=A.element;this.element.style.overflow="auto";this.element.contentEditable=true;var C=this.controller=A.controller;n2i.listen(this.element,"focus",function(){C.focused()});n2i.listen(this.element,"blur",function(){C.blurred()});n2i.listen(this.element,"keyup",this._keyUp.bind(this))},focus:function(){this.element.focus()},format:function(A){if(A.key=="strong"||A.key=="em"){this._wrapInTag(A.key)}else{if(A.key=="insert-table"){this._insertHTML("<table><tbody><tr><td>Lorem ipsum dolor</td><td>Lorem ipsum dolor</td></tr></tbody></table>")}else{document.execCommand(A.key,null,A.value)}}},getOrCreateLink:function(){var A=this._getSelectedNode();if(A&&A.tagName.toLowerCase()=="a"){return A}document.execCommand("createLink",null,"#");return this._getSelectedNode()},_getSelectedNode:function(){var D=window.getSelection();var A=D.getRangeAt(0);var C=A.commonAncestorContainer;if(!n2i.dom.isElement(C)){C=C.parentNode}return C},colorize:function(A){n2i.log(A);document.execCommand("forecolor",null,A)},align:function(C){var A={center:"justifycenter",justify:"justifyfull",left:"justifyleft",right:"justifyright"};document.execCommand(A[C],null,null)},_keyUp:function(){this.controller._valueChanged();this._selectionChanged()},_wrapInTag:function(A){var E=window.getSelection();if(E.rangeCount<1){return }var C=E.getRangeAt(0);var D=C.commonAncestorContainer;if(!n2i.dom.isElement(D)){D=D.parentNode}if(D.tagName.toLowerCase()==A){this._unWrap(D)}else{var F=document.createElement(A);C.surroundContents(F);E.selectAllChildren(F)}},_getInlineTag:function(){var C=window.getSelection();if(C.rangeCount<1){return }var A=C.getRangeAt(0)},_unWrap:function(C){var D=C.childNodes;for(var A=0;A<D.length;A++){C.parentNode.insertBefore(D[A],C)}C.parentNode.removeChild(C)},_insertHTML:function(A){document.execCommand("inserthtml",null,A)},_selectionChanged:function(){var A=this._getSelectedNode();if(A){n2i.log(n2i.getStyle(A,"font-weight"))}},removeFormat:function(){document.execCommand("removeFormat",null,null)},setHTML:function(A){this.element.innerHTML=A},getHTML:function(){var A=In2iGui.MarkupEditor.util.clean(this.element);return A.innerHTML}};In2iGui.MarkupEditor.iframe={initialize:function(A){this.element=A.element;this.iframe=n2i.build("iframe",{style:"display:block; width: 100%; border: 0;"});this.element.contentEditable=true;var C=this.controller=A.controller;n2i.listen(this.element,"focus",function(){C.focused()});n2i.listen(this.element,"blur",function(){C.blurred()})},focus:function(){this.element.focus()},format:function(A){if(A.key=="strong"||A.key=="em"){this._wrapInTag(A.key)}else{if(A.key=="insert-table"){this._insertHTML("<table><tbody><tr><td>Lorem ipsum dolor</td><td>Lorem ipsum dolor</td></tr></tbody></table>")}else{document.execCommand(A.key,null,null)}}},_wrapInTag:function(A){document.execCommand("inserthtml",null,"<"+A+">"+n2i.escape(n2i.getSelectedText())+"</"+A+">")},_insertHTML:function(A){document.execCommand("inserthtml",null,A)},setHTML:function(A){this.element.innerHTML=A},getHTML:function(){}};In2iGui.MarkupEditor.util={clean:function(D){n2i.log(D.innerHTML);var E=D.cloneNode(true);this.replaceNodes(E,{b:"strong",i:"em",font:"span"});var C=n2i.byClass(E,"Apple-style-span");for(var A=C.length-1;A>=0;A--){C[A].removeAttribute("class")}return E},replaceNodes:function(F,H){for(key in H){var C=F.getElementsByTagName(key);for(var D=C.length-1;D>=0;D--){var E=document.createElement(H[key]);var A=C[D].getAttribute("color");if(A){E.style.color=A}n2i.dom.replaceNode(C[D],E)}}}};In2iGui.ColorPicker=function(A){this.options=A||{};this.name=A.name;this.element=n2i.get(A.element);this.color=null;this.buttons=[];this.preview=n2i.firstByClass(this.element,"in2igui_colorpicker_preview");this.pages=n2i.byClass(this.element,"in2igui_colorpicker_page");this.input=n2i.firstByTag(this.element,"input");this.wheel1=this.pages[0];this.wheel2=this.pages[1];this.wheel3=this.pages[2];this.swatches=this.pages[3];In2iGui.extend(this);this.addBehavior();this.buildData()};In2iGui.ColorPicker.create=function(D){var A="";for(var E=0;E<360;E+=30){for(var C=0.05;C<=1;C+=0.15){var H=n2i.Color.hsv2rgb(E,C,1);var F=n2i.Color.rgb2hex(H);A+='<a style="background: rgb('+H[0]+","+H[1]+","+H[2]+')" rel="'+F+'"></a>'}for(var C=1;C>=0.2;C-=0.15){var H=n2i.Color.hsv2rgb(E,1,C);var F=n2i.Color.rgb2hex(H);A+='<a style="background: rgb('+H[0]+","+H[1]+","+H[2]+')" rel="'+F+'"></a>'}}for(var C=255;C>=0;C-=255/12){var F=n2i.Color.rgb2hex([C,C,C]);A+='<a style="background: rgb('+Math.round(C)+","+Math.round(C)+","+Math.round(C)+')" rel="'+F+'"></a>'}D=D||{};D.element=n2i.build("div",{"class":"in2igui_colorpicker",html:'<div class="in2igui_bar in2igui_bar_window"><div class="in2igui_bar_body"><a class="in2igui_bar_button in2igui_bar_button_selected" href="javascript:void(0)" rel="0"><span class="in2igui_icon_1" style="background: url('+In2iGui.getIconUrl("colorpicker/wheel_pastels",1)+')"></span></a><a class="in2igui_bar_button" href="javascript:void(0)" rel="1"><span class="in2igui_icon_1" style="background: url('+In2iGui.getIconUrl("colorpicker/wheel_brightness",1)+')"></span></a><a class="in2igui_bar_button" href="javascript:void(0)" rel="2"><span class="in2igui_icon_1" style="background: url('+In2iGui.getIconUrl("colorpicker/wheel_saturated",1)+')"></span></a><a class="in2igui_bar_button" href="javascript:void(0)" rel="3"><span class="in2igui_icon_1" style="background: url('+In2iGui.getIconUrl("colorpicker/swatches",1)+')"></span></a><input class="in2igui_colorpicker"/></div></div><div class="in2igui_colorpicker_pages"><div class="in2igui_colorpicker_page in2igui_colorpicker_wheel1"></div><div class="in2igui_colorpicker_page in2igui_colorpicker_wheel2"></div><div class="in2igui_colorpicker_page in2igui_colorpicker_wheel3"></div><div class="in2igui_colorpicker_page in2igui_colorpicker_swatches">'+A+'</div></div><div class="in2igui_colorpicker_preview"></div>'});return new In2iGui.ColorPicker(D)};In2iGui.ColorPicker.prototype={addBehavior:function(){var A=n2i.byClass(this.element,"in2igui_bar_button");for(var D=0;D<A.length;D++){var C=new In2iGui.Bar.Button({element:A[D]});C.listen(this);this.buttons.push(C)}n2i.listen(this.element,"click",this._click.bind(this));n2i.listen(this.wheel1,"mousemove",this._hoverWheel1.bind(this));n2i.listen(this.wheel1,"click",this._pickColor.bind(this));n2i.listen(this.wheel2,"mousemove",this._hoverWheel2.bind(this));n2i.listen(this.wheel2,"click",this._pickColor.bind(this));n2i.listen(this.wheel3,"mousemove",this._hoverWheel3.bind(this));n2i.listen(this.wheel3,"click",this._pickColor.bind(this));n2i.listen(this.element,"mousedown",function(E){n2i.stop(E)});n2i.listen(this.swatches,"mousemove",function(E){E=n2i.event(E);this._hoverColor(E.element.getAttribute("rel"))}.bind(this));n2i.listen(this.swatches,"click",this._pickColor.bind(this))},$click:function(C){var D=parseInt(C.element.getAttribute("rel"));for(var A=this.pages.length-1;A>=0;A--){this.pages[A].style.display=A==D?"block":"none"}for(var A=0;A<this.buttons.length;A++){this.buttons[A].setSelected(this.buttons[A]==C)}},_click:function(C){C=n2i.event(C);C.stop();var A=C.findByTag("input");if(A){A.focus()}},_pickColor:function(A){n2i.stop(A);this.fire("colorWasSelected",this.color)},_hoverColor:function(A){this.preview.style.background=A;this.color=A;this.fire("colorWasHovered",this.color);this.input.value=A},buildData:function(){var A=new Array();A[0]=new Array(0,1,0);A[1]=new Array(-1,0,0);A[2]=new Array(0,0,1);A[3]=new Array(0,-1,0);A[4]=new Array(1,0,0);A[5]=new Array(0,0,-1);A[6]=new Array(255,1,1);var C=new Array(360);for(i=0;i<6;i++){for(j=0;j<60;j++){C[60*i+j]=new Array(3);for(k=0;k<3;k++){C[60*i+j][k]=A[6][k];A[6][k]+=(A[i][k]*4)}}}this.colorArray=C},_hoverWheel1:function(P){P=n2i.event(P);var C=n2i.getPosition(this.wheel1);var F=4*(P.getLeft()-C.left);var D=4*(P.getTop()-C.top);var K=F-512;var I=D-512;var U=(K<0)?0:1;var T=(I<0)?0:1;var L=2*T+U;var E=new Array(-180,360,180,0);var O=Math.abs(K);var A=Math.abs(I);var Q=A*45/O;if(A>O){Q=90-(O*45/A)}var H=Math.floor(Math.abs(E[L]-Q));K=Math.abs(F-512);I=Math.abs(D-512);var J=Math.sqrt((K*K)+(I*I));if(F==512&D==512){var S="000000"}else{var M=0;for(i=0;i<3;i++){var N=this.colorArray[H][i]*J/256;if(J>256){N+=Math.floor(J-256)}if(N>255){N=255}M=256*M+Math.floor(N)}S=M.toString(16)}while(S.length<6){S="0"+S}this._hoverColor("#"+S)},_hoverWheel2:function(S){S=n2i.event(S);var E=n2i.getPosition(this.wheel2);var J=(S.getLeft()-E.left);var I=(S.getTop()-E.top);if(I>256){return }var M=J-128;var L=128-I;var T=M*M;var D=L*L;var K=(M<0)?-1:1;var Q=(L<0)?-1:1;var O=M/128;var N=Math.sqrt(T+D);var P=N/128;if(N==0){var C=0;var V=0;var A=new Array(0,0,0)}else{var F=Math.acos(M/N);var H=(L>=0)?F:2*Math.PI-F;var U=360*H/(2*Math.PI);if(P>1){var A=new Array(255,255,255);var C=1;var V=1}else{if(P>=0.5){var C=1-((P-0.5)*2);var V=1;var A=n2i.Color.hsv2rgb(U,C,V)}else{var C=1;var V=P*2;var A=n2i.Color.hsv2rgb(U,C,V)}}}this._hoverColor(n2i.Color.rgb2hex(A))},_hoverWheel3:function(S){S=n2i.event(S);var E=n2i.getPosition(this.wheel3);var J=(S.getLeft()-E.left);var I=(S.getTop()-E.top);if(I>256){return }var M=J-128;var L=128-I;var T=M*M;var D=L*L;var K=(M<0)?-1:1;var Q=(L<0)?-1:1;var O=M/128;var N=Math.sqrt(T+D);var P=N/128;if(N==0){var C=0;var V=0;var A=new Array(0,0,0)}else{var F=Math.acos(M/N);var H=(L>=0)?F:2*Math.PI-F;var U=360*H/(2*Math.PI);if(P>1){var A=new Array(255,255,255);var C=1;var V=1}else{var C=P;var V=1;var A=n2i.Color.hsv2rgb(U,C,V)}}this._hoverColor(n2i.Color.rgb2hex(A))}};var WysiHat={};WysiHat.Editor={attach:function(A){A=$(A);A.hide();return WysiHat.iFrame.create(A,function(D){var C=D.getDocument();var E=D.getWindow();D.load();Event.observe(E,"focus",function(F){D.focus()});Event.observe(E,"blur",function(F){D.blur()});Event.observe(C,"mouseup",function(F){D.fire("wysihat:mouseup")});Event.observe(C,"mousemove",function(F){D.fire("wysihat:mousemove")});Event.observe(C,"keypress",function(F){D.fire("wysihat:change");D.fire("wysihat:keypress")});Event.observe(C,"keyup",function(F){D.fire("wysihat:change");D.fire("wysihat:keyup")});Event.observe(C,"keydown",function(F){if(F.keyCode==86){D.fire("wysihat:paste")}});Event.observe(E,"paste",function(F){D.fire("wysihat:paste")});D.observe("wysihat:change",function(F){F.target.save()})})}};WysiHat.Commands={boldSelection:function(){this.execCommand("bold",false,null)},underlineSelection:function(){this.execCommand("underline",false,null)},italicSelection:function(){this.execCommand("italic",false,null)},strikethroughSelection:function(){this.execCommand("strikethrough",false,null)},blockquoteSelection:function(){this.execCommand("blockquote",false,null)},colorSelection:function(A){this.execCommand("forecolor",false,A)},linkSelection:function(A){this.execCommand("createLink",false,A)},insertOrderedList:function(){this.execCommand("insertorderedlist",false,null)},insertUnorderedList:function(){this.execCommand("insertunorderedlist",false,null)},insertImage:function(A){this.execCommand("insertImage",false,A)},insertHTML:function(C){if(Prototype.Browser.IE){var A=this._selection.getRange();A.pasteHTML(C);A.collapse(false);A.select()}else{this.execCommand("insertHTML",false,C)}},execCommand:function(E,D,C){var A=this.getDocument();A.execCommand(E,D,C)},queryStateCommands:$A(["bold","italic","underline","strikethrough"]),queryCommandState:function(C){var A=this.getDocument();if(this.queryStateCommands.include(C)){return A.queryCommandState(C)}else{if((f=this["query"+C.capitalize()])){return f.bind(this).call()}else{return false}}}};WysiHat.Persistence=(function(){function I(J){return J.format_html_output()}function A(J){return J.format_html_input()}function F(){return this.outputFilter(this.rawContent())}function E(J){this.setRawContent(this.inputFilter(J))}function D(){this.textarea.value=this.content()}function H(){this.setContent(this.textarea.value)}function C(){this.selection.setBookmark();this.save();this.load();this.selection.moveToBookmark()}return{outputFilter:I,inputFilter:A,content:F,setContent:E,save:D,load:H,reload:C}})();WysiHat.Window=(function(){function D(){return this.contentDocument||this.contentWindow.document}function C(){if(this.contentWindow.document){return this.contentWindow}else{if(this.contentDocument){return this.contentDocument.defaultView}else{return null}}}function A(){this.getWindow().focus();if(this.hasFocus){return }this.hasFocus=true}function E(){this.hasFocus=false}return{getDocument:D,getWindow:C,focus:A,blur:E}})();WysiHat.iFrame={create:function(A,D){var C=new Element("iframe",{"id":A.id+"_editor","class":"editor",allowtransparency:"true"});Object.extend(C,WysiHat.Commands);Object.extend(C,WysiHat.Persistence);Object.extend(C,WysiHat.Window);Object.extend(C,WysiHat.iFrame.Methods);C.attach(A,D);A.insert({before:C});return C}};WysiHat.iFrame.Methods={attach:function(A,C){this.textarea=A;this.observe("load",function(){function E(H,K){if(Prototype.Browser.IE){var J=H.createStyleSheet();J.addRule("body","border: 0");J.addRule("p","margin: 0");$H(K).each(function(M){var L=M.first().underscore().dasherize()+": "+M.last();J.addRule("body",L)})}else{if(Prototype.Browser.Opera){var J=Element("style").update("p { margin: 0; }");var I=H.getElementsByTagName("head")[0];I.appendChild(J)}else{Element.setStyle(H.body,K)}}}try{var D=this.getDocument()}catch(F){return }this.selection=new WysiHat.Selection(this);if(this.ready&&D.designMode=="on"){return }E(D,WysiHat.Editor.styles||{});D.designMode="on";C(this);this.ready=true;if(D.body){this.fire("wysihat:loaded")}})},rawContent:function(){var A=this.getDocument();return A.body.innerHTML},setRawContent:function(C){var A=this.getDocument();if(A.body){A.body.innerHTML=C}}};Object.extend(String.prototype,(function(){function C(){var J=String(this);J=J.tidy_xhtml();if(Prototype.Browser.WebKit){J=J.replace(/(<div>)+/g,"\n");J=J.replace(/(<\/div>)+/g,"");J=J.replace(/<p>\s*<\/p>/g,"");J=J.replace(/<br \/>(\n)*/g,"\n")}else{if(Prototype.Browser.Gecko){J=J.replace(/<p>/g,"");J=J.replace(/<\/p>(\n)?/g,"\n");J=J.replace(/<br \/>(\n)*/g,"\n")}else{if(Prototype.Browser.IE||Prototype.Browser.Opera){J=J.replace(/<p>(&nbsp;|&#160;|\s)<\/p>/g,"<p></p>");J=J.replace(/<br \/>/g,"");J=J.replace(/<p>/g,"");J=J.replace(/&nbsp;/g,"");J=J.replace(/<\/p>(\n)?/g,"\n");J=J.gsub(/^<p>/,"");J=J.gsub(/<\/p>$/,"")}}}J=J.gsub(/<b>/,"<strong>");J=J.gsub(/<\/b>/,"</strong>");J=J.gsub(/<i>/,"<em>");J=J.gsub(/<\/i>/,"</em>");J=J.replace(/\n\n+/g,"</p>\n\n<p>");J=J.gsub(/(([^\n])(\n))(?=([^\n]))/,"#{2}<br />\n");J="<p>"+J+"</p>";J=J.replace(/<p>\s*/g,"<p>");J=J.replace(/\s*<\/p>/g,"</p>");var F=Element("body");F.innerHTML=J;if(Prototype.Browser.WebKit||Prototype.Browser.Gecko){var I;do{I=false;F.select("span").each(function(K){if(K.hasClassName("Apple-style-span")){K.removeClassName("Apple-style-span");if(K.className==""){K.removeAttribute("class")}I=true}else{if(K.getStyle("fontWeight")=="bold"){K.setStyle({fontWeight:""});if(K.style.length==0){K.removeAttribute("style")}K.update("<strong>"+K.innerHTML+"</strong>");I=true}else{if(K.getStyle("fontStyle")=="italic"){K.setStyle({fontStyle:""});if(K.style.length==0){K.removeAttribute("style")}K.update("<em>"+K.innerHTML+"</em>");I=true}else{if(K.getStyle("textDecoration")=="underline"){K.setStyle({textDecoration:""});if(K.style.length==0){K.removeAttribute("style")}K.update("<u>"+K.innerHTML+"</u>");I=true}else{if(K.attributes.length==0){K.replace(K.innerHTML);I=true}}}}}})}while(I)}for(var E=0;E<F.descendants().length;E++){var H=F.descendants()[E];if(H.innerHTML.blank()&&H.nodeName!="BR"&&H.id!="bookmark"){H.remove()}}J=F.innerHTML;J=J.tidy_xhtml();J=J.replace(/<br \/>(\n)*/g,"<br />\n");J=J.replace(/<\/p>\n<p>/g,"</p>\n\n<p>");J=J.replace(/<p>\s*<\/p>/g,"");J=J.replace(/\s*$/g,"");return J}function D(){var F=String(this);var E=Element("body");E.innerHTML=F;if(Prototype.Browser.Gecko||Prototype.Browser.WebKit){E.select("strong").each(function(H){H.replace('<span style="font-weight: bold;">'+H.innerHTML+"</span>")});E.select("em").each(function(H){H.replace('<span style="font-style: italic;">'+H.innerHTML+"</span>")});E.select("u").each(function(H){H.replace('<span style="text-decoration: underline;">'+H.innerHTML+"</span>")})}if(Prototype.Browser.WebKit){E.select("span").each(function(H){if(H.getStyle("fontWeight")=="bold"){H.addClassName("Apple-style-span")}if(H.getStyle("fontStyle")=="italic"){H.addClassName("Apple-style-span")}if(H.getStyle("textDecoration")=="underline"){H.addClassName("Apple-style-span")}})}F=E.innerHTML;F=F.tidy_xhtml();F=F.replace(/<\/p>(\n)*<p>/g,"\n\n");F=F.replace(/(\n)?<br( \/)?>(\n)?/g,"\n");F=F.replace(/^<p>/g,"");F=F.replace(/<\/p>$/g,"");if(Prototype.Browser.Gecko){F=F.replace(/\n/g,"<br>");F=F+"<br>"}else{if(Prototype.Browser.WebKit){F=F.replace(/\n/g,"</div><div>");F="<div>"+F+"</div>";F=F.replace(/<div><\/div>/g,"<div><br></div>")}else{if(Prototype.Browser.IE||Prototype.Browser.Opera){F=F.replace(/\n/g,"</p>\n<p>");F="<p>"+F+"</p>";F=F.replace(/<p><\/p>/g,"<p>&nbsp;</p>");F=F.replace(/(<p>&nbsp;<\/p>)+$/g,"")}}}return F}function A(){var E=String(this);E=E.gsub(/\r\n?/,"\n");E=E.gsub(/<([A-Z]+)([^>]*)>/,function(F){return"<"+F[1].toLowerCase()+F[2]+">"});E=E.gsub(/<\/([A-Z]+)>/,function(F){return"</"+F[1].toLowerCase()+">"});E=E.replace(/<br>/g,"<br />");return E}return{format_html_output:C,format_html_input:D,tidy_xhtml:A}})());Object.extend(String.prototype,{sanitize:function(A){return Element("div").update(this).sanitize(A).innerHTML.tidy_xhtml()}});Element.addMethods({sanitize:function(D,C){D=$(D);C=$H(C);var A=$A(C.get("tags")||[]);var E=$A(C.get("attributes")||[]);var F=Element(D.nodeName);$A(D.childNodes).each(function(J){if(J.nodeType==1){var H=$(J).sanitize(C).childNodes;if(A.include(J.nodeName.toLowerCase())){var I=Element(J.nodeName);E.each(function(K){if((value=J.readAttribute(K))){I.writeAttribute(K,value)}});F.appendChild(I);$A(H).each(function(K){I.appendChild(K)})}else{$A(H).each(function(K){F.appendChild(K)})}}else{if(J.nodeType==3){F.appendChild(J)}}});return F}});if(Prototype.Browser.IE){function Range(A){this.ownerDocument=A;this.startContainer=this.ownerDocument.documentElement;this.startOffset=0;this.endContainer=this.ownerDocument.documentElement;this.endOffset=0;this.collapsed=true;this.commonAncestorContainer=null;this.START_TO_START=0;this.START_TO_END=1;this.END_TO_END=2;this.END_TO_START=3}document.createRange=function(){return new Range(this)};Object.extend(Range.prototype,{setStart:function(A,C){},setEnd:function(A,C){},setStartBefore:function(A){},setStartAfter:function(A){},setEndBefore:function(A){},setEndAfter:function(A){},collapse:function(A){},selectNode:function(A){},selectNodeContents:function(A){},compareBoundaryPoints:function(A,C){},deleteContents:function(){},extractContents:function(){},cloneContents:function(){},insertNode:function(D){var A=this.ownerDocument.selection.createRange();var C=this.ownerDocument.createElement("div");C.appendChild(D);A.collapse();A.pasteHTML(C.innerHTML)},surroundContents:function(D){var A=this.ownerDocument.selection.createRange();var C=this.document.createElement("div");C.appendChild(D);node.innerHTML+=A.htmlText;A.pasteHTML(C.innerHTML)},cloneRange:function(){},toString:function(){},detach:function(){}})}WysiHat.Selection=Class.create((function(){function H(L){this.window=L.getWindow();this.document=L.getDocument()}function F(){return this.window.getSelection?this.window.getSelection():this.document.selection}function A(){var M=this.getSelection();try{var L;if(M.getRangeAt){L=M.getRangeAt(0)}else{L=M.createRange()}}catch(N){return null}if(Prototype.Browser.WebKit){L.setStart(M.baseNode,M.baseOffset);L.setEnd(M.extentNode,M.extentOffset)}return L}function E(N){var M=this.getSelection();if(Prototype.Browser.IE){var L=I(this.document,N);L.select()}else{if(Prototype.Browser.WebKit){M.setBaseAndExtent(N,0,N,N.innerText.length)}else{if(Prototype.Browser.Opera){L=this.document.createRange();L.selectNode(N);M.removeAllRanges();M.addRange(L)}else{var L=I(this.document,N);M.removeAllRanges();M.addRange(L)}}}}function D(){var L=null,Q=[],O,N;var S=this.getRange();if(!S){return null}var T;if(S.parentElement){T=S.parentElement()}else{T=S.commonAncestorContainer}if(T){while(T.nodeType!=1){T=T.parentNode}if(T.nodeName.toLowerCase()!="body"){N=T;do{N=N.parentNode;Q[Q.length]=N}while(N.nodeName.toLowerCase()!="body")}O=T.all||T.getElementsByTagName("*");for(var P=0;P<O.length;P++){Q[Q.length]=O[P]}L=[T];for(var U=0,M;U<Q.length;U++){M=I(this.document,Q[U]);if(M&&C(S,M)){L[L.length]=Q[U]}}}return L.first()}function I(L,N){if(L.body.createTextRange){var M=L.body.createTextRange();M.moveToElementText(N)}else{if(L.createRange){var M=L.createRange();M.selectNodeContents(N)}}return M}function C(M,L){if(M.compareEndPoints){return !(L.compareEndPoints("StartToStart",M)==1&&L.compareEndPoints("EndToEnd",M)==1&&L.compareEndPoints("StartToEnd",M)==1&&L.compareEndPoints("EndToStart",M)==1||L.compareEndPoints("StartToStart",M)==-1&&L.compareEndPoints("EndToEnd",M)==-1&&L.compareEndPoints("StartToEnd",M)==-1&&L.compareEndPoints("EndToStart",M)==-1)}else{if(M.compareBoundaryPoints){return !(L.compareBoundaryPoints(0,M)==1&&L.compareBoundaryPoints(2,M)==1&&L.compareBoundaryPoints(1,M)==1&&L.compareBoundaryPoints(3,M)==1||L.compareBoundaryPoints(0,M)==-1&&L.compareBoundaryPoints(2,M)==-1&&L.compareBoundaryPoints(1,M)==-1&&L.compareBoundaryPoints(3,M)==-1)}}return null}function K(){var M=this.document.getElementById("bookmark");if(M){M.parentNode.removeChild(M)}M=this.document.createElement("span");M.id="bookmark";M.innerHTML="&nbsp;";var L;if(Prototype.Browser.IE){L=new Range(this.document)}else{L=this.getRange()}L.insertNode(M)}function J(){var N=this.document.getElementById("bookmark");if(!N){return }if(Prototype.Browser.IE){var L=this.getRange();L.moveToElementText(N);L.collapse();L.select()}else{if(Prototype.Browser.WebKit){var M=this.getSelection();M.setBaseAndExtent(N,0,N,0)}else{var L=this.getRange();L.setStartBefore(N)}}N.parentNode.removeChild(N)}return{initialize:H,getSelection:F,getRange:A,getNode:D,selectNode:E,setBookmark:K,moveToBookmark:J}})());WysiHat.Toolbar=Class.create((function(){function D(J){this.editArea=J;this.hasMouseDown=false;this.element=new Element("div",{"class":"editor_toolbar"});var K=this;this.element.observe("mousedown",function(L){K.mouseDown(L)});this.element.observe("mouseup",function(L){K.mouseUp(L)});this.editArea.insert({before:this.element})}function I(K){var J=this;$A(K).each(function(M){var L=M.first();var N=M.last();J.addButton(L,N)})}function H(J,L){J=$H(J);var K=Element("a",{"class":"button","href":"#"}).update("<span>"+J.get("label")+"</span>");K.addClassName(J.get("name"));this.observeButtonClick(K,L);this.observeStateChanges(K,J.get("name"));this.element.appendChild(K)}function E(J,K){var L=this;$(J).observe("click",function(M){L.hasMouseDown=true;K(L.editArea);L.editArea.fire("wysihat:change");Event.stop(M);L.hasMouseDown=false})}function F(J,K){this.editArea.observe("wysihat:mousemove",function(L){if(L.target.queryCommandState(K)){J.addClassName("selected")}else{J.removeClassName("selected")}})}function C(J){this.hasMouseDown=true}function A(J){this.editArea.focus();this.hasMouseDown=false}return{initialize:D,addButtonSet:I,addButton:H,observeButtonClick:E,observeStateChanges:F,mouseDown:C,mouseUp:A}})());WysiHat.Toolbar.ButtonSets={};WysiHat.Toolbar.ButtonSets.Basic=$A([[{name:"bold",label:"Bold"},function(A){A.boldSelection()}],[{name:"underline",label:"Underline"},function(A){A.underlineSelection()}],[{name:"italic",label:"Italic"},function(A){A.italicSelection()}]])